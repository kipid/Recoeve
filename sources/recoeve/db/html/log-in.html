<!DOCTYPE html>
<html>
<head>
<script>
(function (m, undefined) {
	let pathname=window.location.pathname;
	let path="/account/log-in";
	if (pathname!==path) {
		window.history.replaceState(null, null, path+window.location.search+window.location.hash);
	}
})(m=window.m||{});
</script>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=3, user-scalable=yes"/>
	<meta name="keywords" content="Recoeve.net"/>
	<!-- <link rel="stylesheet" media="all" type="text/css" href="./log-in.css"/> -->
<style>
* {-webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box}
body {width:100%; max-width:1000px; margin:0 auto; padding:5px 0}
.recoeve-container {font-size:10px; line-height:1.5; padding:0 .7em; font-family:'Malgun Gothic', '맑은 고딕', 나눔고딕, NanumGothic, 'MS Mincho', Tahoma, Sans-serif; background:rgb(40,40,55); color:white}
h1 {display:block; font:inherit; font-size:3em; font-weight:bold; margin:0 0 .5em; padding:.6em .5em; border-bottom:5px solid rgb(140,140,150)}
.form-login {width:20em; max-width:100%; margin:0 auto 1em; padding:1em; font-size:16px; color:white; line-height:1; background:black; border:3px solid rgb(120,120,130)}
.form-login>h2 {margin:0 0 1em; font:inherit; font-size:1.3em; line-height:1.3; font-weight:bold}
.form-login>label {display:block; color:white; font-size:1em; font-weight:bold; margin:.9em 0 .4em}
.form-login>label:first-of-type {margin-top:0}
.form-login>label.checkbox {font-weight:normal}
.form-login>input {display:block; width:100%; height:auto; overflow:hidden; padding:.3em .5em; font-family:inherit; font-weight:normal; font-size:1em; line-height:1.5; background:white; color:rgb(50,50,50)}
.form-login>input:focus {background:rgb(240,240,255)}
.form-login>button {width:100%; font:inherit; font-weight:bold; padding:.5em; text-align:center; margin-top:1.3em} .form-login>button:disabled {background:rgb(70,70,70)}
.form-login>.error-msg {border:1px solid gray; padding:.3em .5em; margin:.5em 0 0; color:rgb(255,200,200); line-height:1.3}

.desc {font-size:1.7em; padding:.5em}
data {display:none}
.lang {font-size:1.6em; padding:.5em}
.p {padding-bottom:1em}
.bold {font-weight:bold}
.reco {color:rgb(200,130,130)}
.eve {color:rgb(130,130,200)}

a {text-decoration:none}
a:link {color:rgb(190,190,235)}
a:visited {color:rgb(170,170,215)}
a:active {color:rgb(100,215,215)}
a:hover {color:rgb(170,215,170); text-decoration:underline}

#foot {clear:both; border-top:2px solid white; padding:1em .5em; font-size:1.5em;}

@media all and (min-width:640px) {
	.form-login {margin:0 .6em 1em 1em; float:right; clear:right}
}
</style>
	<title>Recoeve.net</title>
</head>
<body>
<div class="recoeve-container">
<h1>[--welcome--]</h1>

<form id="form-log-in" class="form-login">
<!-- <h2>[--Sign in--]</h2> -->
	<input type="hidden" name="idType" value="id" id="input-idType"/>
	<label for="userId">[--ID--] or [--E-mail--]</label>
	<input class="user-id go-next" name="userId" id="input-userId" value="" placeholder="[--ID--] or [--E-mail--]" type="text" maxlength="50" tabindex="1"/>
	<label for="userPwd">[--Password--]</label>
	<input class="user-pwd" name="userPwd" id="log-in-userPwd" value="" placeholder="[--Password--]" type="password" maxlength="100" tabindex="2"/>
	<label class="checkbox"><input name="rememberMe" class="checkbox" value="yes" type="checkbox" tabindex="3" checked/> <span>[--Remember me--]</span></label><!-- checked="checked" -->
	<!-- <div>Forgot password?</div> -->
	<button id="button-log-in" type="button" onclick="m.logIn(this)" tabindex="4">[--Log in--]</button>
	<button id="button-forgot-pwd" type="button" onclick="m.forgotPwd(this)" tabindex="5">[--Forgot password--]</button>
</form>

<form id="form-sign-up" class="form-login" action="./sign-up" accept-charset="UTF-8" method="post">
<h2>[--Sign up for Recoeve--]</h2>
	<label for="userId">[--ID--]</label>
	<input class="user-id go-next" name="userId" value="" placeholder="[--ID--]" type="text" maxlength="21" tabindex="5"/>
	<label for="userEmail">[--E-mail--]</label>
	<input class="user-Email go-next" name="userEmail" value="" placeholder="[--E-mail--]" type="text" maxlength="50" tabindex="6"/>
	<label for="userPwd">[--Password--]</label>
	<input class="user-pwd go-next" name="userPwd" value="" placeholder="[--Password--]" type="password" maxlength="64" tabindex="7"/>
	<label for="userPwdCfm">[--Password confirm--]</label>
	<input class="user-pwd" name="userPwdCfm" id="sign-up-userPwdCfm" value="" placeholder="[--Password confirm--]" type="password" maxlength="100" tabindex="8"/>
	<button id="button-sign-up" type="button" onclick="m.signUp(this)" tabindex="9">[--Sign up for Recoeve--]</button>
</form>

<div class="desc">
[--desc--]
</div>

<div class="lang">
	<div class="p">Language/언어/語言</div>
<data id="data-lang">en	ko	ja	zh	es
English/영어/en	Korean/한국어/ko	Japanese/일본어/ja	Chinese/중국어(번체)/zh	Spanish/스페인어/es</data>
</div>

<div id="foot">[--version--] [--foot--]<br><a href="http://kipid.tistory.com/entry/Introducing-what-we-are-making-Recoevenet">Introducing what we are making: Recoeve.net</a></div>
</div><!-- recoeve-container -->

<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<script src="/jquery.min.js"></script>
<script>
(function (m, $, undefined) {
$(".replace-reco-eve").html(function (i, orgHtml) {
	return orgHtml
		.replace(/reco/ig,'<span class="reco bold">$&</span>')
		.replace(/eve/ig,'<span class="eve bold">$&</span>');
});

//////////////////////////////////////////
// path.search rendering
//////////////////////////////////////////
m.getSearchVars=function (searchStr) {
	let vars=[];
	if (searchStr!==null&&searchStr!==undefined&&searchStr.length!==0) {
		if (searchStr.startsWith("?")) { searchStr=searchStr.substring(1); }
		let j=searchStr.indexOf("#");
		if (j!==-1) { searchStr=searchStr.substring(0,j); }
		let splits=searchStr.replace(/&amp;/ig,"&").split("&");
		for (let i=0;i<splits.length;i++) {
			let key=splits[i];
			let value="";
			let k=key.indexOf("=");
			if (k!==-1) {
				value=decodeURIComponent(key.substring(k+1));
				key=key.substring(0,k);
			}
			key=decodeURIComponent(key);
			vars[i]=vars[key]={key:key, val:value};
		}
	}
	return vars;
};

/*  :: cookies.js :: Slightly edited by kipid at 2023-02-26.
|*|
|*|  A complete cookies reader/writer framework with full unicode support.
|*|
|*|  https://developer.mozilla.org/en-US/docs/DOM/document.cookie
|*|
|*|  This framework is released under the GNU Public License, version 3 or later.
|*|  http://www.gnu.org/licenses/gpl-3.0-standalone.html
|*|
|*|  Syntaxes:
|*|
|*|  * docCookies.setItem(name, value[, end[, path[, domain[, secure]]]])
|*|  * docCookies.getItem(name)
|*|  * docCookies.removeItem(name[, path], domain)
|*|  * docCookies.hasItem(name)
|*|  * docCookies.keys()
 */
m.docCookies={
	hasItem:function (sKey) {
		return (new RegExp("(?:^|;\\s*)"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie);
	}
	, getItem:function (sKey) {
		return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;
	}
	, removeItem:function (sKey, sPath, sDomain, bSecure) {
		if (!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)) { return false; }
		document.cookie=encodeURIComponent(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"");
		return true;
	}
	, setItem:function (sKey, sValue, vEnd, sPath, sDomain, bSecure) {
		if (!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)) { return false; }
		let sExpires="";
		if (vEnd) { switch (vEnd.constructor) {
			case Number:
				sExpires=vEnd===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;
				break;
			case String:
				sExpires="; expires="+vEnd;
				break;
			case Date:
				sExpires="; expires="+vEnd.toUTCString();
				break;
		}}
		document.cookie=encodeURIComponent(sKey)+"="+encodeURIComponent(sValue)+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"");
		return true;
	}
	, keys:function () {
		let aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);
		for (let nIdx=0;nIdx<aKeys.length;nIdx++) { aKeys[nIdx]=decodeURIComponent(aKeys[nIdx]); }
		return aKeys;
	}
};

m.searchVars=m.getSearchVars(window.location.search);
if (m.searchVars.lang!==undefined) {
	m.docCookies.setItem("lang", m.searchVars.lang.val, Infinity, "/");
}

////////////////////////////////////////////////////
// String to Array (copied from user-page.html)
////////////////////////////////////////////////////
m.encloseStr=function (str) {
	if (str===undefined||str===null||str.constructor!==String) { return ""; }
	if (str.charAt(0)==="\""||/[\n\t]/.test(str)) {
		return '"'+str.replace(/"/g,'""')+'"';
	} else {
		return str;
	}
};
m.strToJSON=function (str, colMap, rowMap) {
	if (str===undefined||str===null||str.constructor!==String) { return []; }
	if (colMap===undefined||colMap===null) { colMap=true; }
	if (rowMap===undefined||rowMap===null) { rowMap=false; }
	// str=str.trim()+"\n";
	if (str.charAt(str.length-1)!=="\n") {
		str+="\n";
	}
	let ret=[];
	let delimiter=/([^\t\n]*)([\t\n])/g;
	let lastQuote=/[^"](?:"")*"([\t\n])/g;
	let exec;
	let start=0;
	let row=-1, col=-1, delim="\n";
	let strElem="";
	function increseRC(str) {
		if (str==='\t') {
			col++; return true;
		} else if (str==='\n') {
			row++; col=0; ret.push([]); return true;
		} return false;
	}
	while (start<str.length&&increseRC(delim)) {
		if ((str.substring(start, start+1))==='"') {
			lastQuote.lastIndex=start+1;
			if ((exec=lastQuote.exec(str))!==null) {
				strElem=str.substring(start+1, lastQuote.lastIndex-2);
				delim=exec[1];
				start=delimiter.lastIndex=lastQuote.lastIndex;
			} else {
				strElem=str.substring(start+1);
				delim="";
				start=str.length;
			}
			strElem=strElem.replace(/""/g,'"');
		} else {
			if ((exec=delimiter.exec(str))!==null) {
				strElem=exec[1];
				delim=exec[2];
				start=delimiter.lastIndex;
			} else {
				strElem=str.substring(start);
				delim="";
				start=str.length;
			}
		}
		ret[row][col]=strElem;
	}
	if (colMap) {
		let firstColSize=ret[0].length;
		for (let i=0;i<ret.length;i++) {
			let jMax=ret[i].length;
			if (jMax>firstColSize) { jMax=firstColSize; }
			for (let j=0;j<jMax;j++) {
				let key=ret[0][j];
				if (key!==undefined) {
					ret[i][key]=ret[i][j];
				}
			}
		}
	}
	if (rowMap) {
		for (let i=0;i<ret.length;i++) {
			let key=ret[i][0];
			if (key!==undefined) {
				ret[key]=ret[i];
			}
		}
	}
	return ret;
};

let $dataLang=$("#data-lang");
let dataLang=m.strToJSON( $dataLang.html().trim() );
let href=window.location.href.replace(/\?\S*$/, "")+"?lang=";
let htmlLang='<div class="p">';
for (let i=0;i<dataLang[0].length;i++) {
	htmlLang+='<a href="'+href+dataLang[0][i]+'">'+dataLang[1][i]+'</a><br>';
}
htmlLang+='</div>';
$dataLang.after(htmlLang);

//////////////////////////////////////////////////////////
// Form handling. (Validity check, encrypt, and submit)
//////////////////////////////////////////////////////////
let sW=screen.width;
let sH=screen.height;
if (sW<sH) {
	sW=screen.height;
	sH=screen.width;
}

m.errCount=0;
m.encloseErr=function (msg) {
	return '<div id="error-msg-'+(m.errCount++)+'" class="error-msg">'+msg+'</div>';
};
m.byteCount=function (str) {
	return encodeURI(str).split(/%..|./).length-1;
};
m.pad=function (str, max) {
	str=str.toString();
	return (str.length<max)?m.pad("0"+str,max):str;
};

////////////////////////////////////////////////////
// hash encrypt
////////////////////////////////////////////////////
m.hash1=function (str) {
	let h=-17-str.length;
	for (let i=0;i<str.length;i++) {
		h+=str.charCodeAt(i);
		h+=(h<<10);
		h^=(h>>>6);
	}
	h+=(((h>>>0)%1318489)<<7);
		// prime from http://www.gutenberg.org/cache/epub/65/pg65.html.utf8
	h+=(h<<3);
	h^=(h>>>11);
	h+=(h<<15);
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash2=function (str) {
	let h=str.length+1;
	let tmp;
	for (let i=0;i<str.length;i++) {
		h+=str.charCodeAt(i);
		tmp=(str.charCodeAt(str.length-1-i)<<11)^h;
		h+=(h<<16)^tmp;
		h^=(h>>>7);
		h+=(h<<11);
	}
	h+=( ((h>>>0)%918679)<<11 );
		// prime from http://www.gutenberg.org/cache/epub/65/pg65.html.utf8
	h^=h<<3;
	h+=h>>>5;
	h^=h<<4;
	h+=h>>>17;
	h^=h<<25;
	h+=h>>>6;
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash3=function (str) {
	let h=-1023+str.length;
	for (let i=0;i<str.length;i++) {
		h^=(h<<5)+(h>>>2)+str.charCodeAt(i);
	}
	h^=h<<15;
	h+=h<<15;
	h+=( ((h>>>0)%1299451)<<2 );
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash4=function (str) {/* RS Hash Function */
	let b=378551;
	let a=63689;
	let h=0;
	for (let i=0;i<str.length;i++) {
		let q=0;
		for (let j=0;j<32;j++) {
			if (a&(1<<j)) {
				q=(q+(h<<j))>>>0;
			}
		}
		h=(q+str.charCodeAt(i))>>>0;
			// h=h*a+str.charCodeAt(i);
		q=0;
		for (let j=0;j<32;j++) {
			if (b&(1<<j)) {
				q=(q+(a<<j))>>>0;
			}
		}
		a=q; // a=a*b;
	}
	return m.pad(h.toString(16), 8);
};
m.hash5=function (str) {/* JS Hash Function */
	let h=1315423911;
	for (let i=0;i<str.length;i++) {
		h^=((h<<5)+str.charCodeAt(i)+(h>>2))>>>0;
	}
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash6=function (str) {/* ELF Hash Function */
	let h=0;
	let x=0;
	for (let i=0;i<str.length;i++) {
		h=((h<<4)+str.charCodeAt(i))>>>0;
		if ((x=h&0xf0000000)!=0) {
			h^=(x>>24);
		}
		h&=~x;
	}
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash7=function (str) {/* BKDR Hash Function */
	let a=131; // 31 131 1313 13131 131313 etc..
	let h=0;
	for (let i=0;i<str.length;i++) {
		let q=0;
		for (let j=0;j<32;j++) {
			if (a&(1<<j)) {
				q=(q+(h<<j))>>>0;
			}
		}
		h=(q+str.charCodeAt(i))>>>0;
			// h=h*a+str.charCodeAt(i);
	}
	return m.pad(h.toString(16), 8);
};
m.hash8=function (str) {/* SDBM Hash Function */
	let h=0;
	for (let i=0;i<str.length;i++) {
		h=(str.charCodeAt(i)+(h<<6)+(h<<16)-h)>>>0;
	}
	return m.pad(h.toString(16), 8);
};
m.hash9=function (str) {/* DJB Hash Function */
	let h=5381;
	for (let i=0;i<str.length;i++) {
		h=(((h<<5)+h)+str.charCodeAt(i))>>>0;
	}
	return m.pad(h.toString(16), 8);
};
m.hash10=function (str) {/* DEK Hash Function */
	let h=str.length;
	for (let i=0;i<str.length;i++) {
		h=((h<<5)^(h>>27))^str.charCodeAt(i);
	}
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash11=function (str) {/* BP Hash Function */
	let h=0;
	for (let i=0;i<str.length;i++) {
		h=h<<7^str.charCodeAt(i);
	}
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash12=function (str) {/* FNV Hash Function */
	let a=0x811C9DC5;
	let h=0;
	for (let i=0;i<str.length;i++) {
		let q=0;
		for (let j=0;j<32;j++) {
			if (a&(1<<j)) {
				q=(q+(h<<j))>>>0;
			}
		}
		h=q>>>0;
			// h=h*a;
		h^=str.charCodeAt(i);
	}
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.hash13=function (str) {/* AP Hash Function */
	let h=0xAAAAAAAA;
	for(let i=0;i<str.length;i++) {
		if ((i&1)==0) {
			h^=((h<<7)^str.charCodeAt(i)*(h>>3));
		} else {
			h^=(~((h<<11)+str.charCodeAt(i)^(h>>5)));
		}
	}
	h=h>>>0;
	return m.pad(h.toString(16), 8);
};
m.encrypt=function (salt, pwd, iter) {
	iter=pwd.length+131+((iter&&iter.constructor==Number&&iter>=0)?iter:0);;
	pwd=salt+pwd;
	let h1=m.hash1(pwd);
	let h2=m.hash2(pwd);
	let h3=m.hash3(pwd);
	let h4=m.hash4(pwd);
	let h5=m.hash5(pwd);
	let h6=m.hash6(pwd);
	let h7=m.hash7(pwd);
	let h8=m.hash8(pwd);
	let h9=m.hash9(pwd);
	let h10=m.hash10(pwd);
	let h11=m.hash11(pwd);
	let h12=m.hash12(pwd);
	let h13=m.hash13(pwd);
	let tmp1, tmp2, tmp3, tmp4, tmp5, tmp6, tmp7, tmp8, tmp9, tmp10, tmp11, tmp12, tmp13;
	for (let i=0;i<iter;i++) {
		tmp1=h13+h12+h11+h10+h9+salt+h8+h7+h6+h5+h4+h3+h2+h1;
		tmp2=h1+h3+salt+h2;
		tmp3=salt+h2+h8+h1+h3;
		tmp4=h7+salt+h5;
		tmp5=h4+salt+h8;
		tmp6=h10+h13+salt+h6;
		tmp7=h6+h1+h9+salt;
		tmp8=h9+salt+h10;
		tmp9=h7+salt+h12;
		tmp10=h11+salt+h5;
		tmp11=h4+salt+h13+h2;
		tmp12=h11+salt+h6;
		tmp13=h4+h12+salt+h8;
		h1=m.hash1(tmp1);
		h2=m.hash2(tmp2);
		h3=m.hash3(tmp3);
		h4=m.hash4(tmp4);
		h5=m.hash5(tmp5);
		h6=m.hash6(tmp6);
		h7=m.hash7(tmp7);
		h8=m.hash8(tmp8);
		h9=m.hash9(tmp9);
		h10=m.hash10(tmp10);
		h11=m.hash11(tmp11);
		h12=m.hash12(tmp12);
		h13=m.hash13(tmp13);
	}
	return h1+h2+h3+h4+h5+h6+h7+h8+h9+h10+h11+h12+h13;
};
m.iterFull=10000;

m.regExId=/^[a-zA-Zㄱ-ㅎ가-힣0-9-_.]+$/;
m.regExEmail=/^[a-zA-Z0-9-_.]+@[a-zA-Z0-9-_.]+$/;
m.minIdLength=1;
m.maxIdLength=255;
m.minPwdLength=6;
m.maxPwdLength=255;

m.logIn=function (elem) {
	let $elem=$(elem).eq(0);
	$elem[0].disabled=true;
	let $form=$elem.parent("form").eq(0);
	let idType="id";
	let userId=$form.find(".user-id")[0].value.trim();
	let userIdLength=m.byteCount(userId);
	let userPwd=$form.find(".user-pwd")[0].value;
	let err="";
	let valid=false;
	
	if (userIdLength==0) {
		err+="[--ID or E-mail is empty.--]";
	} else if (userIdLength<m.minIdLength) {
		err+="[--ID or E-mail is too short.--]";
	} else if (userPwd.length==0) {
		err+="[--Password is empty.--]";
	} else if (userPwd.length<m.minPwdLength) {
		err+="[--Password is too short.--]";
	} else {
		if (m.regExId.test(userId)) {
			$form.find("#input-idType")[0].value=idType="id"; valid=true;
		} else if (m.regExEmail.test(userId)) {
			$form.find("#input-idType")[0].value=idType="email"; valid=true;
		} else {
			err+="[--ID--]/[--E-mail--] '"+userId+"' [--is of invalid form.--]";
		}
	}
	
	if (valid) {
		let form_data=`log	iehack	screenWidth	screenHeight	idType	userId	rememberMe	userPwd
web	&#9760;	${sW}	${sH}	${idType}	${userId}	${($("input:checkbox[name='rememberMe']").is(":checked")?"yes":"no")}	`;
		$elem.before( m.encloseErr("[--Checking ID/E-mail--]: [--Please wait.--]") );
		$.ajax("./pwd_iteration", {
			type: "POST"
			, data: idType+"\t"+userId
		}).fail(function () {
			$elem.before( m.encloseErr("[--Request times out.--] [--Please click the Log-in button again.--]") );
			$elem[0].disabled=false;
		}).done(function (resp) { // resp: pwd_iteration or "No such id"	salt
			let res=resp.split('\t');
			let iter=Number(res[0]);
			if (isNaN(iter)) {
				$elem.before( m.encloseErr("Error: "+res[0]) );
				$elem[0].disabled=false;
			} else {
				$elem.before( m.encloseErr("[--Password is being encrypted.--]") );
				setTimeout(function () {
					form_data+=m.encrypt(res[1], userPwd, iter); userPwd="";
					$elem.before( m.encloseErr("[--Logging in--]: [--Please wait.--]") );
					$.ajax("./log-in.do", {
						type: "POST"
						, data: form_data
					}).done(function (resp) {
						$elem.before( m.encloseErr(resp) );
						if (resp==="log-in success") {
							if (m.searchVars.goto!==undefined) {
								window.location.href=m.searchVars.goto.val;
							} else {
								window.location.pathname="/";
							}
						} else {
							$elem[0].disabled=false;
						}
					});
				}, 500);
			}
		});
	} else {
		$elem.before( m.encloseErr(err) );
		$elem[0].disabled=false;
	}
	for (i=m.errCount-7;i>=0;i--) {
		$("#error-msg-"+i).hide();
	}
};

m.forgotPwd=function (elem) {
	let $elem=$(elem).eq(0);
	$elem[0].disabled=true;
	let $form=$elem.parent("form").eq(0);
	let idType="id";
	let userId=$form.find(".user-id")[0].value.trim();
	let userIdLength=m.byteCount(userId);
	let err="";
	let valid=false;
	
	if (userIdLength==0) {
		err+="[--ID or E-mail is empty.--]";
	} else if (userIdLength<m.minIdLength) {
		err+="[--ID or E-mail is too short.--]";
	} else {
		if (m.regExId.test(userId)) {
			$form.find("#input-idType")[0].value=idType="id"; valid=true;
		} else if (m.regExEmail.test(userId)) {
			$form.find("#input-idType")[0].value=idType="email"; valid=true;
		} else {
			err+="[--ID--]/[--E-mail--] '"+userId+"' [--is of invalid form.--]";
		}
	}
	
	if (valid) {
		let form_data="log\tiehack\tscreenWidth\tscreenHeight\tidType\tuserId\n"
			+"web\t&#9760;\t"+sW+"\t"+sH+"\t"+idType+"\t"+userId;
		$elem.before( m.encloseErr("[--Checking ID/E-mail--]: [--Please wait.--]") );
		$.ajax("./pwd_iteration", {
			type: "POST"
			, data: idType+"\t"+userId
		}).fail(function () {
			$elem.before( m.encloseErr("[--Request times out.--] [--Please click the Forgot password button again.--]") );
			$elem[0].disabled=false;
		}).done(function (resp) { // resp: pwd_iteration or "No such id"	salt
			let res=resp.split('\t');
			let iter=Number(res[0]);
			if (isNaN(iter)) {
				$elem.before( m.encloseErr("Error: "+res[0]) );
				$elem[0].disabled=false;
			} else {
				$elem.before( m.encloseErr("[--Sending an email--]: [--Please wait.--]") );
				$.ajax("./forgotPwd", {
					type: "POST"
					, data: form_data
				}).done(function (resp) {
					$elem.before( m.encloseErr(resp) );
					$elem[0].disabled=false;
				});
			}
		});
	} else {
		$elem.before( m.encloseErr(err) );
		$elem[0].disabled=false;
	}
	for (i=m.errCount-7;i>=0;i--) {
		$("#error-msg-"+i).hide();
	}
};

m.signUp=function (elem) {
	let $elem=$(elem).eq(0);
	$elem[0].disabled=true;
	let $form=$elem.parent("form").eq(0);
	let userId=$form.find(".user-id")[0].value.trim();
	let userIdLength=m.byteCount(userId);
	let userEmail=$form.find(".user-Email")[0].value.trim();
	let userPwd=$form.find(".user-pwd")[0].value;
	let userPwdCfm=$form.find(".user-pwd")[1].value;
	let err="";
	let valid=false;
	
	if (userIdLength==0) {
		err+="[--ID is empty.--]";
	} else if (userIdLength<m.minIdLength||userIdLength>m.maxIdLength) {
		err+=(userIdLength<m.minIdLength?"[--ID is too short.--]":"[--ID is too long.--]")+" '"+userId+"':"+userIdLength+" ([--ID--].[--length--]:"+m.minIdLength+"~"+m.maxIdLength+")";
	} else if (!m.regExId.test(userId)) {
		err+="[--ID--] '"+userId+"' [--is of invalid form.--]";
	} else if (userEmail.length==0) {
		err+="[--E-mail is empty.--]";
	} else if (!m.regExEmail.test(userEmail)) {
		err+="[--E-mail--] '"+userEmail+"' [--is of invalid form.--]";
	} else if (userPwd.length==0) {
		err+="[--Password is empty.--]";
	} else if (userPwd.length<m.minPwdLength||userPwd.length>m.maxPwdLength) {
		err+=(userPwd.length<m.minPwdLength?"[--Password is too short.--]":"[--Password is too long.--]")+" ([--Password--].[--length--]:"+m.minPwdLength+"~"+m.maxPwdLength+")";
	} else if (userPwd!==userPwdCfm) {
		err+="[--Confirm your password correctly.--]";
	} else {
		valid=true;
	}
	
	if (valid) {
		$elem.before( m.encloseErr("[--Checking ID and E-mail--]: [--Please wait.--]") );
		$.ajax("./check", {
			type: "POST"
			, data: userId+"\t"+userEmail
		}).fail(function () {
			$elem.before( m.encloseErr("[--Request time out.--] [--Please click the Sign-up button again.--]") );
			$elem[0].disabled=false;
		}).done(function (resp) { // resp: idAvailable	emailAvailable	tToken	authToken(char(64))
			let res=resp.split('\t');
			if (res&&res.length>2&&res[0]=="true"&&res[1]=="true") {
				$elem.before( m.encloseErr("[--Password is being encrypted.--]") );
				setTimeout(function () {
					let userPwd=$form.find(".user-pwd")[0].value=m.encrypt(res[3], userPwd, m.iterFull);
					let userPwdCfm=$form.find(".user-pwd")[1].value="confirmed";
					$elem.before( m.encloseErr("[--Signing up--]: [--Please wait.--]") );
					let form_data=`userId	userEmail	tToken	authToken	userPwd	userPwdCfm
${userId}	${userEmail}	${res[2]}	${res[3]}	${userPwd}	${userPwdCfm}`;
					userPwd=null; userPwdCfm=null;
					$.ajax("./sign-up", {
						type: "POST"
						, data: form_data
					}).done(function (resp) {
						$elem.before( m.encloseErr(resp) );
						$elem[0].disabled=false;
					});
				}, 500);
			} else {
				let errStr="";
				if (res[0]=="false") {
					errStr+="[--ID--] '"+userId+"' [--is already in use. Please try another ID.--]<br>";
				}
				if (res[1]=="false") {
					errStr+="[--E-mail--] '"+userEmail+"' [--is already registered. Please try another e-mail.--]<br>";
				}
				$elem.before( m.encloseErr(errStr) );
				$elem[0].disabled=false;
			}
		});
	} else {
		$elem.before( m.encloseErr(err) );
		$elem[0].disabled=false;
	}
	for (i=m.errCount-7;i>=0;i--) {
		$("#error-msg-"+i).hide();
	}
};

$("#log-in-userPwd").on("keyup", function (e) {
	if (e.keyCode===13) { // Enter
		$("#button-log-in").trigger("click");
	}
});
$("#sign-up-userPwdCfm").on("keyup", function (e) {
	if (e.keyCode===13) { // Enter
		$("#button-sign-up").trigger("click");
	}
});
$("input.go-next").on("keyup", function (e) {
	if (e.keyCode===13) { // Enter
		$(this).next().next("input").focus();
	}
});
})(m=window.m||{}, jQuery);
</script>
</body>
</html>