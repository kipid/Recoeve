<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=3, user-scalable=yes"/>
<link rel="icon" type="image/x-icon" href="/CDN/favicon.ico">
<title>Recoeve.net</title>
<script src="/jquery.js"></script>
<script src="/prepare.js"></script>
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script>
(function (m, $, undefined) {
m.myIndex="{--myIndex--}";
m.myId="{--myId--}";

m.gotoCats=false;
m.goOn=false;
m.ToRsOn=false;
m.newRecoOn=false;

m.pathName=window.location.pathname;
if (m.pathName==="/reco") {
	m.newRecoOn=true;
}
if (m.pathName.substring(0,6)!=="/user/") { // e.g. path=/ or /reco?... or /account/log-in with sessionPassed
	m.pathName="/user/"+m.myId;
}

m.pathNameSplit=m.pathName.split("/");
m.userId=decodeURIComponent(m.pathNameSplit[2]);
m.myPage=(m.myId===m.userId);
m.userPath=`/user/${encodeURIComponent(m.userId)}`;
m.recoMode=m.pathNameSplit[3]==="mode"&&m.pathNameSplit[4]?m.pathNameSplit[4]:"";
m.hashURI=decodeURIComponent(window.location.hash.substring(1));

m.searchVars=m.getSearchVars(window.location.search);
m.currentCat=m.searchVars?.cat?.val||"";

m.lang=null;
if (!!m.searchVars.lang) {
	m.lang=m.searchVars.lang.val;
	m.docCookies.setItem("lang", m.lang, Infinity, "/", false, true);
}
else if (m.docCookies.hasItem("lang")) {
	m.lang=m.docCookies.getItem("lang");
}
})(window.m, jQuery);
</script>
<style>
body {margin:0; padding:0; overflow-wrap:break-word; word-wrap:break-word; word-break:break-word; background:rgb(150,150,150)}

div, form, input, textarea {box-sizing:border-box; max-width:100%}
data {display:none}
.none {display:none}
.center {text-align:center}
.right {text-align:right}
.fLeft {float:left}
.fRight {float:right}
.cBoth {clear:both}
.bold {font-weight:bold}
.underline {text-decoration:underline}
img {min-width:1em; min-height:1em; max-width:100%; max-height:100%}
ul, ol {margin:0; padding:0}
li, dd {margin:.3em 0 .5em 2em}

.button {display:inline-block; cursor:pointer; margin:0 .2em 1em; padding:.2em .5em; border:.15em solid rgb(50,50,50); background:rgb(110,110,110)}
	.bright .button {border-color:rgb(200,200,200); background:rgb(190,190,190)}
	.pink .button {border-color:rgb(180,0,180); background:rgb(138,13,106)}
.reco .button {margin:0}
.reco .button.deleted {background:rgb(255, 118, 0)}
.button.to-be-executed {display:block; width:100%; text-align:center; margin:20em auto 50em}
.button.disabled {pointer-events:none; background:rgb(25,25,25); color:rgb(120,120,120)}
	.bright .button.disabled {background:rgb(100,100,100); color:rgb(25,25,25)}
.button.left {float:left; margin-right:.5em}
.button:active {background:rgb(0,80,80)}
	.bright .button:active {background:rgb(100,180,180)}
.button.enabled {background:rgb(50,140,80)}
	.bright .button.enabled {background:rgb(120,210,150)}
	.pink .button.enabled {background:rgb(115,148,213)}
.button.enabled:active {background:rgb(70,70,70)}
	.bright .button.enabled:active {background:rgb(190,190,190)}
	.pink .button.enabled:active {background:rgb(125,125,125)}

a {text-decoration:none}
a:link {color:rgb(190,190,235)}
	.bright a:link {color:rgb(60,60,160)}
	.pink a:link {color:rgb(155,195,131)}
a:visited {color:rgb(170,170,215)}
	.bright a:visited {color:rgb(40,40,140)}
	.pink a:visited {color:rgb(111,146,235)}
a:active {color:rgb(100,215,215)}
	.bright a:active {color:rgb(0,100,100)}
	.pink a:active {color:rgb(70,170,170)}
a:hover {color:rgb(170,215,170); text-decoration:underline}
	.bright a:hover {color:rgb(40,140,40)}
	.pink a:hover {color:rgb(70,170,70)}

::-webkit-scrollbar {width:7px; height:7px}
::-webkit-scrollbar-track {-webkit-border-radius:5px; border-radius:5px}
::-webkit-scrollbar-thumb {-webkit-border-radius:5px; border-radius:5px; background:rgb(0,120,120); -webkit-box-shadow:inset 0 0 3px rgb(0,0,0)}
::-webkit-scrollbar-corner {background:transparent}

.block-touch {position:fixed; z-index:30000; left:0; right:0; top:0; bottom:0; background:rgb(0,0,0,0.3)}
.block-touch-exit {z-index:31000}

#container {max-width:1000px; line-height:1.6; font-family:'Malgun Gothic', '맑은 고딕', 나눔고딕, NanumGothic, 'MS Mincho', Tahoma, Sans-serif; background:rgb(75,75,75); color:white; font-size:15px}
	#container.bright {background:rgb(250,250,250); color:black}
	#container.pink {background:rgb(68,0,59); color:wheat}
#sidebar-dragger {position:fixed; z-index:10; top:0; height:200px; left:0; width:1.5em; background:transparent}
#sidebar-dragger-in {position:absolute; top:2em; left:0; right:0; bottom:0}
#sidebar {position:fixed; z-index:10; max-width:70%; width:15em; max-height:100%; margin:0; padding:.5em; background:rgb(35,35,35); color:white; border-right:1px solid white; border-bottom:1px solid white; overflow:auto}
	.bright #sidebar {background:rgb(230,230,230); color:black; border-color:black}
	.pink #sidebar {background:rgb(134,31,110); color:wheat; border-color:wheat}
#sidebar-toggle {width:2em; height:2em; background:black; border:white 2px solid}

#user-noti {padding:.3em .2em; font-size:1.1em; color:rgb(150,150,240)}
.bright #user-noti {color:rgb(50,50,190)}

#catList {margin-bottom:1em}
#catList .cat {border:1px solid transparent; margin-bottom:.15em}
#cat-to-here {border:1px solid rgb(130,130,130); margin:.5em}
#catList .cat.edit {position:relative; border:1px solid rgb(150,150,225); padding:0 1.3em}
#catList .cat.edit.move {position:fixed; z-index:101}
#catList .cat.edit>.edit-bar {position:absolute; width:1.3em; top:0; bottom:0; background:rgb(150,150,225)}
#catList .cat.edit>.edit-bar:first-child {left:0}
#catList .cat.edit>.edit-bar:last-child {right:0}
#catList .cat.selected {border:1px solid white}
	.bright #catList .cat.selected {border-color:black}
	.pink #catList .cat.selected {border-color:wheat}
#catList .cat>.baseCat, #catList .cat>.EC {cursor:pointer; color:white}
	.bright #catList .cat>.baseCat, .bright #catList .cat>.EC {color:black}
	.pink #catList .cat>.baseCat, .pink #catList .cat>.EC {color:wheat}
#catList .cat.selected>.baseCat {pointer-events:none; color:rgb(255,210,210)}
	.bright #catList .cat.selected>.baseCat {color:rgb(50,0,0)}
	.pink #catList .cat.selected>.baseCat {color:white}
#catList .cat>.noEC, #catList .cat>.EC {display:inline-block; font-size:.5em; margin-top:-.5em; width:2em; text-align:center; vertical-align:middle}

#cat-fs-container {
	position:relative;
	width:25em; max-width:100%;
	height:auto;
	text-align:left
}
#cat-fs-list {
	height:auto; min-height:2em; max-height:15em; overflow-y:auto;
	border:.15em gray solid;
	background:rgb(20,20,20)
}
#cat-fs-list .list-item {
	background:black; color:white;
	padding:.2em .5em .4em
}
#cat-fs-list .list-item.selected {border:.15em solid rgb(210,150,150)}
#cat-fs-list .list-item .list-index {display:none}
#cat-fs-list .list-item:nth-child(2n) {
	background:rgb(40,40,40)
}
#cat-fs-list .list-item .cat {font-size:.9em}
#cat-fs-list .list-item .highlighted {
	font-size:.5em; color:rgb(150,150,150)
}
#cat-fs-list .list-item .highlighted .bold {
	color:rgb(170,250,170)
}

#fuzzy-search-container, #table-of-recos-container, #goto-cats-container {
	position:fixed; left:0; top:0;
	z-index:10010;
	width:25em; max-width:100%;
	height:auto;
	text-align:left
}
.fs-name {background:black; padding:.1em 3em}
#fuzzy-search, #table-of-recos, #goto-cats {
	height:2em; max-height:5em; overflow-y:auto;
	font:inherit; font-size:1.3em; color:black;
	width:100%;
	padding:.1em;
	border:.15em gray solid;
	background:white
}
#goto-cats {height:4em; margin-bottom:-0.4em}
#fuzzy-search-list, #table-of-recos-list, #goto-cats-list {
	height:auto; min-height:2em; max-height:15em; overflow-y:auto;
	border:.15em gray solid;
	background:rgb(20,20,20)
}
#fuzzy-search-list .list-item, #table-of-recos-list .list-item, #goto-cats-list .list-item {
	background:black; color:white;
	padding:.2em .5em .4em
}
#fuzzy-search-list .list-item.selected, #table-of-recos-list .list-item.selected, #goto-cats-list .list-item.selected {border:.15em solid rgb(210,150,150)}
#fuzzy-search-list .list-item .list-index, #table-of-recos-list .list-item .list-index, #goto-cats-list .list-item .list-index {display:none}
#fuzzy-search-list .list-item:nth-child(2n), #table-of-recos-list .list-item:nth-child(2n), #goto-cats-list .list-item:nth-child(2n) {
	background:rgb(40,40,40)
}
#fuzzy-search-list .list-item.deleted, #goto-cats-list .list-item.deleted {background:rgb(108 50 0); border:.15em solid rgb(120,120,150)}
#fuzzy-search-list .list-item .cat, #table-of-recos-list .list-item .cat, #goto-cats-list .list-item .cat {font-size:.9em}
#fuzzy-search-list .list-item .highlighted, #table-of-recos-list .list-item .highlighted, #goto-cats-list .list-item .highlighted {
	font-size:.5em; color:rgb(150,150,150)
}
#fuzzy-search-list .list-item .highlighted .bold, #table-of-recos-list .list-item .highlighted .bold, #goto-cats-list .list-item .highlighted .bold {
	color:rgb(170,250,170)
}
.exit {
	z-index:10010;
	position:absolute; display:inline-block;
	right:0; top:0;
	margin:0;
	width:1.8em; height:1.8em; line-height:1.0;
	text-align:center;
	/*border-radius:.4em;*/
	cursor:pointer;
	border:.15em rgb(80, 80, 80) solid;
	background-color:rgb(30,30,30); color:white
}
.exit>svg {
	width:100%; height:100%;
	font-size:1.8em; line-height:1.0
}

#new-reco {z-index:21000; position:fixed; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,0.8); overflow:auto; color:white}
#new-reco form {position:relative; width:40em; max-width:100%; margin:1em auto; padding:1em; background:black; border:.2em solid rgb(120,120,130); text-align:left}
#new-reco label {display:inline-block; font-weight:bold; margin:.9em 0 .4em}
#new-reco label:first-child {margin-top:0}
#new-reco label>.desc {font-size:.8em}
#new-reco input, #new-reco textarea {display:block; max-width:100%; width:100%; resize:vertical; font:inherit; font-weight:bold; overflow-x:hidden; overflow-y:auto; padding:.2em .3em; background:white; color:rgb(50,50,50)}
textarea.single-line {min-height:2.2em; height:3.8em}
textarea.multi-line {font-size:.9em; min-height:10em}
#new-reco input#input-val {display:inline-block; width:6.2em}
.upDown {border:solid 1px white; padding:1px}
.up, .down {vertical-align:top}
#input-val-stars {display:inline-block; vertical-align:text-bottom; margin:0 0 -.5em -.5em}
#new-reco .def-title {margin:.2em 0; border:1px solid rgb(130,130,130); padding:1px .5em; font-size:.9em}
#new-reco .def-title.selected {border-color:rgb(255,180,180)}
#new-reco .def-desc {margin:.2em 0; border:1px solid rgb(130,130,130); padding:1px .5em; font-size:.9em}
#new-reco .def-desc.selected {border-color:rgb(255,180,180)}
#new-reco .buttons {margin-top:1em; text-align:right}
#new-reco #error-msg {margin:0}

#new-reco .def-cat, #multireco-cats-container .def-cat {display:inline-block; margin:.2em 0; border:1px solid rgb(130,130,130); padding:1px .5em; font-size:.9em}
#new-reco .def-cat.selected, #multireco-cats-container .def-cat.selected {border-color:rgb(255,180,180)}
#delete-cat, #multireco-delete-cat {background:#ff7600}
#new-reco .def-cmd {display:inline-block; margin:.2em 0; border:1px solid rgb(130,130,130); padding:1px .5em; font-size:.9em}

#multireco-cats-container {
	position:fixed;
	left:0; top:0;
	z-index:10000;
	background:black;
	width:25em; max-width:100%;
	height:auto;
	text-align:left
}
#multireco-cats-container textarea {
	display:block;
	max-width:100%;
	width:100%;
	resize:vertical;
	font:inherit;
	font-weight:bold;
	overflow-x:hidden;
	overflow-y:auto;
	padding:0.2em 0.3em;
	background:white;
	color:rgb(50,50,50)
}
#multireco-cat-fs-container {
	position:relative;
	width:25em; max-width:100%;
	height:auto;
	text-align:left
}
#multireco-cat-fs-list {
	height:auto; min-height:2em; max-height:15em; overflow-y:auto;
	border:.15em gray solid;
	background:rgb(20,20,20)
}
#multireco-cat-fs-list .list-item {
	background:black; color:white;
	padding:.2em .5em .4em
}
#multireco-cat-fs-list .list-item.selected {border:.15em solid rgb(210,150,150)}
#multireco-cat-fs-list .list-item .list-index {display:none}
#multireco-cat-fs-list .list-item:nth-child(2n) {
	background:rgb(40,40,40)
}
#multireco-cat-fs-list .list-item .cat {font-size:.9em}
#multireco-cat-fs-list .list-item .highlighted {
	font-size:.5em; color:rgb(150,150,150)
}
#multireco-cat-fs-list .list-item .highlighted .bold {
	color:rgb(170,250,170)
}

#javascript-disable {font-size:3em}

#change-style {margin-top:10em; font-size:12px; line-height:1.6; text-align:right; padding:.5em}
#change-style form {vertical-align:middle; text-indent:0; display:inline-block; border:2px gray solid; padding:2px; margin:0}
#change-style form * {margin:0; padding:0; text-align:center; vertical-align:middle}
#change-style form button {width:29px; height:25px; padding:0}
#change-style .deviceInfo {font-size:1em}

#shortkeys {}

.point-range {margin:1em 2.5em; padding:0; position:relative; display:inline-block; float:right; width:270px; height:30px; background:rgb(200,100,100)}
.point-range-bar {position:absolute; left:0; right:0; height:100%; background:rgb(100,200,100)}
.point-range-left, .point-range-right {position:absolute; width:33px; top:0; bottom:0; background:rgba(150,150,150,0.7); border:.15em solid rgb(50,50,50)}
.point-range-left {left:-23px}
.point-range-right {right:-23px}
.point-range-result {margin:1em; display:inline-block; text-align:center; float:right; border:.15em solid white; padding:.1em .5em; vertical-align:top}
	.bright .point-range-result {border-color:black}
	.pink .point-range-result {border-color:pink}

#floating-key .point-range-con {position:sticky; left:0; right:0; width:9em; height:23px; background:wheat; border-bottom:1px solid wheat}
	.bright #floating-key .point-range-con {border-color:black}
	.pink #floating-key .point-range-con {border-color:pink}
#floating-key .point-range {position:absolute; margin:0; padding:0; left:.5em; width:8em; height:100%; background:rgb(200,100,100)}
#floating-key .point-range-bar {position:absolute; left:0; right:0; top:0; bottom:0; background:rgb(100,200,100)}
#floating-key .point-range-left, #floating-key .point-range-right {position:absolute; width:23px; top:0; bottom:0; background:rgba(150,150,150,0.7); border:.15em solid rgb(50,50,50)}
#floating-key .point-range-left {left:0}
#floating-key .point-range-right {right:0}
#floating-key .point-range-result {margin:0; font-size:13px; background:black; color:white; text-align:center; padding:.1em .5em; width:100%; height:1.6em; border:1px solid wheat}
	.bright #floating-key .point-range-result {background:white; color:black; border-color:black}
	.pink #floating-key .point-range-result {background:pink; color:white; border-color:pink}

.numbers-of-recos {margin:1em 0; padding:.5em; width:100%}

#my-id {margin-left:2.5em}

.multireco {display:flex; justify-content:space-evenly; flex-wrap:wrap}
.reco {margin:0 0 1em; border-top:.15em solid rgb(100,100,100); border-bottom:.15em solid rgb(100,100,100); background:black}
	.bright .reco {border-color:black; background:rgb(230,230,230)}
	.pink .reco {border-color:wheat; background:rgb(35,0,97)}
.reco.deleted {border:.5em solid rgb(168 50 0)}
.multireco .reco {width:49%}
.reco .SNS-img {margin:0; float:left; box-sizing:content-box; width:27px; height:27px; border:2px gray solid; border-left:0; cursor:pointer}
.reco .SNS-img:first-child {border-left:2px gray solid}
.reco>.textURI, .reco>.YTVideoId {display:none}
.reco>.uri {font-size:.7em; border:2px solid rgb(100,100,150); border-bottom:0; padding:.2em .5em}
.multireco .reco>.uri {font-size:.7em}
.reco>.title {font-size:1.1em; border:2px solid rgb(150,100,100); padding:.2em .5em}
.multireco .reco>.title {clear:both; font-size:0.9em}
.reco>.cats {font-size:.8em; border:2px solid rgb(100,150,100); border-top:0; padding:.2em .5em}
.multireco .reco>.cats {font-size:.7em}
.reco>.cats>a {color:rgb(130,170,130)}
.reco>.cats>a.currentCat {color:rgb(140,180,140); font-weight:bold; text-decoration:none}
.reco>.desc {margin:.5em 0; padding:.5em}
.reco>.cmt {margin:.5em 0; padding:.5em; background:rgb(30,30,30); border-left:.3em solid rgb(10,80,80)}
	.bright .reco>.cmt {background:rgb(200,200,200)}
	.pink .reco>.cmt {background:rgb(75,47,47)}
.multireco .reco>.cmt {display:none}
.stars-container {position:relative; display:inline-block; cursor:text}
.stars-container>div.bar {position:absolute; top:1px; bottom:1px; background:rgb(232,242,80)}
.stars-container>svg.out-stars {position:absolute; left:0; top:0; width:100%; height:100%}
.stars-container>svg.out-stars>polygon {fill:rgb(50,50,50);stroke-width:0;fill-rule:evenodd}
.reco>.val {margin:.5em 0 .3em}
.multireco .reco>.val {display:none}
.reco>.val>.str, .reco>.my-point>.str {border:.15em solid white; padding:.1em .5em; margin:0 .2em; vertical-align:top}
	.bright .reco>.val>.str, .bright .reco>.my-point>.str {border-color:black}
.reco .tFirst, .reco .tLast {display:inline-block; float:right; margin:.2em 1em; font-size:.8em}
.multireco .reco .tFirst, .multireco .reco .tLast {display:none}
.reco .val {display:block}
.multireco .reco .val {display:none}
.reco .my-point {display:none}
.multireco .reco .my-point {display:block}
.reco .result {font-size:.7em; padding:.5em}

.lyricsC {}
.lyricsArrow {width:0; height:0; padding:0; margin:0 auto; border-color:transparent transparent rgb(0,30,0); border-style:solid; border-width:0.5em}
.lyrics {border:0.3em solid rgb(0,30,0); padding:1em .5em; margin-top:-1px}

.rC {margin:.5em 0}
.rC.fixed {position:fixed; top:0; left:0; width:100%; max-width:100%; margin:0; padding:1px; background:black; border-bottom:.15em solid white}
	.bright .rC.fixed {background:white; border-color:black}
.rC>.rSC {box-sizing:content-box; position:relative; height:4em; padding-bottom:63%}
.rC.soundcloud>.rSC {padding-bottom:20%}
.rC.instagram>.rSC {padding-bottom:150%}
.rC.eveElse>.rSC {padding-bottom:80%}
.rC>.rSC>* {position:absolute; width:100%; height:100%; left:0; top:0}
.rC>.pc {text-align:center; font-size:10px} /* position change */

#foot {clear:both; border-top:.15em solid white; padding:1em .5em}
	.bright #foot {border-color:black}

#floating-key {display:flex; flex-wrap:wrap; bottom:2.6em; width:9em; height:auto}
#floating-key div.button {border-top:none; text-align:center; margin:0; padding:0; width:9em; height:auto}
	#floating-key div.button:first-child {border-top:2px solid rgb(50,50,50)}
	.bright #floating-key div.button:first-child {border-top:2px solid rgb(200,200,200)}
	.pink #floating-key div.button:first-child {border-top:2px solid rgb(180,0,180)}
#toggle-floating-key {bottom:.2em; text-align:center; width:2.2em; height:2.3em; margin:0; padding:.1em}
#SNS-floating {width:100%; text-align:center}
#SNS-floating .SNS-img {box-sizing:border-box; padding:0; margin:0; width:1.8em; height:1.8em; border:1px gray solid; border-left:0; cursor:pointer}
	#SNS-floating .SNS-img:first-child {border-left:1px gray solid}
#floating-key, #toggle-floating-key {font-size:1.1em; color:wheat; z-index:20000; position:fixed; right:.2em;}
	.bright #floating-key, .bright #toggle-floating-key {color:black}
	.pink #floating-key, .pink #toggle-floating-key {color:wheat}

@media all and (min-width:600px) {
	.multireco .reco {width:33%}
	#container {font-size:15.5px}
}
@media all and (min-width:701px) {
	.multireco .reco {width:49%}
	#container {margin-left:14.9em; font-size:16px}
	#sidebar {margin:0; position:fixed; left:0; top:0; bottom:0; width:15em}
	#sidebar-dragger {display:none}
	#change-style {margin-top:0}
	#my-id {margin-left:0}
	.side2 {padding:.5em}
	.rC.fixed {width:600px; border-right:.15em solid white}
	.rC.instagram.fixed, .rC.eveElse.fixed {width:360px}
	.lyrics {text-align:right}
	::-webkit-scrollbar {width:11px; height:11px}
}
@media all and (min-width:901px) {
	.multireco .reco {width:33%}
	#container {margin-left:19.9em; font-size:16.5px}
	#sidebar {width:20em}
}
@media all and (min-width:1210px) {
	.multireco .reco {width:24%}
	#container {font-size:17px}
}

@media all and (min-height:500px) {
	#fuzzy-search-list, #table-of-recos-list {max-height:430px}
}
</style>
</head>
<body>
<data id="data-myCatList">{--myCatList--}</data>
<data id="data-CatList">{--CatList--}</data>
<div class="block-touch" id="block-touch" style="display:none"></div>
<div class="block-touch-exit exit" id="block-touch-exit" style="display:none; z-index:31000; position:fixed" onclick="$('#block-touch, #block-touch-exit').hide()"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
<div id="container">
<div id="sidebar-dragger">
	<svg id="sidebar-toggle"><g style="stroke:white;stroke-width:20%; stroke-linecap:round"><line x1="20%" y1="50%" x2="80%" y2="50%"></line><line x1="80%" y1="50%" x2="50%" y2="20%"></line><line x1="80%" y1="50%" x2="50%" y2="80%"></line></g></svg>
	<div id="sidebar-dragger-in"></div>
</div>
<div id="sidebar">
	<div id="user-noti"></div>
	<div id="catList"></div>
	<div class="right">
		<div class="button" id="change-catList-order">[--Change orders--]</div>
		<div class="button" id="change-catList-order-ok">[--OK--]</div>
		<div class="button" id="change-catList-order-cancel">[--Cancel--]</div>
	</div>
</div><!-- div#sidebar -->
<div id="fuzzy-search-container" style="display:none">
	<div class="fs-name">Go: Fuzzy search</div>
	<div class="move" style="z-index:20000; position:absolute; display:inline-block; left:0; top:0; width:2.1em; height:2.1em; line-height:1.0; text-align:center; cursor:pointer; border:2px rgb(80, 80, 80) solid; background-color:rgb(30,30,30); color:white"><svg style="display:inline-block; width:100%; height:100%"><g style="stroke:white; stroke-width:10%; stroke-linecap:round">
		<line x1="10%" y1="50%" x2="90%" y2="50%"></line>
		<line x1="10%" y1="50%" x2="20%" y2="40%"></line>
		<line x1="10%" y1="50%" x2="20%" y2="60%"></line>
		<line x1="80%" y1="40%" x2="90%" y2="50%"></line>
		<line x1="80%" y1="60%" x2="90%" y2="50%"></line>
		<line x1="50%" y1="10%" x2="50%" y2="90%"></line>
		<line x1="50%" y1="10%" x2="40%" y2="20%"></line>
		<line x1="50%" y1="10%" x2="60%" y2="20%"></line>
		<line x1="40%" y1="80%" x2="50%" y2="90%"></line>
		<line x1="60%" y1="80%" x2="50%" y2="90%"></line>
	</g></svg></div>
	<div id="fuzzy-search" contenteditable="true"></div>
	<div id="fuzzy-search-list"></div>
	<div class="reset" style="z-index:20000; position:absolute; display:inline-block; right:1.8em; top:0; width:1.8em; height:1.8em; line-height:1.0; text-align:center; cursor:pointer; border:2px rgb(80, 80, 80) solid; background-color:rgb(30,30,30); color:white"><svg style="display:inline-block; width:100%; height:100%"><g style="stroke:white; stroke-width:10%; stroke-linecap:round">
		<line x1="20%" y1="30%" x2="80%" y2="30%"></line>
		<line x1="80%" y1="30%" x2="80%" y2="70%"></line>
		<line x1="80%" y1="70%" x2="20%" y2="70%"></line>
		<line x1="20%" y1="70%" x2="30%" y2="60%"></line>
		<line x1="20%" y1="70%" x2="30%" y2="80%"></line>
	</g></svg></div>
	<div class="exit" onclick="$window.trigger({type:'keydown', keyCode:'G'.charCodeAt(0)})"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
</div><!-- div#fuzzy-search-container -->
<div id="table-of-recos-container" style="display:none">
	<div class="fs-name">Table of Recos</div>
	<div class="move" style="z-index:20000; position:absolute; display:inline-block; left:0; top:0; width:2.1em; height:2.1em; line-height:1.0; text-align:center; cursor:pointer; border:2px rgb(80, 80, 80) solid; background-color:rgb(30,30,30); color:white"><svg style="display:inline-block; width:100%; height:100%"><g style="stroke:white; stroke-width:10%; stroke-linecap:round">
		<line x1="10%" y1="50%" x2="90%" y2="50%"></line>
		<line x1="10%" y1="50%" x2="20%" y2="40%"></line>
		<line x1="10%" y1="50%" x2="20%" y2="60%"></line>
		<line x1="80%" y1="40%" x2="90%" y2="50%"></line>
		<line x1="80%" y1="60%" x2="90%" y2="50%"></line>
		<line x1="50%" y1="10%" x2="50%" y2="90%"></line>
		<line x1="50%" y1="10%" x2="40%" y2="20%"></line>
		<line x1="50%" y1="10%" x2="60%" y2="20%"></line>
		<line x1="40%" y1="80%" x2="50%" y2="90%"></line>
		<line x1="60%" y1="80%" x2="50%" y2="90%"></line>
	</g></svg></div>
	<div id="table-of-recos" contenteditable="true"></div>
	<div id="table-of-recos-list"></div>
	<div class="reset" style="z-index:20000; position:absolute; display:inline-block; right:1.8em; top:0; width:1.8em; height:1.8em; line-height:1.0; text-align:center; cursor:pointer; border:2px rgb(80, 80, 80) solid; background-color:rgb(30,30,30); color:white"><svg style="display:inline-block; width:100%; height:100%"><g style="stroke:white; stroke-width:10%; stroke-linecap:round">
		<line x1="20%" y1="30%" x2="80%" y2="30%"></line>
		<line x1="80%" y1="30%" x2="80%" y2="70%"></line>
		<line x1="80%" y1="70%" x2="20%" y2="70%"></line>
		<line x1="20%" y1="70%" x2="30%" y2="60%"></line>
		<line x1="20%" y1="70%" x2="30%" y2="80%"></line>
	</g></svg></div>
	<div class="exit" onclick="$window.trigger({type:'keydown', keyCode:'T'.charCodeAt(0)})"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
</div><!-- div#table-of-recos-container -->
<div id="goto-cats-container" style="display:none">
	<div class="fs-name">Go to Cats</div>
	<div class="move" style="z-index:20000; position:absolute; display:inline-block; left:0; top:0; width:2.1em; height:2.1em; line-height:1.0; text-align:center; cursor:pointer; border:2px rgb(80, 80, 80) solid; background-color:rgb(30,30,30); color:white"><svg style="display:inline-block; width:100%; height:100%"><g style="stroke:white; stroke-width:10%; stroke-linecap:round">
		<line x1="10%" y1="50%" x2="90%" y2="50%"></line>
		<line x1="10%" y1="50%" x2="20%" y2="40%"></line>
		<line x1="10%" y1="50%" x2="20%" y2="60%"></line>
		<line x1="80%" y1="40%" x2="90%" y2="50%"></line>
		<line x1="80%" y1="60%" x2="90%" y2="50%"></line>
		<line x1="50%" y1="10%" x2="50%" y2="90%"></line>
		<line x1="50%" y1="10%" x2="40%" y2="20%"></line>
		<line x1="50%" y1="10%" x2="60%" y2="20%"></line>
		<line x1="40%" y1="80%" x2="50%" y2="90%"></line>
		<line x1="60%" y1="80%" x2="50%" y2="90%"></line>
	</g></svg></div>
	<textarea id="goto-cats" type="text"></textarea>
	<div id="goto-cats-list"></div>
	<div class="reset" style="z-index:20000; position:absolute; display:inline-block; right:1.8em; top:0; width:1.8em; height:1.8em; line-height:1.0; text-align:center; cursor:pointer; border:2px rgb(80, 80, 80) solid; background-color:rgb(30,30,30); color:white"><svg style="display:inline-block; width:100%; height:100%"><g style="stroke:white; stroke-width:10%; stroke-linecap:round">
		<line x1="20%" y1="30%" x2="80%" y2="30%"></line>
		<line x1="80%" y1="30%" x2="80%" y2="70%"></line>
		<line x1="80%" y1="70%" x2="20%" y2="70%"></line>
		<line x1="20%" y1="70%" x2="30%" y2="60%"></line>
		<line x1="20%" y1="70%" x2="30%" y2="80%"></line>
	</g></svg></div>
	<div class="exit" onclick="$window.trigger({type:'keydown', keyCode:'C'.charCodeAt(0)})"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
</div><!-- div#goto-cats-container -->
<div id="new-reco" style="display:none">
	<form>
	<label for="input-uri">URI <span class="desc">([--required--])</span></label>
		<textarea class="single-line" id="input-uri" name="uri" placeholder="[--placeholder URI--]" type="text" tabindex="1"></textarea>
	<label for="input-title">[--Title--]</label>
		<div id="def-titles"></div>
		<textarea class="single-line" id="input-title" name="title" placeholder="[--placeholder Title--]" type="text" tabindex="2"></textarea>
	<label for="input-cats">[--Categories--]</label>
		<div id="def-cats"><div class="def-cat replace-cat">[--Indifferent--]</div> <div class="def-cat replace-cat">[--Later--]</div> <div id="add-cat" class="def-cat add-txt">;</div> <div id="sub-cat" class="def-cat add-txt">--</div> <div id="delete-cat" class="def-cat delete-cat">[--Delete--]</div></div>
		<textarea class="single-line" id="input-cats" name="cats" placeholder="[--placeholder Category--]" type="text" tabindex="3"></textarea>
		<div class="fs-container" id="cat-fs-container" style="display:none">
			<div id="cat-fs-list"></div>
			<div class="exit" onclick="$(this).parent().hide()"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
		</div>
		<div id="show-URI"></div>
	<label for="input-val">[--Points--]</label>
		<input id="input-val" name="val" placeholder="(ex: 7.5/10)" type="text" tabindex="4"/>
		<span class="upDown" id="input-val-down">&lt;</span>
		<span class="upDown" id="input-val-up">&gt;</span>
		<div id="input-val-stars"></div>
	<div id="error-msg"></div>
	<div class="buttons">
		<div class="button" id="button-reco" tabindex="7">[--Reco--]</div>
		<div class="button" id="button-edit" tabindex="8">[--Edit--]</div>
		<div class="button" id="button-del" tabindex="9" style="background:#ff7600">[--Del--]</div>
		<div class="button left" id="button-close" tabindex="5" onclick="m.closeNewReco()">[--Close--]</div>
		<div class="button left" id="button-back" tabindex="6">[--Back--]</div>
		<div class="cBoth"></div>
	</div>
	<label for="input-desc">[--Description--]</label>
		<div id="def-cmds"><div class="def-cmd">#related</div> <div class="def-cmd">#lyrics</div></div>
		<div id="def-descs"></div>
		<textarea class="multi-line" id="input-desc" name="desc" placeholder="[--placeholder Description--]" tabindex="10"></textarea>
	<label for="input-cmt">[--Comment--]</label>
		<textarea class="multi-line" id="input-cmt" name="cmt" placeholder="[--placeholder Comment--]" tabindex="11"></textarea>
	<div id="my-reco"></div>
	<div class="exit" style="margin:-1em -.2em 0 0" onclick='$button_close.trigger("click")'><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
	</form>
</div><!-- div#new-reco -->
<div id="multireco-cats-container" style="display:none">
	<label for="multireco-input-cats">[--Multireco Categories--]</label>
		<div id="multireco-def-cats"><div class="def-cat replace-cat">[--Indifferent--]</div> <div class="def-cat replace-cat">[--Later--]</div> <div class="def-cat add-txt" id="multireco-add-cat">;</div> <div class="def-cat add-txt" id="multireco-sub-cat">--</div> <div class="def-cat delete-cat" id="multireco-delete-cat">[--Delete--]</div></div>
		<textarea class="single-line" id="multireco-input-cats" name="multireco-cats" placeholder="Category--Sub category--Subsub category ; Another category ; ..." type="text"></textarea>
		<div class="fs-container" id="multireco-cat-fs-container" style="display:none">
			<div id="multireco-cat-fs-list"></div>
			<div class="exit" onclick="$(this).parent().hide()"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
		</div>
	<div class="exit" onclick="$window.trigger({type:'keydown', keyCode:'M'.charCodeAt(0)})"><svg><g style="stroke:white;stroke-width:23%"><line x1="20%" y1="20%" x2="80%" y2="80%"></line><line x1="80%" y1="20%" x2="20%" y2="80%"></line></g>✖</svg></div>
</div><!-- div#multireco-cats-container -->
<div class="side2" id="javascript-disable">
	Your javascript on this page is disabled. Please enable javascipt to see this page properly.
</div><!-- div#javascript-disable -->
<div class="side2" style="padding:.5em"></div>
<div class="side2" id="change-style">
	<form><button type="button" onclick="m.resetStyle()" style="width:auto; padding:0 .5em">Reset style</button></form>
	<form>
		<input id="button-Dark" type="radio" name="mode" value="Dark" onclick="m.Cmode(this.value)"><label for="button-Dark" style="display:inline-block; background:black; color:white; border:2px solid rgb(150,150,150); padding:0.1em 0.2em">Dark</label></input>
		<input id="button-Bright" type="radio" name="mode" value="Bright" onclick="m.Cmode(this.value)"><label for="button-Bright" style="display:inline-block; background:white; color:black; border:2px solid rgb(150,150,150); padding:0.1em 0.2em">Bright</label></input>
		<input id="button-Pink" type="radio" name="mode" value="Pink" onclick="m.Cmode(this.value)"><label for="button-Pink" style="display:inline-block; background:rgb(180,0,97); color:white; border:2px solid rgb(150,150,150); padding:0.1em 0.2em">Pink</label></input>
	</form>
	<form><input class="bold" id="input-font-family" type="text" name="font" value="맑은 고딕" style="font-family:'맑은 고딕'; font-size:1.2em; width:73px; height:23px; text-align:center" onchange="m.CfontFamily(this.value)"></input></form>
	<form><button type="button" onclick="m.CfontSize(-0.1)" style="font-size:1em">A</button><button type="button" onclick="m.CfontSize(0.1)" style="font-size:1.4em">A</button></form>
	<form><button type="button" onclick="m.ClineHeight(-1)" style="font-size:1em">=</button><button type="button" onclick="m.ClineHeight(1)" style="font-size:1.6em">=</button></form>
	<div class="deviceInfo"></div>
</div><!-- div#change-style -->
<div class="side2" id="foot">&nbsp; &nbsp; &nbsp; [--version--] [--foot--]<br><a href="https://kipid.tistory.com/entry/Introducing-what-we-are-making-Recoevenet">Introducing what we are making : Recoeve.net</a><br><br>
<div class="side2" id="promoting">
	<div class="p">
	For the usage examples, visit my page
	<ul>
	<li><a target="_blank" href="/user/kipid/mode/multireco?cat=%5BMy%20Blog%5D--%5BMusic%2FBreak%5D--%EC%B8%84%EC%B8%84">[My Blog]--[Music/Break]--츄츄 (My Pet) of kipid's Recoeve.net (Multireco mode)</a></li>
	<li><a target="_blank" href="/user/kipid/mode/multireco?cat=%5BMusic%2FBreak%5D--%EB%82%A8%EA%B7%9C%EB%A6%AC">[Music/Break]--남규리 | Nam Gyuri (Actor of Korea) of kipid's Recoeve.net (Multireco mode)</a></li>
	<li><a target="_blank" href="/user/kipid/mode/multireco?cat=%5BMusic%2FBreak%5D--K-Pop">[Music/Break]--K-Pop of kipid's Recoeve.net (Multireco mode)</a></li>
	<li><a target="_blank" href="/user/kipid/mode/multireco?cat=%5BMusic%2FBreak%5D--Pop">[Music/Break]--Pop of kipid's Recoeve.net (Multireco mode)</a></li>
	</ul>
	</div>
	<div class="rC" style="margin:1em 0"><div class="rSC"><iframe delayed-src="https://www.youtube.com/embed/Kb2XRGWtRFE" title="YouTube video player" frameborder="0" allowfullscreen></iframe></div></div>
</div>
	<div class="button" id="choose-lang">▼ Language/언어/語言</div>
	<data id="data-lang">en	ko	zh	ja	de	fr	es	hi	ar	ru
English/영어/英語/en	Korean/한국어/韓語/ko	Chinese/중국어(번체)/中文/zh	Japanese/일본어/日語/ja	deutsche Sprache/독일어/Deutsch/de	Français/French/프랑스어/佛語/fr	Español/Spanish/스페인어/西班牙語/es	हिन्दी/Hindi/힌디어/印地语/hi	اللغة العربية/ar	Русский/Russian/러시아어/俄語/ru</data>
	<div id="choose-lang-list" style="border:solid 1px gray; display:none"></div>
</div><!-- div#foot -->
<div class="side2">
	[--Short Keys--]
	<ul id="shortkeys"></ul>
</div>
<div class="side2" id="head">
	<div class="button" id="my-id"></div>
	<a class="a-log-out" href="/account/log-out" onclick="return m.a_log_out(event,this)">[--Log out--]</a>
	<a class="a-log-in" href="/account/log-in" onclick="return m.a_log_in(event,this)">[--Log in--]</a>
	<div class="button button-Go" id="out-focus" onclick="$window.trigger({type:'keydown', keyCode:'G'.charCodeAt(0)})">[--Fuzzy Search--] [--_G_o (FS)--]</div>
	<div class="button button-goto-cats" onclick="$window.trigger({type:'keydown', keyCode:'C'.charCodeAt(0)})">[--Go to _C_ats--]</div>
	<div class="button button-mode button-neighbors-mode" onclick="$window.trigger({type:'keydown', keyCode:'B'.charCodeAt(0)})">[--Neigh_b_ors mode--]</div>
	<div class="button button-mode button-multireco-mode" onclick="$window.trigger({type:'keydown', keyCode:'M'.charCodeAt(0)})">[--_M_ultireco mode--]</div>
	<div class="button button-new-reco" onclick="$window.trigger({type:'keydown', keyCode:'N'.charCodeAt(0)})">[--_N_ew reco--]</div>
</div><!-- div#head -->
<div class="side2" id="subCats">
	<span class="point-range-result">0~10/10</span>
	<div class="point-range">
		<div class="point-range-bar"></div><div class="point-range-right"></div><div class="point-range-left"></div>
	</div>
	<div class="button enabled" id="show-recos-without-points">[--Show recos without points--]</div>
	<div class="button" id="show-only-unrecoed">[--Show only unrecoed on mine--]</div>
	<div class="cBoth"></div>
</div>
<div class="side2"><div class="numbers-of-recos"></div></div>
<div class="side2" id="headPlay">
	<div style="font-size:.8em">[--When you just listen to music without seeing videos, to save data transfer fee and battery, hide list play with the below toggle button.--]</div>
	<div class="button enabled" id="toggle-reco-list-play" onclick="m.fsToRs.toggleRecoListPlay()">[--Toggle reco list play--]</div>
	<div id="playlist-container">
		<div id="uri-rendered-container">
			<div id="eveElse-uri-rendered">
				<div id="eveElse"></div>
			</div>
			<div class="rC" id="rC-youtube-uri-rendered" style="display:none">
				<div class="rSC"><div id="youtube"></div></div>
				<div class="pc"><span onclick="m.togglePosition(this)">▲ [--stick to the left top--]</span></div>
			</div>
		</div>
		<div class="button" onclick="m.fsToRs.Preceding()">[--Preceding--]</div>
		<div class="button" onclick="m.fsToRs.Following()">[--Following--]</div>
		<div class="button" onclick="m.fsToRs.shuffle()">[--Shuffle--]</div>
		<div class="button enabled" onclick="m.fsToRs.autoSkip(this)">[--Auto skip--]</div>
		<div class="button" onclick="m.fsToRs.toggleLoop(this)">[--Loop--]</div>
		<div class="button" onclick="m.fsToRs.toggleOneLoop(this)">[--One-loop--]</div>
		<div class="button button-ToR" onclick="$window.trigger({type:'keydown', keyCode:'T'.charCodeAt(0)})">[--_T_ofR--]</div>
		<div id="reco-playing"></div>
	</div>
</div><!-- div#headPlay -->
<div class="side2"><div class="numbers-of-recos"></div></div>
<div class="side2" id="contents"></div><!-- div#contents -->
<div id="floating-key"></div>
<div class="button" id="toggle-floating-key" onclick="m.toggleFK()">▲</div>
</div><!-- div#container -->
</body>
<div id="scripts"></div>
<script>
(function (m, $, undefined) {
$("#javascript-disable").hide();
m.kakaoInitDo=function () {
	if (typeof Kakao!=='undefined') {
		clearInterval(m.kakaoInit);
		if (!Kakao.isInitialized()) {
			Kakao.init('f076e37310bc101c5c50c9e2714b59ca');
		}
	}
};
m.kakaoInit=setInterval(m.kakaoInitDo, 2048);



/* Prerequisite */
//////////////////
// Variables
//////////////////
$block_touch=$("#block-touch");
$block_touch_exit=$("#block-touch-exit");
$data_myCatList=$("#data-myCatList");
$data_CatList=m.myPage?$data_myCatList:$("#data-CatList");
$choose_lang=$("#choose-lang");
$data_lang=$("#data-lang");
$choose_lang_list=$("#choose-lang-list");

$user_noti=$("#user-noti");
$my_id=$("#my-id");

$sidebar_dragger=$("#sidebar-dragger");
$sidebar_toggle=$("#sidebar-toggle");
$sidebar_dragger_in=$("#sidebar-dragger-in");
$sidebar=$("#sidebar");
$sidebar_exit=$("#sidebar-exit");
$catList=$("#catList");
$change_catList_order=$("#change-catList-order");
$change_catList_order_ok=$("#change-catList-order-ok");
$change_catList_order_cancel=$("#change-catList-order-cancel");

$new_reco=$("#new-reco");

$headPlay=$("#headPlay");
$toggle_reco_list_play=$("#toggle-reco-list-play");
$playlist_container=$("#playlist-container");
$uri_rendered_container=$("#uri-rendered-container");
$eveElse_uri_rendered=$("#eveElse-uri-rendered");
$rC_youtube_uri_rendered=$("#rC-youtube-uri-rendered");
$eveElse=$("#eveElse");
$youtube=$("#youtube");
$video=$("#video");
$reco_playing=$("#reco-playing");

$input_uri=$("#input-uri");
$def_titles=$("#def-titles");
$input_title=$("#input-title");
$def_cats=$("#def-cats");
$input_cats=$("#input-cats");
$def_descs=$("#def-descs");
$input_desc=$("#input-desc");
$input_cmt=$("#input-cmt");
$input_val=$("#input-val");

$error=$("#error-msg");

$button_reco=$("#button-reco");
$button_edit=$("#button-edit");
$button_del=$("#button-del");
$button_back=$("#button-back");
$button_close=$("#button-close");
$button_new_reco=$(".button-new-reco");

$a_log_in=$(".a-log-in");
$a_log_out=$(".a-log-out");

$out_focus=$("#out-focus");
$fuzzy_search_container=$("#fuzzy-search-container");
$fuzzy_search_container_move=$("#fuzzy-search-container>.move");
$fuzzy_search=$("#fuzzy-search");
$fuzzy_search_list=$("#fuzzy-search-list");

$table_of_recos_container=$("#table-of-recos-container");
$table_of_recos_container_move=$("#table-of-recos-container>.move");
$table_of_recos=$("#table-of-recos");
$table_of_recos_list=$("#table-of-recos-list");

$goto_cats_container=$("#goto-cats-container");
$goto_cats_container_move=$("#goto-cats-container>.move");
$goto_cats=$("#goto-cats");
$goto_cats_list=$("#goto-cats-list");

$cat_fs_container=$("#cat-fs-container");
$cat_fs_list=$("#cat-fs-list");

$multireco_cats_container=$("#multireco-cats-container");
$multireco_def_cats=$("#multireco-def-cats");
$multireco_input_cats=$("#multireco-input-cats");
$multireco_cat_fs_container=$("#multireco-cat-fs-container");
$multireco_cat_fs_list=$("#multireco-cat-fs-list");

$show_recos_without_points=$("#show-recos-without-points");
m.showRWOP=true; // RWOP : Reco WithOut Point
$show_only_unrecoed=$("#show-only-unrecoed");

$numbers_of_recos=$(".numbers-of-recos");

$subCats=$("#subCats");
$contents=$("#contents");
$scripts=$("#scripts");

$document=$(document);
$html=$("html");
$title=$("title");
$body=$("body");

// Changing Styles of Recoeve.net
m.mode="Dark";
m.fontFamily="맑은 고딕";
if (window.innerWidth<600) {
	m.fontSize=11;
}
else if (window.innerWidth<701) {
	m.fontSize=12;
}
else if (window.innerWidth<901) {
	m.fontSize=13;
}
else if (window.innerWidth<1210) {
	m.fontSize=14;
}
else {
	m.fontSize=15;
}
m.lineHeight10=16;
m.defaultStyles={mode:m.mode, fontFamily:m.fontFamily, fontSize:m.fontSize, lineHeight10:m.lineHeight10};
m.$deviceInfo=$(".deviceInfo");
m.$container=$("#container");

m.printDeviceInfo=function () {
	if (m.$deviceInfo) {
		m.$deviceInfo.html(`Mode: ${m.mode}; Font: ${m.fontFamily}; font-size: ${(m.fontSize).toFixed(1)}px; line-height: ${(m.lineHeight10/10).toFixed(1)};<br>width: ${m.browserWidth}, height: ${window.innerHeight}`);
	}
};

m.resetStyle=function () {
	m.Cmode(m.defaultStyles.mode);
	m.CfontFamily(m.defaultStyles.fontFamily);
	m.CfontSize(m.defaultStyles.fontSize-m.fontSize);
	m.ClineHeight(m.defaultStyles.lineHeight10-m.lineHeight10);
	if (!$floating_key.is(":visible")) {
		m.toggleFK();
	}
}
m.Cmode=function (modeI) {
	m.$container.removeClass("bright");
	m.$container.removeClass("pink");
	switch (modeI) {
	case "Bright":
		m.$container.addClass("bright");
		break;
	case "Pink":
		m.$container.addClass("pink");
		break;
	default:
		// Dark
		break;
	}
	m.mode=modeI;
	m.printDeviceInfo();
	if (m.mode===m.defaultStyles.mode) {
		m.docCookies.removeItem("m.mode", "/");
	}
	else {
		m.docCookies.setItem("m.mode", m.mode, m.expire, "/");
	}
	return true;
};
m.CfontFamily=function (font) {
	m.$container.css({fontFamily:font});
	m.fontFamily=font;
	m.printDeviceInfo();
	if (m.fontFamily===m.defaultStyles.fontFamily) {
		m.docCookies.removeItem("m.fontFamily", "/");
	}
	else {
		m.docCookies.setItem("m.fontFamily", m.fontFamily, m.expire, "/");
	}
	return true;
};
m.CfontSize=function (increment) {
	if (increment.constructor===Number&&!isNaN(increment)) {
		m.fontSize+=increment;
		if (m.fontSize<5) {
			m.fontSize=5;
		}
		else if (m.fontSize>33) {
			m.fontSize=33;
		}
		m.$container.css({"font-size":m.fontSize.toFixed(1)+"px"});
		$window.trigger("resize");
		m.printDeviceInfo();
		if (m.fontSize===m.defaultStyles.fontSize) {
			m.docCookies.removeItem("m.fontSize", "/");
		}
		else {
			m.docCookies.setItem("m.fontSize", m.fontSize.toFixed(1), m.expire, "/");
		}
		return true;
	}
	return false;
};
m.ClineHeight=function (increment) {
	if (increment.constructor===Number&&!isNaN(increment)) {
		m.lineHeight10+=increment;
		if (m.lineHeight10<10) {
			m.lineHeight10=10;
			return false;
		}
		else if (m.lineHeight10>25) {
			m.lineHeight10=25;
			return false;
		}
		m.$container.attr("style", `line-height:${(m.lineHeight10/10).toFixed(1)}`);
		m.printDeviceInfo();
		if (m.lineHeight10===m.defaultStyles.lineHeight10) {
			m.docCookies.removeItem("m.lineHeight10", "/");
		}
		else {
			m.docCookies.setItem("m.lineHeight10", m.lineHeight10, m.expire, "/");
		}
		return true;
	}
	return false;
};

let cookieItem;
cookieItem=m.docCookies.getItem("m.mode");
if (cookieItem!==null) {
	m.Cmode(cookieItem);
}
else {
	m.Cmode("Dark");
}
$(`#button-${m.mode}`).prop('checked', true);
cookieItem=m.docCookies.getItem("m.fontFamily");
if (cookieItem!==null) {
	m.CfontFamily(cookieItem);
	$(`#input-font-family`)[0].value=m.fontFamily;
}
cookieItem=m.docCookies.getItem("m.fontSize");
if (cookieItem!==null) {
	m.CfontSize(Number(cookieItem)-15);
}
cookieItem=m.docCookies.getItem("m.lineHeight10");
if (cookieItem!==null) {
	m.ClineHeight(Number(cookieItem)-16);
}

m.a_log_in=function (e, elem) {
	let fullPath=m.pathOfCat(m.currentCat, m.recoMode, m.lang, m.hashURI, m.args);
	let href=`/account/log-in?goto=${encodeURIComponent(fullPath)}`;
	if (e&&e.which===2) {
		$a_log_in.attr("href", href);
		return true;
	}
	else {
		window.location.href=href;
		return false;
	}
};
m.a_log_out=function (e, elem) {
	let fullPath=m.pathOfCat(m.currentCat, m.recoMode, m.lang, m.hashURI, m.args);
	let href=`/account/log-out?goto=${encodeURIComponent(fullPath)}`;
	if (e&&e.which===2) {
		$a_log_out.attr("href", href);
		return true;
	}
	else {
		window.location.href=href;
		return false;
	}
}

m.toggleNeighborsMode=function () {
	if ($button_neighbors_mode.hasClass("enabled")) {
		m.recoMode="";
		$button_mode.removeClass("enabled");
		m.showRecosOnCat();
		$playlist_container.show();
		$toggle_reco_list_play.addClass("enabled");
	}
	else {
		m.recoMode="neighbors";
		$button_mode.removeClass("enabled");
		$button_neighbors_mode.addClass("enabled");
		$playlist_container.hide();
		$toggle_reco_list_play.removeClass("enabled");
	}
	m.openCat(m.currentCat);
}

m.toggleMultirecoMode=function () {
	if ($button_multireco_mode.hasClass("enabled")) {
		m.recoMode="";
		$button_mode.removeClass("enabled");
		$contents.removeClass("multireco");
		if (!m.myPage) {
			$multireco_cats_container.hide();
		}
	}
	else {
		m.recoMode="multireco";
		$button_mode.removeClass("enabled");
		$button_multireco_mode.addClass("enabled");
		$contents.addClass("multireco");
		if (!m.myPage) {
			$multireco_cats_container.show();
			$multireco_input_cats[0].value=m.currentCat;
		}
	}
	m.openCat(m.currentCat);
};

m.toggleNewReco=function () {
	if ($button_new_reco.hasClass("enabled")) {
		m.newRecoOn=false;
		$button_new_reco.removeClass("enabled");
		$input_uri[0].disabled=true;
		$out_focus.focus();
		$new_reco.hide();
		window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
		$window.off("scroll.stop");
	}
	else {
		m.newRecoOn=true;
		$button_new_reco.addClass("enabled");
		$input_uri[0].disabled=false;
		$new_reco.show();
		window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
		let cat=m.currentCat;
		if (cat&&($input_cats[0].value===""||$input_title[0].value===""||$input_uri[0].value==="")) {
			$input_cats[0].value=cat;
		}
		m.wST=$window.scrollTop();
		$window.on("scroll.stop", function (e) {
			e.preventDefault();
			$window.scrollTop(m.wST);
		});
		$input_uri.focus();
		$input_uri.trigger("keyup");
	}
};

m.showOnlyUnrecoed=false;
if (m.myPage) {
	$show_only_unrecoed.hide();
}
else {
	$show_only_unrecoed.on("click", function () {
		if ($show_only_unrecoed.hasClass("enabled")) {
			$show_only_unrecoed.removeClass("enabled");
			m.showOnlyUnrecoed=false;
		}
		else {
			$show_only_unrecoed.addClass("enabled");
			m.showOnlyUnrecoed=true;
		}
		m.openCat(m.currentCat);
	});
}

m.catList=[];
m.myCatList=m.myPage?m.catList:[];
m.catUriList=[];
m.userRecos={};
m.myRecos=m.myPage?m.userRecos:{};
m.timeout={};
m.maxShowReco=20;

m.fsGotoCats=[];
m.fsGotoCats[0]=m.fsGotoCats[1]=[];
m.fsGotoCats[0].k=m.fsGotoCats[1].k=-1;
m.fsGotoCats.fullList=[];
m.fsGotoCats.$fs=$goto_cats;
m.fsGotoCats.$fsl=$goto_cats_list;

m.fsCat=[];
m.fsCat[0]=m.fsCat[1]=[];
m.fsCat[0].k=m.fsCat[1].k=-1;
m.fsCat.fullList=[];
m.fsCat.$fs=$input_cats;
m.fsCat.$fsl=$cat_fs_list;

m.fsGo=[];
m.fsGo[0]=m.fsGo[1]=[];
m.fsGo.fullList=[];
m.fsGo.$fs=$fuzzy_search;
m.fsGo.$fsl=$fuzzy_search_list;

m.fsToRs=[];
m.fsToRs[0]=m.fsToRs[1]=[];
m.fsToRs.fixed=false;
m.fsToRs.fullList=[];
m.fsToRs.$fs=$table_of_recos;
m.fsToRs.$fsl=$table_of_recos_list;
m.fsToRs.$fsl.viewAndScroll=function ($next) {
	let $fsl=m.fsToRs.$fsl;
	if ($next.exists()) {
		if ($table_of_recos_container.is(":visible")) {
			$fsl.scrollTop($fsl.scrollTop()+$next.offset().top-$fsl.offset().top-100);
		}
		else {
			$table_of_recos_container.show();
			$fsl.scrollTop($fsl.scrollTop()+$next.offset().top-$fsl.offset().top-100);
			$table_of_recos_container.hide();
		}
	}
	else {
		if ($table_of_recos_container.is(":visible")) {
			$fsl.scrollTop(0);
		}
		else {
			$table_of_recos_container.show();
			$fsl.scrollTop(0);
			$table_of_recos_container.hide();
		}
	}
};
m.fsToRs.skip=true;
m.fsToRs.oneLoop=false;
m.fsToRs.loop=false;

YT=undefined;
m.YtPlayer=null;
m.YtAPILoaded=false;

m.neighbors={};
	// m.neighbors[cat_from]={down:true};
	// m.neighbors[cat_from][user_i]={}
	// m.neighbors[cat_from][user_i][cat_i]={sumSim:sumSim, nSim:nSim, simAvg100:simAvg100, tUpdate:tUpdate};



////////////////////////////////////////////////////
// Get neighbors
////////////////////////////////////////////////////
m.getNeighbors=function () {
	if (m.neighbors[m.currentCat]&&m.neighbors[m.currentCat].down) {
		let req="user_i\tcat_i";
		let neighbors=m.neighbors[m.currentCat]
		for (let p in neighbors) {
			if (p!=="down") {
				for (let q in neighbors[p]) {
					req+="\n"+p+"\t"+q;
				}
			}
		}
		$.ajax({
			type:"POST", url:m.userPath+"/get-URI-cats-val", data:req
			, dataType:"text"
		}).done(function (resp) {
			$numbers_of_recos.html(resp);
		});
	}
	else {
		let req="cat_from\n"+m.currentCat;
		$.ajax({
			type:"POST", url:m.userPath+"/get-Neighbors", data:req
			, dataType:"text"
		}).done(function (resp) {
			let cat_froms=m.strToJSON(req);
			for (let i=1;i<cat_froms.length;i++) {
				m.neighbors[cat_froms[i].cat_from]={down:true};
			}
			let res=m.strToJSON(resp);
			for (let i=1;i<res.length;i++) {
				m.neighbors[res[i].cat_from][res[i].user_i]={};
				m.neighbors[res[i].cat_from][res[i].user_i][res[i].cat_i]=res[i];
			}
			console.log(m.neighbors);
		});
	}
};



////////////////////////////////////////////////////
// Floating key
////////////////////////////////////////////////////
$floating_key=$("#floating-key");
$toggle_floating_key=$("#toggle-floating-key");
$floating_key.html(`<div id="button-hideFK" class="button" onclick="m.hideFK()">▼ Hide</div>
	<span class="point-range-result">0~10/10</span>
	<div class="point-range-con">
		<div class="point-range">
			<div class="point-range-bar"></div><div class="point-range-right"></div><div class="point-range-left"></div>
		</div>
	</div>
	<div class="button" onclick="$window.trigger({type:'keydown', keyCode:'U'.charCodeAt(0)})">
		[--Block to_u_ch--]
	</div>
	${m.myIndex===""?`<div class="button" onclick="$window.trigger({type:'keydown', keyCode:'I'.charCodeAt(0)})">
		[--Log _i_n--]
	</div>`:`<div class="button" onclick="$window.trigger({type:'keydown', keyCode:'O'.charCodeAt(0)})">
		[--Log _o_ut--]
	</div>`}
	<div class="button button-mode button-neighbors-mode" onclick="$window.trigger({type:'keydown', keyCode:'B'.charCodeAt(0)})">
		[--Neigh_b_ors mode--]
	</div>
	<div class="button button-mode button-multireco-mode" onclick="$window.trigger({type:'keydown', keyCode:'M'.charCodeAt(0)})">
		[--_M_ultireco mode--]
	</div>
	<div class="button button-Go" style="width:4.5em; border-right:none" onclick="$window.trigger({type:'keydown', keyCode:'G'.charCodeAt(0)})">
		[--_G_o (FS)--]
	</div>
	<div class="button button-ToR" style="width:4.5em" onclick="$window.trigger({type:'keydown', keyCode:'T'.charCodeAt(0)})">
		[--_T_ofR--]
	</div>
	<div class="button" onclick="$window.trigger({type:'keydown', keyCode:'D'.charCodeAt(0)})">
		[--Backwar_d_--]
	</div>
	<div class="button" onclick="$window.trigger({type:'keydown', keyCode:'F'.charCodeAt(0)})">
		[--_F_orward--]
	</div>
	<div class="button button-goto-cats" onclick="$window.trigger({type:'keydown', keyCode:'C'.charCodeAt(0)})">
		[--Go to _C_ats--]
	</div>
	<div class="button button-new-reco" onclick="$window.trigger({type:'keydown', keyCode:'N'.charCodeAt(0)})">
		[--_N_ew reco--]
	</div>
	<div id="SNS-floating"><img class="SNS-img" src="/CDN/link.png" onclick="m.shareCurrentPage('link')"><img class="SNS-img" src="/CDN/icon-Twitter.png" onclick="m.shareCurrentPage('twitter')"><img class="SNS-img" src="/CDN/icon-Facebook.png" onclick="m.shareCurrentPage('facebook')"><img class="SNS-img" src="https://tistory3.daumcdn.net/tistory/1468360/skin/images/icon-Recoeve.png" onclick="m.shareCurrentPage('recoeve')"><img class="SNS-img" src="/CDN/icon-Kakao.png" onclick="m.shareCurrentPage('kakao')"></div>`)
$button_hideFK=$("#button-hideFK");
if ((!m.myPage)&&m.myId) {
	$button_hideFK.after(`<div class="button" onclick="window.open('/user/${m.myId}')">[--To my page--]</div>`);
}

$button_Go=$(".button-Go");
$button_ToR=$(".button-ToR");
$button_mode=$(".button-mode");
$button_neighbors_mode=$(".button-neighbors-mode");
$button_multireco_mode=$(".button-multireco-mode");
$button_new_reco=$(".button-new-reco");
$button_goto_cats=$(".button-goto-cats");

$point_range=$(".point-range").eq(0);
$point_range_bar=$(".point-range-bar").eq(0);
$point_range_left=$(".point-range-left").eq(0);
$point_range_right=$(".point-range-right").eq(0);
$point_range1=$(".point-range").eq(1);
$point_range_bar1=$(".point-range-bar").eq(1);
$point_range_left1=$(".point-range-left").eq(1);
$point_range_right1=$(".point-range-right").eq(1);
$point_range_result=$(".point-range-result");

m.mdInPRL=false; // mouse down in Point Range Left
m.mdInPRR=false; // mouse down in Point Range Right
m.mdInPRL1=false; // mouse down in Point Range1 Left
m.mdInPRR1=false; // mouse down in Point Range1 Right
m.PRmax=10.0;
m.PRw=$point_range.width();
m.PRw1=$point_range1.width();
m.fullPts=10.0;
// from <= pts <= to

$user_noti.html(m.userId+"'s recos");
if (!!m.myIndex) {
	$my_id.html(m.myId+" ▾");
}
else {
	$my_id.hide();
	$button_new_reco.remove();
}
if (!!m.myIndex) {
	$a_log_in.hide();
}
else {
	$a_log_out.hide();
}

m.hideFK=function () {
	$floating_key.hide();
	m.docCookies.setItem("hideFK", "y", Infinity, "/", false, true);
};
m.toggleFK=function () {
	if ($floating_key.is(":visible")) {
		m.docCookies.setItem("hideFK", "y", Infinity, "/", false, true);
	}
	else {
		m.docCookies.removeItem("hideFK", "/", false, true);
	}
	$floating_key.toggle();
};
if (m.docCookies.getItem("hideFK")==="y") {
	$floating_key.hide();
}



////////////////////////////////////////////////////
// Sidebar dragger and exit
////////////////////////////////////////////////////
m.browserWidth=0;
$window.on("resize", function (e) {
	if (window.innerWidth!==m.browserWidth) {
		m.browserWidth=window.innerWidth;
		if (window.innerWidth<600) {
			m.fontSize=15;
		}
		else if (window.innerWidth<701) {
			m.fontSize=15.5;
		}
		else if (window.innerWidth<901) {
			m.fontSize=16;
		}
		else if (window.innerWidth<1210) {
			m.fontSize=16.5;
		}
		else {
			m.fontSize=17;
		}
		m.defaultStyles.fontSize=m.fontSize;
		m.printDeviceInfo();
		if (m.browserWidth<701) {
			$sidebar.css({"margin-left":-$sidebar.outerWidth()});
			$sidebar_dragger.css({display:"block", "left":0});
			$sidebar_exit.hide();
		}
		else {
			$sidebar.css({"margin-left":0});
			$sidebar_dragger.hide();
			$sidebar_exit.hide();
		}
	}
});
$window.trigger("resize");
m.sidebar_show=(e) => {
	$sidebar.css({"margin-left":0});
	$sidebar_dragger.css({"left":$sidebar.outerWidth()});
	$sidebar_toggle.html(`<g style="stroke:white;stroke-width:20%; stroke-linecap:round"><line x1="20%" y1="50%" x2="80%" y2="50%"></line><line x1="20%" y1="50%" x2="50%" y2="20%"></line><line x1="20%" y1="50%" x2="50%" y2="80%"></line></g>`);
	$sidebar_toggle.on("click", m.sidebar_hide);
};
m.sidebar_hide=(e) => {
	$sidebar.css({"margin-left":-$sidebar.outerWidth()});
	$sidebar_dragger.css({"left":0});
	$sidebar_toggle.html(`<g style="stroke:white;stroke-width:20%; stroke-linecap:round"><line x1="20%" y1="50%" x2="80%" y2="50%"></line><line x1="80%" y1="50%" x2="50%" y2="20%"></line><line x1="80%" y1="50%" x2="50%" y2="80%"></line></g>`);
	$sidebar_toggle.on("click", m.sidebar_show);
};
$sidebar_toggle.on("click", m.sidebar_show);
$sidebar_dragger_in.on("mousedown.sd touchstart.sd", function (e) {
	let touch0=(e.type==='touchstart')?e.originalEvent.touches[0]:e;
	let relativeX=touch0.clientX-Math.round($sidebar_dragger.offset().left)+$window.scrollLeft();
	$html.on("mousemove.sd touchmove.sd", function (e) {
		window.getSelection().removeAllRanges();
		e.preventDefault();
		e.stopPropagation();
		let touch0=(e.type==='touchmove')?e.originalEvent.touches[0]:e;
		$sidebar.css({"margin-left":-$sidebar.outerWidth()+touch0.clientX-relativeX});
		$sidebar_dragger.css({"left":touch0.clientX-relativeX});
		$html.on("mouseup.sd touchend.sd", function () {
			$html.off("mouseup.sd touchend.sd mousemove.sd touchmove.sd");
			if (touch0.clientX-relativeX>$sidebar.outerWidth()/2) {
				m.sidebar_show();
			}
			else {
				m.sidebar_hide();
			}
		});
	})
});
$sidebar_exit.on("click", function () {
	$sidebar_exit.hide();
	$sidebar.css({"margin-left":-$sidebar.outerWidth()});
	$sidebar_dragger.css({"left":0});
});



/* Fuzzy search */
// Fuzzy search, Table of Recos move and reset
$goto_cats_container_move.on("mousedown.move touchstart.move", function (e) {
	e.preventDefault();
	e.stopPropagation();
	let touch0=(e.type==='touchstart')?e.originalEvent.touches[0]:e;
	let relativeX=touch0.clientX-Math.round($goto_cats_container_move.offset().left)+$window.scrollLeft();
	let relativeY=touch0.clientY-Math.round($goto_cats_container_move.offset().top)+$window.scrollTop();
	$html.on("mousemove.move touchmove.move", function (e) {
		window.getSelection().removeAllRanges();
		e.preventDefault();
		e.stopPropagation();
		let touch0=(e.type==='touchmove')?e.originalEvent.touches[0]:e;
		$goto_cats_container.css({left:touch0.clientX-relativeX, top:touch0.clientY-relativeY});
		$html.on("mouseup.move touchend.move", function () {
			$html.off("mouseup.move touchend.move mousemove.move touchmove.move");
		});
	});
});
$("#goto-cats-container>.reset").on("click.reset", function (e) {
	$goto_cats[0].value="";
	$goto_cats.focus();
	$goto_cats.trigger("input.fs");
});

$fuzzy_search_container_move.on("mousedown.move touchstart.move", function (e) {
	e.preventDefault();
	e.stopPropagation();
	let touch0=(e.type==='touchstart')?e.originalEvent.touches[0]:e;
	let relativeX=touch0.clientX-Math.round($fuzzy_search_container_move.offset().left)+$window.scrollLeft();
	let relativeY=touch0.clientY-Math.round($fuzzy_search_container_move.offset().top)+$window.scrollTop();
	$html.on("mousemove.move touchmove.move", function (e) {
		window.getSelection().removeAllRanges();
		e.preventDefault();
		e.stopPropagation();
		let touch0=(e.type==='touchmove')?e.originalEvent.touches[0]:e;
		$fuzzy_search_container.css({left:touch0.clientX-relativeX, top:touch0.clientY-relativeY});
		$html.on("mouseup.move touchend.move", function () {
			$html.off("mouseup.move touchend.move mousemove.move touchmove.move");
		});
	});
});
$("#fuzzy-search-container>.reset").on("click.reset", function (e) {
	$fuzzy_search.html("");
	$fuzzy_search.focus();
	$fuzzy_search.trigger("input.fs");
});

$table_of_recos_container_move.on("mousedown.move touchstart.move", function (e) {
	e.preventDefault();
	e.stopPropagation();
	let touch0=(e.type==='touchstart')?e.originalEvent.touches[0]:e;
	let relativeX=touch0.clientX-Math.round($table_of_recos_container_move.offset().left)+$window.scrollLeft();
	let relativeY=touch0.clientY-Math.round($table_of_recos_container_move.offset().top)+$window.scrollTop();
	$html.on("mousemove.move touchmove.move", function (e) {
		window.getSelection().removeAllRanges();
		e.preventDefault();
		e.stopPropagation();
		let touch0=(e.type==='touchmove')?e.originalEvent.touches[0]:e;
		$table_of_recos_container.css({left:touch0.clientX-relativeX, top:touch0.clientY-relativeY});
		$html.on("mouseup.move touchend.move", function () {
			$html.off("mouseup.move touchend.move mousemove.move touchmove.move");
		});
	});
});
$("#table-of-recos-container>.reset").on("click.reset", function (e) {
	$table_of_recos.html("");
	$table_of_recos.focus();
	$table_of_recos.trigger("input.fs");
});



////////////////////////////////////////////////////
// Fuzzy search prepare
////////////////////////////////////////////////////
m.fsGotoCats[0].ptnSH=m.fsGotoCats[1].ptnSH
=m.fsCat[0].ptnSH=m.fsCat[1].ptnSH
=m.fsGo[0].ptnSH=m.fsGo[1].ptnSH
=m.fsToRs[0].ptnSH=m.fsToRs[1].ptnSH=m.splitHangul("$!@#");



/* CatList */
////////////////////////////////////////////////////
// CatList rendering
////////////////////////////////////////////////////
m.getDepthOfTabs=function (str) {
	let n=0;
	while (n<str.length&&str.charAt(n)==='\t') { n++; }
	return n;
};
m.getSuperCat=function (cat) {
	if (cat&&cat.constructor===String) {
		let i=cat.lastIndexOf("--");
		if (i!=-1) {
			return cat.substring(0,i);
		}
	}
	return null;
};
m.strCatListToJSON=function (strCatList, catList) {
	let list=strCatList.trim().split("\n");
	if (strCatList.length===0) {
		list=[];
	}
	list.unshift(""); // cat=uncategorized : empty cat.
	if (catList===undefined||catList===null) {
		if (!!m.catList) {
			catList=m.catList;
		}
		else {
			catList=m.catList=[];
		}
	}
	let superCats=[];
	if (strCatList.trim()==="") {
		catList[0]=catList[""]={i:0, cat:"", baseCat:"", depth:0};
	}
	else {
		for (let i=0;i<list.length;i++) {
			let baseCat=list[i].trim();
			let depth=m.getDepthOfTabs(list[i]);
			superCats.splice(depth, superCats.length-depth, baseCat);
			let cat=superCats.join("--");
			catList[i]=catList[cat]={i, cat, baseCat, depth};
		}
	}
};
m.catListToHTML=function () {
	let cL=m.catList;
	let catListHTML=`<div class="cat" id="cat-0" style="margin-left:${cL[0].depth}em"><span class="noEC"></span><a href="${m.pathOfCat('')}" class="baseCat" onclick="return m.openCat(m.catList[0].cat, event)">[--Uncategorized--]</a></div>`;
	let i=1;
	for (;i<cL.length-1;i++) {
		let beforeDepth=cL[i-1].depth;
		let currentDepth=cL[i].depth;
		let afterDepth=cL[i+1].depth;
		if (beforeDepth<currentDepth) { // open subCat
			catListHTML+=`<div class="subCat" style="display:none">`;
		}
		else {
			for (let j=currentDepth;j<beforeDepth;j++) { // close subCats
				catListHTML+=`</div>`;
			}
		}
		catListHTML+=`<div class="cat" id="cat-${i}" style="margin-left:${cL[i].depth}em">`;
		if (currentDepth<afterDepth) {
			catListHTML+=`<span class="EC" onclick="m.ExpCol(this,m.catList[${i}])">▶</span>`;
		}
		else {
			catListHTML+=`<span class="noEC"></span>`;
		}
		catListHTML+=`<a href="${m.pathOfCat(cL[i].cat)}" class="baseCat" onclick="return m.openCat(m.catList[${i}].cat, event)">${m.escapeHTML(cL[i].baseCat)}</a></div>`;
	}
	if (cL.length>1) {
		let beforeDepth=cL[i-1].depth;
		let currentDepth=cL[i].depth;
		if (beforeDepth<currentDepth) { // open subCat
			catListHTML+=`<div class="subCat" style="display:none">`;
		}
		else {
			for (let j=currentDepth;j<beforeDepth;j++) { // close subCats
				catListHTML+=`</div>`;
			}
		}
		catListHTML+=`<div class="cat" id="cat-${i}" style="margin-left:${cL[i].depth}em"><span class="noEC"></span><a href="${m.pathOfCat(cL[i].cat)}" class="baseCat" onclick="return m.openCat(m.catList[${i}].cat, event)">${m.escapeHTML(cL[i].baseCat)}</a></div>`;
		for (let j=0;j<currentDepth;j++) { // close subCats
			catListHTML+=`</div>`;
		}
	}
	$catList.html(catListHTML);
};
if (m.myIndex) { m.strCatListToJSON(m.unescapeHTML($data_myCatList.html()), m.myCatList); }
if (!m.myPage) { m.strCatListToJSON(m.unescapeHTML($data_CatList.html())); }
m.catListToHTML();
let $catECs=$catList.find(".cat:has(>.EC)");
for (let i=$catECs.length-1;i>=0;i--) {
	m.catList[Number($catECs.eq(i).attr("id").substring(4))].subCatExpanded=false;
}
m.catsToA=function (cats) {
	if (!cats||cats.constructor!==String||cats.trim().length===0) {
		return `<a href="${m.pathOfCat("")}" onclick="return m.openCat(m.catList[0].cat, event)"${m.currentCat===""?` class="currentCat"`:''}>[--Uncategorized--]</a>`;
	}
	let arrayHTML=[];
	let list=cats.split(";");
	for (let i=0;i<list.length;i++) {
		let cat=list[i];
		arrayHTML.push(`<a href="${m.pathOfCat(cat)}" onclick="return m.openCat(m.catList[${m.catList[cat].i}].cat, event)"${m.currentCat===cat?` class="currentCat"`:''}>${m.escapeHTML(cat)}</a>`);
	}
	return arrayHTML.join(" ; ");
};
m.getCatListChanged=function () {
	$change_catList_order_ok.hide();
	$change_catList_order_cancel.hide();
	let $cats=$("#catList .cat").not("#cat-0");
	$cats.removeClass("edit");
	$cats.find('.edit-bar').remove();
	let catListChanged="\n";
	for (let i=0;i<$cats.length;i++) {
		let catI=Number($cats.eq(i).attr("id").substring(4));
		for (let j=0;j<m.catList[catI].depth;j++) {
			catListChanged+="\t";
		}
		catListChanged+=m.catList[catI].baseCat+"\n";
	}
	return catListChanged;
};



//////////////////////////////////////
// CatList order
//////////////////////////////////////
$change_catList_order_ok.hide();
$change_catList_order_cancel.hide();
$change_catList_order.on("click", function (e) {
	$change_catList_order.hide();
	$change_catList_order_ok.show();
	$change_catList_order_cancel.show();
	let $cats=$("#catList .cat").not("#cat-0");
	$cats.addClass("edit");
	$cats.prepend('<div class="edit-bar"></div>');
	$cats.append('<div class="edit-bar"></div>');
	$("#catList .edit-bar").on("mousedown touchstart", function (e) {
		let $catM=$(this).parent(); // cat-moving
		let $catSiblings=$catM.siblings(".cat").not("#cat-0");
		if ($catSiblings.exists()) {
			let touch0=(e.type==='touchstart')?e.originalEvent.touches[0]:e;
			let relativeX=touch0.clientX-Math.round($catM.offset().left)+$window.scrollLeft();
			let relativeY=touch0.clientY-Math.round($catM.offset().top)+$window.scrollTop();
			let $subCat=$catM.next(".subCat");
			let subCatIsVisible=false;
			if ($subCat.exists()&&$subCat.is(":visible")) {
				$subCat.hide();
				subCatIsVisible=true;
			}
			let $lastSibling=$catSiblings.last();
			let $lastSubCat=$lastSibling.next(".subCat");
			if ($lastSubCat.exists()&&$lastSubCat.is(":visible")) { $lastSibling=$lastSubCat; }
			$catM.css({width:$catM.outerWidth()});
			$catM.addClass("move");
			let catI=Number($catM.attr("id").substring(4));
			let $catTo=$(`<div id="cat-to-here" style="margin-left:${m.catList[catI].depth+0.5}em"></div>`);
			$catM.before($catTo);
			let catTo=-1;
			$html.on("mousemove.mdInEB touchmove.mdInEB", function (e) {
				window.getSelection().removeAllRanges();
				e.preventDefault();
				e.stopPropagation();
				let touch0=(e.type==='touchmove')?e.originalEvent.touches[0]:e;
				$catM.css({left:touch0.clientX-relativeX, top:touch0.clientY-relativeY});
				let wST=$window.scrollTop();
				let sidebarTop=$sidebar.offset().top-wST;
				let sidebarBottom=sidebarTop+$sidebar.outerHeight();
				let scrollPad=20;
				if (sidebarTop<0?touch0.clientY<scrollPad:touch0.clientY<sidebarTop+scrollPad) {
					if (sidebarTop<0) {
						$window.scrollTop(wST+touch0.clientY-scrollPad);
					}
					else {
						$sidebar.scrollTop($sidebar.scrollTop()+touch0.clientY-sidebarTop-scrollPad);
					}
				}
				else if (sidebarBottom>$window.outerHeight()?touch0.clientY>$window.outerHeight()-scrollPad:touch0.clientY>sidebarBottom-scrollPad) {
					if (sidebarBottom>$window.outerHeight()) {
						$window.scrollTop(wST+touch0.clientY-$window.outerHeight()+scrollPad);
					}
					else {
						$sidebar.scrollTop($sidebar.scrollTop()+touch0.clientY-sidebarBottom+scrollPad);
					}
				}
				let tops=[];
				for (let i=1;i<$catSiblings.length;i++) {
					tops.push(($catSiblings.eq(i-1).offset().top-wST+$catSiblings.eq(i).offset().top-wST)/2);
				}
				tops.push(($catSiblings.last().offset().top-wST+$lastSibling.offset().top+$lastSibling.outerHeight()-wST)/2);
				let k=0;
				for (;k<tops.length;k++) {
					if (touch0.clientY<tops[k]) { break; }
				}
				if (catTo!==k) {
					if (k<tops.length) {
						$catSiblings.eq(k).before($catTo);
					}
					else {
						$lastSibling.after($catTo);
					}
					catTo=k;
				}
			});
			$html.on("mouseup.mdInEB touchend.mdInEB", function (e) {
				$html.off("mouseup.mdInEB touchend.mdInEB mousemove.mdInEB touchmove.mdInEB");
				$catM.removeClass("move");
				$catM.css({width:'', left:'', top:''});
				$catTo.replaceWith($catM);
				if ($subCat.exists()) {
					$catM.after($subCat);
					if (subCatIsVisible) { $subCat.show(); }
				}
			});
		}
		else { // if $catSiblings doesn't exist.
			$catM.css({"border-color":"rgb(230,120,120)"});
			$html.on("mousemove.mdInEB touchmove.mdInEB", function (e) {
				window.getSelection().removeAllRanges();
				e.preventDefault();
				e.stopPropagation();
			});
			$html.on("mouseup.mdInEB touchend.mdInEB", function (e) {
				$html.off("mouseup.mdInEB touchend.mdInEB mousemove.mdInEB touchmove.mdInEB");
				$catM.css({"border-color":""});
			});
		}
	});
});
m.change_catList_order_do=function (args, err) {
	if (err) {
		console.log(err);
		$data_myCatList.html(m.escapeHTML(args));
		m.updateCatFS();
		$change_catList_order.show();
	}
	else {
		$.ajax({
			type:"POST", url:"/changeOrders/CatList", data:args
			, dataType:"text"
		}).fail(function () {
			console.log("Changing CatList order has failed.");
		}).done(function (resp) {
			console.log(resp);
		}).always(function () {
			$data_myCatList.html(m.escapeHTML(args));
			m.updateCatFS();
			$change_catList_order.show();
		});
	}
};
$change_catList_order_ok.on("click", function (e) {
	let catListChanged=m.getCatListChanged();
	if (catListChanged!==m.unescapeHTML($data_CatList.html())) {
		if (m.myPage) {
			m.rmb_me(m.change_catList_order_do, catListChanged);
		}
		else {
			$data_CatList.html(m.escapeHTML(catListChanged));
			$change_catList_order.show();
		}
	}
	else {
		$change_catList_order.show();
	}
});
$change_catList_order_cancel.on("click", function (e) {
	let catListChanged=m.getCatListChanged();
	let catList=m.unescapeHTML($data_CatList.html());
	if (catListChanged!==catList) {
		let $catSelected=$catList.find(".cat.selected");
		let selected=[];
		for (let i=0;i<$catSelected.length;i++) {
			selected.push(m.catList[Number($catSelected.eq(i).attr("id").substring(4))].cat);
		}
		m.strCatListToJSON(catList);
		m.catListToHTML();
		for (let i=0;i<selected.length;i++) {
			$("#cat-"+m.catList[selected[i]].i).addClass("selected");
		}
		for (let i=m.catList.length-1;i>=0;i--) {
			if (m.catList[i].subCatExpanded) {
				$("#cat-"+i+">.EC").trigger("click");
			}
		}
	}
	$change_catList_order.show();
});



//////////////////////////////////////
// Fuzzy search on Cat
//////////////////////////////////////
m.putCatToFSFullList=function (i, cat) {
	if (m.fsCat.fullList[cat]) {
		m.fsCat.fullList[i]=m.fsCat.fullList[cat];
	}
	else {
		m.fsCat.fullList[i]=m.fsCat.fullList[cat]={i:i, txt:m.splitHangul(cat), cat:cat, html:m.escapeHTML(cat)};
	}
	if (m.myPage) {
		if (m.fsGotoCats.fullList[cat]) {
			m.fsGotoCats.fullList[i]=m.fsGotoCats.fullList[cat];
		}
		else {
			m.fsGotoCats.fullList[i]=m.fsGotoCats.fullList[cat]={i:i, txt:m.splitHangul(cat), cat:cat, html:m.escapeHTML(cat)};
		}
	}
};
m.updateCatFS=function () {
	m.fsCat.fullList.splice(0, m.fsCat.fullList.length); // splice(start, deleteCount)
	if (m.myPage) {
		m.fsGotoCats.fullList.splice(0, m.fsGotoCats.fullList.length);
	}
	if (!m.myPage) {
		m.strCatListToJSON(m.unescapeHTML($data_myCatList.html()), m.myCatList);
	}
	let l=m.myCatList.length;
	for (let i=l-1;i>=0;i--) {
		m.putCatToFSFullList(l-1-i, m.myCatList[i].cat);
	}
};
m.updateCatFS();
m.completeCat=function (elem, j) {
	let $elem=$(elem);
	let fs=m.fsCat;
	fs.$fsLis.removeClass("selected");
	$elem.addClass("selected");
	let k=fs.k; // index of cat on sEnd.
	fs.listOfCats[k]=fs.fullList[j].cat;
	fs.$fs[0].value=fs.listOfCats.join(";");
	let sStart=0;
	for (let i=0;i<k;i++) {
		sStart+=fs.listOfCats[i].length+1;
	}
	let sEnd=sStart+fs.listOfCats[k].length;
	fs.$fs.focus();
	fs.$fs[0].setSelectionRange(sEnd,sEnd);
};
m.completeMRCat=function (elem, j) { // TODO: Edit this better.
	let $elem=$(elem);
	let fs=m.fsCat;
	fs.$fsLis.removeClass("selected");
	$elem.addClass("selected");
	let k=fs.k; // index of cat on sEnd.
	fs.listOfCats[k]=fs.fullList[j].cat;
	$multireco_input_cats[0].value=fs.listOfCats.join(";");
	let sStart=0;
	for (let i=0;i<k;i++) {
		sStart+=fs.listOfCats[i].length+1;
	}
	let sEnd=sStart+fs.listOfCats[k].length;
	$multireco_input_cats.focus();
	$multireco_input_cats[0].setSelectionRange(sEnd,sEnd);
};
m.doFSCat=function (fs, $input) {
	if ($input!==undefined&&$input!==null&&!!$input) {
		fs.$fs=$input;
	}
	else {
		fs.$fs=$input_cats;
	}
	// TODO: Fast Fuzzy search with check previous search var. e.g. mu to mus.
	let catsTxt=fs.$fs[0].value;
	fs.$fs.focus();
	let sEnd=fs.$fs[0].selectionEnd;
	fs.listOfCats=catsTxt.split(";");
	let l=catsTxt.length;
	let lastK=fs.k;
	fs.k=0;
	for (let i=fs.listOfCats.length-1;i>=0;i--) {
		l-=fs.listOfCats[i].length+1;
		if (l<sEnd) {
			fs.k=i;
			break;
		}
	} // Picking cat index k of the current selectionEnd.
	let fsCatSH=m.splitHangul(fs.listOfCats[fs.k].trim());
	let res=m.fuzzySearch(fsCatSH, fs);
	let str="";
	if ($input===$goto_cats) {
		for (let i=0;i<res.length;i++) {
			let fsSortedI=res[res.sorted[i]];
			str+=`<div class="list-item" onclick="m.completeCatAndOpenCat(event,this,${fsSortedI.i},m.fsGotoCats)"><div class="list-index">${i}</div>${fs.fullList[fsSortedI.i].html}${(fsSortedI.highlight!==undefined?`<div class="highlighted"><span class="maxMatchScore">${fsSortedI.maxMatchScore}</span> :: ${fsSortedI.highlight}</div>`:'')}</div>`;
		}
	}
	else {
		for (let i=0;i<res.length;i++) {
			let fsSortedI=res[res.sorted[i]];
			str+=`<div class="list-item" onclick="m.completeCat(this,${fsSortedI.i})"><div class="list-index">${i}</div>${fs.fullList[fsSortedI.i].html}${(fsSortedI.highlight!==undefined?`<div class="highlighted"><span class="maxMatchScore">${fsSortedI.maxMatchScore}</span> :: ${fsSortedI.highlight}</div>`:'')}</div>`;
		}
	}
	fs.$fsl.html(str);
	fs.$fsLis=fs.$fsl.find(".list-item");
};
m.doMRFSCat=function (fs) {
	m.doFSCat(fs, $multireco_input_cats);
};
m.doFSGotoCats=function (fs) {
	m.doFSCat(fs, $goto_cats);
};

m.fsCatOn=function () {
	let now=Date.now();
	let passed=now-m.previous;
	if (passed>m.wait) {
		m.previous=now;
		m.doFSCat(m.fsCat);
	}
	else {
		$input_cats.off("input.fs keyup.fs cut.fs paste.fs click.fs");
		setTimeout(function () {
			$input_cats.on("input.fs keyup.fs cut.fs paste.fs click.fs", m.fsCatOn);
			m.previous=Date.now();
			m.doFSCat(m.fsCat);
		}, m.wait*1.1-passed);
	}
};
m.fsMRCatOn=function () {
	let now=Date.now();
	let passed=now-m.previous;
	if (passed>m.wait) {
		m.previous=now;
		m.doMRFSCat(m.fsCat);
	}
	else {
		$multireco_input_cats.off("input.fs keyup.fs cut.fs paste.fs click.fs");
		setTimeout(function () {
			$multireco_input_cats.on("input.fs keyup.fs cut.fs paste.fs click.fs", m.fsMRCatOn);
			m.previous=Date.now();
			m.doMRFSCat(m.fsCat);
		}, m.wait*1.1-passed);
	}
};
m.fsGotoCatsOn=function () {
	let now=Date.now();
	let passed=now-m.previous;
	if (passed>m.wait) {
		m.previous=now;
		m.doFSGotoCats(m.fsGotoCats);
	}
	else {
		$goto_cats.off("input.fs keyup.fs cut.fs paste.fs click.fs");
		setTimeout(function () {
			$goto_cats.on("input.fs keyup.fs cut.fs paste.fs click.fs", m.fsGotoCatsOn);
			m.previous=Date.now();
			m.doFSGotoCats(m.fsGotoCats);
		}, m.wait*1.1-passed);
	}
};
m.fsCatsOnTimeout=function () {
	$input_cats.on("input.fs keyup.fs cut.fs paste.fs click.fs", m.fsCatOn);
	$multireco_input_cats.on("input.fs keyup.fs cut.fs paste.fs click.fs", m.fsMRCatOn);
	$goto_cats.on("input.fs keyup.fs cut.fs paste.fs click.fs", m.fsGotoCatsOn);
};
m.fsCatsOnTimeout();
m.onKeydownInFS=function (e, fs, $fsl, $fs_container) {
	clearTimeout(m.setTimeoutTargetOn);
	let $target=$(e.target);
	let catsTxt=$target[0].value;
	$target.focus();
	let sEnd=$target[0].selectionEnd;
	fs.listOfCats=catsTxt.split(";");
	let l=catsTxt.length;
	let lastK=fs.k;
	fs.k=0;
	for (let i=fs.listOfCats.length-1;i>=0;i--) {
		l-=fs.listOfCats[i].length+1;
		if (l<sEnd) {
			fs.k=i;
			break;
		}
	} // Picking cat index k of the current selectionEnd.
	let $lis=$fsl.find(".list-item");
	let $liSelected=$fsl.find(".list-item.selected").eq(0);
	switch (e.keyCode) {
		case 9: // Tab=9
			e.preventDefault();
			e.stopPropagation();
			$target.off("input.fs keyup.fs cut.fs paste.fs click.fs");
			$lis.eq(0).trigger("click");
			break;
		case 27: // ESC=27
			e.preventDefault();
			$fs_container.hide();
			break;
		case 38: // up=38
		case 40: // down=40
			e.preventDefault();
			e.stopPropagation();
			$target.off("input.fs keyup.fs cut.fs paste.fs click.fs");
			let $liTo=null;
			if ($liSelected.exists()) {
				if (e.keyCode===38) {
					$liTo=$liSelected.prev();
				}
				else {
					$liTo=$liSelected.next();
				}
				if ($liTo.exists()) {
					$liTo.eq(0).trigger("click");
					if ($liTo.offset().top<$fsl.offset().top+2) { // $liTo at upside of scroll.
						$fsl.scrollTop($fsl.scrollTop()+$liTo.offset().top-$fsl.offset().top-2);
					}
					else if ($liTo.offset().top+$liTo.outerHeight()>$fsl.offset().top+$fsl.height()+2) { // $liTo at downside of scroll.
						$fsl.scrollTop($fsl.scrollTop()+$liTo.offset().top+$liTo.outerHeight()-$fsl.offset().top-$fsl.height()-2);
					}
				}
			}
			else {
				if ($lis.exists()) {
					if (e.keyCode===38) {
						$liTo=$lis.last();
						$fsl.scrollTop($fsl[0].scrollHeight);
					}
					else {
						$liTo=$lis.first();
						$fsl.scrollTop(0);
					}
					$liTo.eq(0).trigger("click");
				}
			}
			break;
	}
	m.setTimeoutTargetOn=setTimeout(function () {
		m.fsCatsOnTimeout();
	}, m.wait);
}
$input_cats.on("keydown.fs", function (e) {
	m.onKeydownInFS(e, m.fsCat, $cat_fs_list, $cat_fs_container);
});
$multireco_input_cats.on("keydown.fs", function (e) {
	m.onKeydownInFS(e, m.fsCat, $multireco_cat_fs_list, $multireco_cat_fs_container);
});
$goto_cats.on("keydown.fs", function (e) {
	m.onKeydownInFS(e, m.fsGotoCats, $goto_cats_list, $goto_cats_container);
});
let l=m.myCatList.length;
for (let i=l-1;i>=0;i--) {
	let cat=m.myCatList[i].cat;
	m.fsCat.fullList[l-1-i]={i:l-1-i, txt:m.splitHangul(cat), cat:cat, html:m.escapeHTML(cat)};
}
l=m.catList.length;
for (let i=l-1;i>=0;i--) {
	let cat=m.catList[i].cat;
	m.fsGotoCats.fullList[l-1-i]={i:l-1-i, txt:m.splitHangul(cat), cat:cat, html:m.escapeHTML(cat)};
}
$input_cats.trigger("keyup.fs");
$input_cats.on("focus", function () {
	$cat_fs_container.show();
});
$multireco_input_cats.trigger("keyup.fs");
$multireco_input_cats.on("focus", function () {
	$multireco_cat_fs_container.show();
});
$goto_cats.trigger("keyup.fs");



//////////////////////////////////////
// Put/Delete/Change Cats
//////////////////////////////////////
m.putCat=function (cat) {
	let res=false;
	if (cat===null||cat.length===0) { return res; }
	let fullCats=m.unescapeHTML($data_myCatList.html());
	let levels=cat.split("--");
	let pre="\n";
	let start=0;
	let end=fullCats.length;
	for (let j=0;j<levels.length;j++) {
		let subStr=fullCats.substring(start,end);
		let toFind=pre+levels[j]+"\n";
		let i=subStr.indexOf(toFind);
		if (i!=-1) {
			let ptnEnd=new RegExp(pre.replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"[^\\t\\n]", "g");
			ptnEnd.lastIndex=i+toFind.length-1;
			let matchEnd=ptnEnd.exec(subStr);
			if (matchEnd!==null) {
				end=start+matchEnd.index+1;
			}
			start+=i+toFind.length-1;
			pre+="\t";
		}
		else {
			let toPut="";
			for (;j<levels.length;j++) {
				toPut+=pre+levels[j];
				pre+="\t";
			}
			fullCats=fullCats.substring(0,end-1)+toPut+"\n"+fullCats.substring(end);
			res=true;
		}
	}
	if (res) { $data_myCatList.html(m.escapeHTML(fullCats)); }
	return res;
};
m.deleteCat=function (cat) {
	let res=false;
	if (cat===null||cat.length===0) { return res; }
	let fullCats=m.unescapeHTML($data_myCatList.html());
	let levels=cat.split("--");
	let pre="\n";
	let start0=0;
	let start=0;
	let end=fullCats.length;
	let subStr="";
	for (let j=0;j<levels.length;j++) {
		subStr=fullCats.substring(start,end);
		let toFind=pre+levels[j]+"\n";
		let i=subStr.indexOf(toFind);
		if (i===-1) {
			return res;
		}
		else {
			let ptnEnd=new RegExp(pre.replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"[^\\t\\n]", "g");
			ptnEnd.lastIndex=i+toFind.length-1;
			let matchEnd=ptnEnd.exec(subStr);
			if (matchEnd!==null) {
				end=start+matchEnd.index+1;
			}
			start0=start+i;
			start+=i+toFind.length-1;
			pre+="\t";
		}
	}
	subStr=fullCats.substring(start+1,end);
		// subStr=subCats+"\n"
		// if no subCats, this is empty.
	if (subStr.length===0) {
		fullCats=fullCats.substring(0,start0+1)+fullCats.substring(end); // delete a cat if there is no subCat.
		res=true;
	}
	if (res) { $data_myCatList.html(m.escapeHTML(fullCats)); }
	return res;
};
m.putCats_UriToLists=function (cats, uri) {
	let catSplit=cats.split(";");
	let catIsPut=false;
	for (let i=0;i<catSplit.length;i++) {
		let cat=catSplit[i];
		if (m.myPage) {
			if (m.catUriList[cat]?.has) {
				m.catUriList[cat].UriList=uri+"\n"+m.catUriList[cat].UriList;
				m.catUriList[cat].uris.splice(0, 0, uri);
			}
			else if (m.catUriList[cat]) {
				$numbers_of_recos.html(`Getting UriList of cat=${m.escapeHTML(cat)}.`);
				m.getUriList("cat\n"+(cat===""?"\tp":cat));
				m.recoToEve("", m.myRecos, cat, m.catUriList[cat].uris);
			}
			else {
				catIsPut=m.putCat(cat)||catIsPut;
				m.catUriList[cat]={cat:cat, down:true, has:true, UriList:uri, uris:[uri]};
			}
		}
		else {
			catIsPut=m.putCat(cat)||catIsPut;
		}
	}
	if (catIsPut) {
		if (m.myPage) { $change_catList_order_cancel.trigger("click"); }
		m.updateCatFS();
	}
};
m.delCats_UriFromLists=function (cats, uri) {
if (m.myPage) {
	let catSplit=cats.split(";");
	let catIsDeleted=false;
	for (let i=0;i<catSplit.length;i++) {
		let cat=catSplit[i];
		if (m.catUriList[cat]&&m.catUriList[cat].has) {
			let fullURIs="\n"+m.catUriList[cat].UriList.trim()+"\n";
			let k=fullURIs.indexOf("\n"+uri+"\n");
			if (k!==-1) {
				m.catUriList[cat].UriList=(fullURIs.substring(0,k)+fullURIs.substring(k+uri.length+1)).trim();
				// Intentionally no change on m.catUriList[cat].uris;
			}
			if (m.catUriList[cat].UriList.length===0) {
				let c=true;
				while (cat!==null&&c) {
					c=false;
					if (m.catUriList[cat].has&&m.catUriList[cat].UriList.length===0) {
						c=m.deleteCat(cat);
						catIsDeleted=catIsDeleted||c;
					}
					cat=m.getSuperCat(cat);
				}
			}
		}
	}
	if (catIsDeleted) {
		$change_catList_order_cancel.trigger("click");
		// Intentionally no m.updateCatFS();
	}
}};
m.catsChangedOnUri=function (oldCats, newCats, uri) {
if (uri&&uri.constructor===String&&oldCats!==null&&oldCats!==undefined&&oldCats.constructor===String&&newCats!==null&&newCats!==undefined&&newCats.constructor===String) {
	let oldCatSplit=oldCats.split(";");
	let newCatSplit=newCats.split(";");
	let o=[];
	let n=[];
	for (let i=0;i<oldCatSplit.length;i++) {
		o[oldCatSplit[i]]=true;
	}
	newCats="";
	for (let i=0;i<newCatSplit.length;i++) {
		if (o[newCatSplit[i]]) {
			o[newCatSplit[i]]=false;
			n[newCatSplit[i]]=false;
		}
		else {
			newCats+=newCatSplit[i]+";";
			n[newCatSplit[i]]=true;
		}
	}
	oldCats="";
	for (let p in o) {
		if (o[p]) { oldCats+=p+";"; }
	}
	if (oldCats.length>0) {
		m.delCats_UriFromLists(oldCats.substring(0,oldCats.length-1), uri);
	}
	if (newCats.length>0) {
		m.putCats_UriToLists(newCats.substring(0,newCats.length-1), uri);
	}
}};



/* Points */
////////////////////////////////////////////////////
// val, points, stars
////////////////////////////////////////////////////
m.val=function (val) {
	let res={valid:false, str:"", val:-1};
	if (val===null||val===undefined) {
		return res;
	}
	else if (val?.constructor!==String) {
		return res;
	}
	res.str=val;
	if (val.length===0) {
		res.valid=true;
		res.val=-1;
	}
	else {
		let exec=m.ptnVal.exec(val);
		if (exec!==null) {
			res.num=Number(exec[1]);
			res.divisor=Number(exec[2]);
			res.valid=(res.num>=0&&res.num<=res.divisor);
			if (res.valid) {
				res.val=res.num/res.divisor;
			}
			else {
				res.val=-1;
			}
		}
	}
	return res;
};
{
	let r=12; // outer radius of star
	let r0=6; // inner radius of star
	let pad=1; // padding of star
	let pad0=9; // left/right pad
	let thetas=[];
	let coss=[];
	let sins=[];
	for (let i=0;i<10;i++) {
		thetas.push(-Math.PI/2+2*Math.PI/10*i);
		coss.push(Math.cos(thetas[i]));
		sins.push(Math.sin(thetas[i]));
	}
	let str=`${pad0},0 `;
	let yc=pad+r;
	let xc=pad0+pad+r;
	for (let k=0;k<5;k++,xc+=2*r+pad) {
		str+=`${xc},0 `;
		for (let i=0;i<10;i++) {
			let rp=(i%2==0)?r:r0;
			str+=`${(xc+rp*coss[i]).toFixed(1)},${(yc+rp*sins[i]).toFixed(1)} `;
		}
		str+=`${xc},${pad} ${xc},0 `;
	}
	xc-=r;
	yc+=r*sins[4]+pad;
	str+=`${xc},0 ${xc},${yc.toFixed(1)} ${pad0},${yc.toFixed(1)}`;
	m.starsWidth=xc-pad0-2;
	m.stars=function (val) {
		if (val<0) { val=0; }
		else if (val>1) { val=1; }
		return `<div class="stars-container" style="width:${xc+pad0}px; height:${yc.toFixed(1)}px"><div class="bar" style="left:${pad0+1}px; width:${(m.starsWidth*val).toFixed(1)}px"></div><svg class="out-stars"><polygon points="${str}"/></svg></div>`;
	}
}



////////////////////////////////////////////////////
// Point range
////////////////////////////////////////////////////
$show_recos_without_points.on("click", function (e) {
	if ($show_recos_without_points.hasClass("enabled")) {
		$show_recos_without_points.removeClass("enabled");
		m.showRWOP=false;
	}
	else {
		$show_recos_without_points.addClass("enabled");
		m.showRWOP=true;
	}
	clearTimeout(m.timeOutRange);
	m.timeOutRange=setTimeout(function () {
		m.getUriListAndShowRecosOnCat(m.currentCat);
	}, 1024);
});
m.PRtoFixed=function (w) { // 0.0 ~ 10.0
	return (1.0*m.PRmax*w/m.PRw).toFixed(1);
};
m.PRtoFixed1=function (w1) { // 0.0 ~ 10.0
	return (1.0*m.PRmax*w1/m.PRw1).toFixed(1);
};
m.mmInPR=function (e) {
	window.getSelection().removeAllRanges();
	e.preventDefault();
	e.stopPropagation();
	let x=(e.type=='touchmove')?e.originalEvent.touches[0].clientX:e.clientX;
	let w=x-$point_range.offset().left+$window.scrollLeft();
	w=(w<0)?0:w;
	w=(w>m.PRw)?m.PRw:w;
	let w1=1.0*w/m.PRw*m.PRw1;
	w1=(w1<0)?0:w1;
	w1=(w1>m.PRw1)?m.PRw1:w1;
	let changed=false;
	if (m.mdInPRL) {
		if (w>m.PRRw) { w=m.PRRw; }
		if (m.PRLw!==w) {
			m.PRLw=w;
			$point_range_left.css({left:m.PRLw-23});
			$point_range_bar.css({left:m.PRLw});
			changed=true;
		}
		if (w1>m.PRRw1) { w1=m.PRRw1; }
		if (m.PRLw1!==w1) {
			m.PRLw1=w1;
			$point_range_left1.css({left:m.PRLw1-15});
			$point_range_bar1.css({left:m.PRLw1});
			changed=true;
		}
	}
	if (m.mdInPRR) {
		if (w<m.PRLw) { w=m.PRLw; }
		if (m.PRRw!==w) {
			m.PRRw=w;
			$point_range_right.css({right:m.PRw-m.PRRw-23});
			$point_range_bar.css({right:m.PRw-m.PRRw});
			changed=true;
		}
		if (w1<m.PRLw1) { w1=m.PRLw1; }
		if (m.PRRw1!==w1) {
			m.PRRw1=w1;
			$point_range_right1.css({right:m.PRw1-m.PRRw1-15});
			$point_range_bar1.css({right:m.PRw1-m.PRRw1});
			changed=true;
		}
	}
	if (changed) {
		let PRL=m.PRtoFixed(m.PRLw);
		let PRR=m.PRtoFixed(m.PRRw);
		if (m.mdInPRL) {
			PRL=Number(PRL)/m.PRmax;
			if (m.ptsRangeFrom!==PRL) {
				m.ptsRangeFrom=Number(PRL.toFixed(2));
				m.docCookies.setItem("PRL", PRL.toFixed(2), Infinity, "/", false, true);
			}
		}
		if (m.mdInPRR) {
			PRR=Number(PRR)/m.PRmax;
			if (m.ptsRangeTo!==PRR) {
				m.ptsRangeTo=Number(PRR.toFixed(2));
				m.docCookies.setItem("PRR", PRR.toFixed(2), Infinity, "/", false, true);
			}
		}
		$point_range_result.html((m.ptsRangeFrom*m.PRmax).toFixed(1)+"~"+(m.ptsRangeTo*m.PRmax).toFixed(1)+" / "+m.PRmax);
		clearTimeout(m.timeOutRange);
		m.timeOutRange=setTimeout(function () {
			m.getUriListAndShowRecosOnCat(m.currentCat);
			let fs=m.fsToRs;
			fs[0].ptnSH=m.splitHangul("$!@#");
			fs.$fs.trigger("input.fs");
		}, 1024);
	}
};
m.mmInPR1=function (e) {
	window.getSelection().removeAllRanges();
	e.preventDefault();
	e.stopPropagation();
	let x=(e.type=='touchmove')?e.originalEvent.touches[0].clientX:e.clientX;
	let w1=x-$point_range1.offset().left+$window.scrollLeft();
	w1=(w1<0)?0:w1;
	w1=(w1>m.PRw1)?m.PRw1:w1;
	let w=1.0*w1/m.PRw1*m.PRw;
	w=(w<0)?0:w;
	w=(w>m.PRw)?m.PRw:w;
	let changed=false;
	if (m.mdInPRL1) {
		if (w>m.PRRw) { w=m.PRRw; }
		if (m.PRLw!==w) {
			m.PRLw=w;
			$point_range_left.css({left:m.PRLw-23});
			$point_range_bar.css({left:m.PRLw});
			changed=true;
		}
		if (w1>m.PRRw1) { w1=m.PRRw1; }
		if (m.PRLw1!==w1) {
			m.PRLw1=w1;
			$point_range_left1.css({left:m.PRLw1-15});
			$point_range_bar1.css({left:m.PRLw1});
			changed=true;
		}
	}
	if (m.mdInPRR1) {
		if (w<m.PRLw) { w=m.PRLw; }
		if (m.PRRw!==w) {
			m.PRRw=w;
			$point_range_right.css({right:m.PRw-m.PRRw-23});
			$point_range_bar.css({right:m.PRw-m.PRRw});
			changed=true;
		}
		if (w1<m.PRLw1) { w1=m.PRLw1; }
		if (m.PRRw1!==w1) {
			m.PRRw1=w1;
			$point_range_right1.css({right:m.PRw1-m.PRRw1-15});
			$point_range_bar1.css({right:m.PRw1-m.PRRw1});
			changed=true;
		}
	}
	if (changed) {
		let PRL=m.PRtoFixed1(m.PRLw1);
		let PRR=m.PRtoFixed1(m.PRRw1);
		if (m.mdInPRL1) {
			PRL=Number(PRL)/m.PRmax;
			if (m.ptsRangeFrom!==PRL) {
				m.ptsRangeFrom=Number(PRL.toFixed(2));
				m.docCookies.setItem("PRL", PRL.toFixed(2), Infinity, "/", false, true);
			}
		}
		if (m.mdInPRR1) {
			PRR=Number(PRR)/m.PRmax;
			if (m.ptsRangeTo!==PRR) {
				m.ptsRangeTo=Number(PRR.toFixed(2));
				m.docCookies.setItem("PRR", PRR.toFixed(2), Infinity, "/", false, true);
			}
		}
		$point_range_result.html((m.ptsRangeFrom*m.PRmax).toFixed(1)+"~"+(m.ptsRangeTo*m.PRmax).toFixed(1)+" / "+m.PRmax);
		clearTimeout(m.timeOutRange);
		m.timeOutRange=setTimeout(function () {
			m.getUriListAndShowRecosOnCat(m.currentCat);
			let fs=m.fsToRs;
			fs[0].ptnSH=m.splitHangul("$!@#");
			fs.$fs.trigger("input.fs");
		}, 1024);
	}
};

$point_range_left.on("mousedown.mdPRL touchstart.mdPRL", function (e0) {
	m.mdInPRL=true;
	$html.on("mousemove.mdInPRL touchmove.mdInPRL", function (e) {
		m.mmInPR(e);
	});
	$html.on("mouseup.mdInPRL touchend.mdInPRL", function (e) {
		m.mdInPRL=false;
		$html.off("mouseup.mdInPRL touchend.mdInPRL mousemove.mdInPRL touchmove.mdInPRL");
	});
});
$point_range_right.on("mousedown.mdPRR touchstart.mdPRR", function (e0) {
	m.mdInPRR=true;
	$html.on("mousemove.mdInPRR touchmove.mdInPRR", function (e) {
		m.mmInPR(e);
	});
	$html.on("mouseup.mdInPRR touchend.mdInPRR", function (e) {
		m.mdInPRR=false;
		$html.off("mouseup.mdInPRR touchend.mdInPRR mousemove.mdInPRR touchmove.mdInPRR");
	});
});

$point_range_left1.on("mousedown.mdPRL1 touchstart.mdPRL1", function (e0) {
	m.mdInPRL1=true;
	$html.on("mousemove.mdInPRL1 touchmove.mdInPRL1", function (e) {
		m.mmInPR1(e);
	});
	$html.on("mouseup.mdInPRL1 touchend.mdInPRL1", function (e) {
		m.mdInPRL1=false;
		$html.off("mouseup.mdInPRL1 touchend.mdInPRL1 mousemove.mdInPRL1 touchmove.mdInPRL1");
	});
});
$point_range_right1.on("mousedown.mdPRR1 touchstart.mdPRR1", function (e0) {
	m.mdInPRR1=true;
	$html.on("mousemove.mdInPRR1 touchmove.mdInPRR1", function (e) {
		m.mmInPR1(e);
	});
	$html.on("mouseup.mdInPRR1 touchend.mdInPRR1", function (e) {
		m.mdInPRR1=false;
		$html.off("mouseup.mdInPRR1 touchend.mdInPRR1 mousemove.mdInPRR1 touchmove.mdInPRR1");
	});
});



////////////////////////////////////////////////////
// Show recos
////////////////////////////////////////////////////
m.renderStrDescCmt=function (str) {
	let res=[];
	str=str.trim();
	let key="#";
	let i=0;
	let start=0;
	let exec;
	while ((exec=m.ptnDescCmt.exec(str))!==null) {
		res[i++]=key;
		res[key]=str.substring(start, exec.index).trim();
		start=m.ptnDescCmt.lastIndex;
		key=exec[1];
	}
	res[i++]=key;
	res[key]=str.substring(start).trim();
	return res;
};
m.recoHTML=function (r, uriRenderDisable, inRange) {
	let res="";
	if (r?.has) {
		res+=`<div class="reco${inRange&&!r.deleted?'':' none'}"><img class="SNS-img" src="/CDN/link.png" onclick="m.shareSNS(this, 'link')"><img class="SNS-img" src="/CDN/icon-Twitter.png" onclick="m.shareSNS(this, 'twitter')"><img class="SNS-img" src="/CDN/icon-Facebook.png" onclick="m.shareSNS(this, 'facebook')"><img class="SNS-img" src="/CDN/icon-Kakao.png" onclick="m.shareSNS(this, 'kakao')"/>
	${m.myIndex?`<div class="button edit fRight${r.deleted?" deleted":""}" onclick="m.editOrRecoToMine(this)">${m.myPage?'[--Edit--]':'[--Reco to mine--]'}</div>`:''}
	<div class="textURI">${m.escapeHTML(r.uri)}</div>
	<div class="uri cBoth">${m.uriToA(r.uri)}</div>
	<div class="title">${m.escapeHTML(r.title)}</div>
	<div class="cats">${m.catsToA(r.cats)}</div>
	${uriRenderDisable?"":m.uriRendering(r.uri).html}`;
		if (r.desc) {
			let descR=r.descR;
			res+=`<div class="desc">`;
			for (let l=0;l<descR.length;l++) {
				let key=m.escapeHTML( descR[l] );
				let value=m.escapeHTML( descR[descR[l]] );
				switch (key.toLowerCase()) {
				case "#": case "":
					res+=`<div class="value">${value.replace(/\n/g,"<br>")}</div>`;
					break;
				case "lyrics": case "lyric": case "가사":
					res+=`<div class="value">
	<div class="center"><div class="button" onclick="m.slideToggle(this)">▼ [--Toggle lyrics--]</div></div>
	<div class="lyricsC" style="display:none">
		<div class="lyricsArrow"></div>
		<div class="lyrics">${value.replace(/\n/g,"<br>")}</div>
		<div class="right"><div class="button" onclick="m.slideUp(this)">▲ [--Hide lyrics--]</div></div>
	</div>
</div>`;
					break;
				case "related":
					res+=`<div class="value"><span class="key">#${key}</span>`;
					let relateds=value.split("\n");
					for (let p=0;p<relateds.length;p++) {
						res+='<br>'+m.uriRendering(m.formatURI(relateds[p]), true).html;
					}
					res+=`</div>`;
					break;
				default :
					res+=`<div class="value"><span class="key">#${key} </span>${value.replace(/\n/g,"<br>")}</div>`;
				}
			}
			res+=`</div>`;
		}
		res+=(r.cmt&&r.cmt.length!==0?(`<div class="cmt">${m.escapeHTML(r.cmt).replace(/\n/g,"<br>")}</div>`):"");
		if (r.val?.str) {
			res+=`<div class="val">${m.stars(r.val.val)} <span class="str">${m.escapeHTML(r.val.str)}</span></div>`;
		}
		else {
			res+=`<div class="val">${m.stars(0)} <span class="str"></span></div>`;
		}
		res+=`<div class="tFirst">Firstly Recoed at ${r.tFirst}</div><div class="cBoth"></div>`;
		if (r.tFirst!==r.tLast) {
			res+=`<div class="tLast">Lastly Editted at ${r.tLast}</div><div class="cBoth"></div>`;
		}
		if (m.recoMode==="multireco") {
			if (m.myPage) {
				res+=`<div class="my-point">${m.stars(r.val.val)} <span class="upDown down">&lt;</span> <span class="upDown up">&gt;</span> <span class="str">${m.escapeHTML(r.val.str)}</span></div>`;
			}
			else if (m.myRecos[r.uri]) {
				let mR=m.myRecos[r.uri];
				if (mR.has) {
					res+=`<div class="my-point">${m.stars(mR.val.val)} <span class="upDown down">&lt;</span> <span class="upDown up">&gt;</span> <span class="str">${m.escapeHTML(mR.val.str)}</span></div>`;
				}
				else {
					res+=`<div class="my-point">${m.stars(0)} <span class="upDown down">&lt;</span> <span class="upDown up">&gt;</span> <span class="str"></span></div>`;
				}
			}
			else {
				res+=`<div class="my-point">${m.stars(0)} <span class="upDown down">&lt;</span> <span class="upDown up">&gt;</span> <span class="str"></span></div>`;
			}
		}
		res+=`<div class="result"></div></div>`;
	}
	else {
		res+=`<div class="reco">No Reco</div>`;
	}
	return res;
};
m.reco_pointChange_do=function (args, err) {
	if (err) {
		args.$result?.html(err);
		return;
	}
	let fs=m.fsGo;
	let uri=args.uri;
	$.ajax({
		type:"POST", url:"/reco/do", data:args.strHeads+"\n"+args.strContents
		, dataType:"text"
	}).fail(function (resp) {
		args.$result?.html(`[--Failed change. You may not be logged-in.--]: ${resp}`);
	}).done(function (resp) {
		let res=m.strToJSON(resp);
		if (res[1]?.result==="changed") {
			let val=m.myRecos[uri].val=m.val(args.valStr);
			args.$result?.html(`[--Your point on this URI is changed.--]`);
		}
		else {
			args.$result?.html(res[1]?.result);
		}
	});
};
m.recoByOnlyStars=function ($str, uri, $result) {
	if (!m.myIndex) {
		let delay=27;
		setInterval(function () {
			$result.html(`[--You are not logged-in recoeve.net. You will be brought to log-in (or sign-up) page in ${delay} sec.--]`);
			$a_log_in=$(".a-log-in");
			delay--;
		}, 1000);
		setTimeout(function () {
			window.location.href=`/account/log-in?goto=${encodeURIComponent(window.location.href)}`;
		}, 27000);
		return;
	}
	let valStr=$str.html();
	if (m.myPage) {
		if (valStr!==m.myRecos[uri]?.val?.str) {
			let strHeads="do\turi\tval";
			let strContents=`change\t${m.encloseStr(uri)}\t${m.encloseStr(valStr)}`;
			$result.html("[--Changing your points.--]");
			m.rmb_me(m.reco_pointChange_do, {strHeads, strContents, uri, valStr, $result});
		}
	}
	else {
		if (m.myRecos[uri]?.has) {
			if (m.myRecos[uri]?.val?.str!==valStr) {
				let strHeads="do\turi\tval";
				let strContents="change\t"+m.encloseStr(uri)+"\t"+m.encloseStr(valStr);
				$result.html("[--Changing your points.--]");
				m.rmb_me(m.reco_pointChange_do, {strHeads, strContents, uri, valStr, $result});
			}
		}
		else {
			let strHeads="do\turi";
			let strContents="reco\t"+m.encloseStr(uri);
			strHeads+="\tval";
			strContents+="\t"+valStr;
			let uR=m.userRecos[uri];
			if (uR.title) {
				strHeads+="\ttitle";
				strContents+="\t"+m.encloseStr(uR.title);
			}
			if (uR.desc) {
				strHeads+="\tdesc";
				strContents+="\t"+m.encloseStr(uR.desc);
			}
			strHeads+="\tcats";
			strContents+="\t"+m.encloseStr(m.formatCats($multireco_input_cats[0].value.trim()));
			let strRecoDo=strHeads+"\n"+strContents;
			$result.html("[--Recoing to your recoeve.net.--]");
			m.rmb_me(m.reco_do, {strRecoDo, uri, $result});
		}
	}
};
m.showRecosOnCat=function (elem, from) {
	let $elem=$(elem);
	let fs=m.fsToRs;
	let l=fs.fullList.length;
	let strHTML="";
	if (l<=0) {
		$numbers_of_recos.html(`No reco in cat=${m.escapeHTML(m.currentCat)}.`);
		$contents.html(strHTML);
		$reco_playing.html('');
		$eveElse.html('');
		$youtube.html('');
		$eveElse_uri_rendered.hide();
		$rC_youtube_uri_rendered.hide();
	}
	else {
		if (elem===undefined||elem===null) {
			from=l-1;
			let nHiden=0, nShown=0;
			for (let k=0;k<l;k++) {
				let fsFLk=fs.fullList[k];
				let uri=fsFLk.uri;
				let r=fsFLk.reco;
				let val=r.val?.val;
				fsFLk.txt=m.splitHangul(r.title);
				fsFLk.html=m.escapeHTML(r.title);
				if (val===undefined||val===-1) {
					if (m.showRWOP) {
						fsFLk.inRange=true;
						nShown++;
					}
					else {
						fsFLk.inRange=false;
						nHiden++
					}
				}
				else {
					if (m.ptsRangeFrom<=val&&val<=m.ptsRangeTo) {
						fsFLk.inRange=true;
						nShown++;
					}
					else {
						fsFLk.inRange=false;
						nHiden++;
					}
				}
			}
			if ((!m.myPage)&&m.showOnlyUnrecoed) {
				for (let k=0;k<l;k++) {
					let fsFLk=fs.fullList[k];
					let uri=fsFLk.uri;
					if (m.myRecos[uri].has) {
						if (fsFLk.inRange) {
							nShown--;
							nHiden++;
						}
						fsFLk.inRange=false;
					}
				}
			}
			let nOfRecos=`You have ${l} recos (${nShown} to be shown, and ${nHiden} hiden.) on cat=${m.escapeHTML(m.currentCat)}.`;
			$numbers_of_recos.html(nOfRecos);
			for (let i=from, k=0;i>=0;i-=m.maxShowReco, k++) {
				strHTML+=`<div id="load-recos-${k}" class="button to-be-executed" onclick="m.showRecosOnCat(this,${i})">Load more... <span class="from">${i}</span> to <span class="to">${i-m.maxShowReco+1>=0?i-m.maxShowReco+1:0}</span></div>`;
			}
			$contents.html(strHTML);
			$(".to-be-executed").eq(0).trigger("click");
		}
		else {
			if (from!==undefined&&from!==null&&from.constructor===Number) {
				for (let i=from, k=0;i>=0&&k<m.maxShowReco;i--, k++) {
					let fsFLi=fs.fullList[i];
					let r=fsFLi.reco;
					strHTML+=m.recoHTML(r, false, fsFLi.inRange);
				}
			}
			let beforeLoadSH=document.documentElement.scrollHeight;
			let beforeST=$window.scrollTop();
			if ($elem.offset().top-beforeST<=window.innerHeight/2.0) {
				$elem.replaceWith(strHTML);
				$window.scrollTop($window.scrollTop()+$elem.outerHeight()+document.documentElement.scrollHeight-beforeLoadSH);
			}
			else {
				$elem.replaceWith(strHTML);
			}
			let afterLoadSH=document.documentElement.scrollHeight;
			if (m.recoMode==="multireco") {
				let $stars=$contents.find(".my-point>.stars-container");
				$stars.on("click", function (e) {
					let $target=$(e.target);
					let $reco=$target.parents(".reco");
					if (!$target.hasClass("stars-container")) {
						$target=$target.parents(".stars-container");
					}
					let uri=m.unescapeHTML($reco.find(".textURI").html());
					clearTimeout(m.timeout[uri]);
					let $result=$reco.find(".result");
					$result.html("");
					let $bar=$target.find(".bar");
					let barW=$bar.width();
					let $str=$target.siblings(".str");
					let w=e.clientX-$bar.offset().left+$window.scrollLeft();
					if (w<-15) {
						w=-1;
					}
					else if (w<0) {
						w=0;
					}
					else if (w>m.starsWidth) {
						w=m.starsWidth;
					}
					if (w!==barW) {
						barW=w;
						if (w<0) {
							$str.html("");
							w=0;
						}
						else {
							$str.html(m.escapeHTML((w/m.starsWidth*m.fullPts).toFixed(1)+"/"+m.fullPts));
						}
						$bar.css({width:w});
					}
					m.timeout[uri]=setTimeout(function () {
						m.recoByOnlyStars($str, uri, $result);
					}, 2048);
				});
				$stars.on("mousedown.mdInStars touchstart.mdInStars", function (e) {
					let $target=$(e.target);
					if (!$target.hasClass("stars-container")) {
						$target=$target.parents(".stars-container");
					}
					let $reco=$target.parents(".reco");
					let uri=m.unescapeHTML($reco.find(".textURI").html());
					clearTimeout(m.timeout[uri]);
					let $result=$reco.find(".result");
					$result.html("");
					let $bar=$target.find(".bar");
					let barW=$bar.width();
					let $str=$target.siblings(".str");
					$html.on("mousemove.mdInStars touchmove.mdInStars", function (e) {
						window.getSelection().removeAllRanges();
						e.preventDefault();
						e.stopPropagation();
						let x=(e.type=='touchmove')?e.originalEvent.touches[0].clientX:e.clientX;
						let w=x-$bar.offset().left+$window.scrollLeft();
						if (w<-15) {
							w=-1;
						}
						else if (w<0) {
							w=0;
						}
						else if (w>m.starsWidth) {
							w=m.starsWidth;
						}
						if (w!==barW) {
							barW=w;
							if (w<0) {
								$str.html("");
								w=0;
							}
							else {
								$str.html((w/m.starsWidth*m.fullPts).toFixed(1)+"/"+m.fullPts);
							}
							$bar.css({width:w});
						}
					});
					$html.on("mouseup.mdInStars touchend.mdInStars", function (e) {
						$html.off("mouseup.mdInStars touchend.mdInStars mousemove.mdInStars touchmove.mdInStars");
						m.timeout[uri]=setTimeout(function () {
							m.recoByOnlyStars($str, uri, $result);
						}, 2048);
					});
				});
				let $ups=$contents.find(".my-point>.up");
				let $downs=$contents.find(".my-point>.down");
				$ups.on("click", function (e) {
					let $target=$(e.target);
					let $reco=$target.parents(".reco");
					let uri=m.unescapeHTML($reco.find(".textURI").html());
					clearTimeout(m.timeout[uri]);
					let $result=$reco.find(".result");
					$result.html("");
					let $str=$target.siblings(".str");
					let $star=$reco.find(".my-point>.stars-container");
					let val=m.val($str.html());
					if (val.valid) {
						if (val.val===-1) {
							$str.html("10.0/10");
						}
						else {
							val.num+=0.1;
							if (val.num>val.divisor) {
								val.num=val.divisor;
							}
							$str.html(`${val.num.toFixed(1)}/${val.divisor}`);
						}
					} else {
						$str.html("10.0/10");
					}
					val=m.val($str.html());
					$star.find(".bar").css({width:m.starsWidth*val.val});
					m.timeout[uri]=setTimeout(function () {
						m.recoByOnlyStars($str, uri, $result);
					}, 2048);
				});
				$downs.on("click", function (e) {
					let $target=$(e.target);
					let $reco=$target.parents(".reco");
					let uri=m.unescapeHTML($reco.find(".textURI").html());
					clearTimeout(m.timeout[uri]);
					let $result=$reco.find(".result");
					$result.html("");
					let $str=$target.siblings(".str");
					let $star=$reco.find(".my-point>.stars-container");
					let val=m.val($str.html());
					if (val.valid) {
						if (val.val===-1) {
							$str.html("0.0/10");
						}
						else {
							val.num-=0.1;
							if (val.num<0) {
								val.num=0;
							}
							$str.html(`${val.num.toFixed(1)}/${val.divisor}`);
						}
					} else {
						$str.html("0.0/10");
					}
					val=m.val($str.html());
					$star.find(".bar").css({width:m.starsWidth*val.val});
					m.timeout[uri]=setTimeout(function () {
						m.recoByOnlyStars($str, uri, $result);
					}, 2048);
				});
			}
		}
	}
	let $recos=$contents.find(".reco");
	let fs0=m.fsGo;
	for (let i=0;i<$recos.length;i++) {
		let uri=m.unescapeHTML($recos.eq(i).find(".textURI").html());
		if (!fs0.fullList[uri]) {
			fs0.fullList[uri]={};
		}
		fs0.fullList[uri].$listI=$recos.eq(i);
	}
	m.delayedElems=$("[delayed-src], [delayed-bgimage], .to-be-executed");
	$window.on("scroll.delayedLoad", m.delayedLoadByScroll);
	$window.trigger("scroll.delayedLoad");
	m.fdList=$("#change-style, #foot, #head, #headPlay, #contents>.reco, .to-be-executed");
};
m.editOrRecoToMine=function (elem) {
	let $reco=$(elem).parent(".reco");
	let uri=m.unescapeHTML($reco.find(".textURI").html());
	let r=m.userRecos[uri];
	$input_uri[0].value=r.uri;
	$input_uri[0].disabled=true;
	$new_reco.show();
	if (uri.length!==0&&uri!==m.lastURI) {
		m.getAndShowDefsAndReco(true);
	}
	m.wST=$window.scrollTop();
	$window.on("scroll.stop", function (e) {
		e.preventDefault();
		$window.scrollTop(m.wST);
	});
};
m.recoDowned=function (urisStr, recos) {
	let uris=urisStr.trim().split("\n");
	for (k=0;k<uris.length;k++) {
		let uri=uris[k];
		let p=recos[uri];
		if (!p) { p=recos[uri]={}; }
		p.down=true; // User's or My reco on the uri is downloaded.
	}
};
m.recoToEve=function (resp, recos, cat, uris) {
	resp=m.strToJSON(resp);
	for (let k=1;k<resp.length;k++) {
		let respK=resp[k];
		let uri=respK.uri;
		let p=recos[uri];
		if (!p) { p=recos[uri]={}; }
		p.has=true; // User has a reco on the uri.
		for (let prop in respK) {
			if (isNaN(prop)) {
				p[prop]=respK[prop];
			}
		}
		p.deleted=false;
		if (p.desc!==undefined) {
			p.descR=m.renderStrDescCmt(p.desc); // R for rendered.
		}
		if (p.cmt!==undefined) {
			p.cmtR=m.renderStrDescCmt(p.cmt); // R for rendered.
		}
		p.val=m.val(p.val);
	}
	let fs=m.fsGo;
	let fsFL=fs.fullList=fs.fullList||[];
	if (recos===m.userRecos) {
		for (let k=1;k<resp.length;k++) {
			let respK=resp[k];
			let uri=respK.uri;
			let r=recos[uri];
			let fsFLk=fsFL[uri]={i:fsFL.length, catSplit:r.cats.split(";"), uri:uri, reco:r};
			fsFL.push(fsFLk);
			fsFLk.txt=m.splitHangul(`${r.cats} :: ${r.title}`);
			fsFLk.html=m.escapeHTML(r.title);
		}
		fs[1]=null;
		fs[0].ptnSH=m.splitHangul("$!@#");
		fs.$fs.trigger("input.fs");
	}
	if ((cat===""||cat)&&uris) {
		for (k=0;k<uris.length;k++) {
			let uri=uris[k];
			if (fs.fullList[uri]) {
				let kOfUriList=fs.fullList[uri].kOfUriList||{};
				kOfUriList[cat]=uris.length-1-k;
				fs.fullList[uri].kOfUriList=kOfUriList;
			}
		}
	}
};
m.getRecos=function (uris, recos, cat) {
	let getRecosStr="uri";
	let getRecosN=0;
	let fs1=m.fsToRs;
	let fs1FL=fs1.fullList;
	if (recos===m.userRecos) {
		fs1FL=fs1.fullList=[];
	}
	for (let i=uris.length-1;i>=0;i--) {
		let uri=uris[i];
		let r=recos[uri];
		if (!r) { r=recos[uri]={}; }
		if (recos===m.userRecos) {
			fs1FL[uris.length-1-i]=fs1FL[uri]={i:uris.length-1-i, uri:uri, reco:r};
		}
		if (!r.down) {
			getRecosStr+="\n"+uri;
			getRecosN++;
		}
	}
return new Promise(function (resolve, reject) {
	if (getRecosN>0) {
		let postURL=((recos===m.userRecos)?`${m.userPath}/get-Recos`:(!!m.myId?`/user/${m.myId}/get-Recos`:null));
		if (postURL) {
			$.ajax({
				type:"POST", url:postURL, data:getRecosStr
				, dataType:"text"
			}).fail(function () {
				$numbers_of_recos.html(`get-Recos of UriList on cat=${m.escapeHTML(cat)} has failed.`);
				$contents.html("");
			}).done(function (resp) {
				m.recoDowned(getRecosStr.substring(4), recos);
				if (recos===m.userRecos) {
					m.recoToEve(resp, recos, cat, uris);
				}
				else {
					m.recoToEve(resp, recos);
				}
				resolve();
			});
		}
	}
	else {
		resolve();
	}
});
};
m.getAndShowRecosOnCat=async function (cat) {
	let uris=m.catUriList[cat]?.has?m.catUriList[cat].uris:[];
	await m.getRecos(uris, m.userRecos, cat);
	if (m.recoMode==="multireco"&&!m.myPage&&!!m.myIndex) {
		await m.getRecos(uris, m.myRecos, cat);
	}
	m.showRecosOnCat();
	let fs1=m.fsToRs;
	fs1.currentIndex=fs1.fullList.length-1;
	fs1[1]=null;
	fs1[0].ptnSH=m.splitHangul("$!@#");
	fs1.$fs.trigger("input.fs");
	setTimeout(function () {
		fs1.playNext(-1, true, true);
	}, m.wait*2);
};
m.getUriList=function (catStrArray) {
	$.ajax({
		type:"POST", url:`${m.userPath}/get-UriList`, data:catStrArray
		, dataType:"text"
	}).fail(function () {
		$numbers_of_recos.html(`get-UriList on cat=${m.escapeHTML(cat)} has failed.`);
		$contents.html("");
	}).done(function (resp) {
		let respJSON=m.strToJSON(resp);
		for (let i=1;i<respJSON.length;i++) {
			let catUL=m.catUriList[respJSON[i].cat];
			catUL.down=true;
			catUL.has=true;
			for (let p in respJSON[i]) {
				if (isNaN(p)) {
					catUL[p]=respJSON[i][p]; // cat, UriList
				}
			}
			catUL.uris=[];
			if (catUL.UriList?.length!==0) {
				catUL.uris=catUL.UriList.split("\n");
			}
		}
		m.getAndShowRecosOnCat(m.currentCat);
	});
};
m.getUriListAndShowRecosOnCat=function (cat) {
	switch (m.recoMode) {
		case "neighbors":
			$numbers_of_recos.html("Loading neighbors, and plotting charts.");
			$contents.html("");
			break;
		case "multireco": case "": default:
			$numbers_of_recos.html(`Loading recos in cat=${m.escapeHTML(cat)}.`);
			let catI=m.catList[cat];
			if (catI) {
				$catList.find(".cat").removeClass("selected");
				let $cat=$("#cat-"+catI.i);
				$cat.addClass("selected");
				let $parents=$cat.parents(".subCat");
				for (let i=$parents.length-1;i>=0;i--) {
					if (!$parents.eq(i).is(":visible")) {
						$parents.eq(i).prev().find(">.EC").trigger("click");
					}
				}
				let catUriList=m.catUriList[cat]=m.catUriList[cat]||{};
				if (catUriList.down) {
					m.getAndShowRecosOnCat(cat);
				}
				else {
					$numbers_of_recos.html(`Getting UriList on cat=${m.escapeHTML(cat)}.`);
					m.getUriList("cat\n"+(cat===""?"\tp":cat));
				}
			}
			else {
				$numbers_of_recos.html(`Category "${m.escapeHTML(cat)}" does not exist.`);
				$contents.html("");
			}
			break;
	}
};
m.refresh=function (cats, option, uri) {
	let c=cats.split(";");
	let k=0;
	if (m.currentCat!==undefined) {
		for (k=c.length-1;k>0;k--) {
			if (c[k]===m.currentCat) {break;}
		}
	}
	if (c[k]!==m.currentCat) {
		m.openCat(c[k]);
	}
	else {
		switch (option) {
		case "recoed":
			let r=m.userRecos[uri];
			let $newReco=$(m.recoHTML(r, false, true));
			$contents.prepend($newReco);
			m.delayedElems=$("[delayed-src], [delayed-bgimage], .to-be-executed");
			$window.on("scroll.delayedLoad", m.delayedLoadByScroll);
			$window.trigger("scroll.delayedLoad");
			m.fdList=$("#change-style, #foot, #head, #headPlay, #contents>.reco, .to-be-executed");

			let fs=m.fsGo;
			fs.fullList[uri].$listI=$newReco;
			if (fs.shuffled) {
				fs.shuffled.push({i:fs.fullList.length, randomN:Math.random()});
			}
			fs[1]=null;
			fs[0].ptnSH=m.splitHangul("$!@#");
			fs.$fs.trigger("input.fs");

			fs=m.fsToRs;
			fs.fullList[uri]={i:fs.fullList.length, reco:r, txt:m.splitHangul(r.title), html:m.escapeHTML(r.title), inRange:true};
			fs.fullList.push(fs.fullList[uri]);
			if (fs.shuffled) {
				fs.shuffled.push({i:fs.fullList.length, randomN:Math.random()});
			}
			fs[1]=null;
			fs[0].ptnSH=m.splitHangul("$!@#");
			fs.$fs.trigger("input.fs");
			break;
		case "changed": case "deleted":
			if (uri===m.unescapeHTML($reco_playing.find(".reco>.textURI").html())) {
				if (option==="changed") {
					let r=m.userRecos[uri];
					$reco_playing.html(m.recoHTML(r, true, true));
					m.delayedElems=$("[delayed-src], [delayed-bgimage], .to-be-executed");
					$window.on("scroll.delayedLoad", m.delayedLoadByScroll);
					$window.trigger("scroll.delayedLoad");
				}
				else if (option==="deleted") {
					$reco_playing.html('');
					$eveElse.html('');
					$youtube.html('');
					$eveElse_uri_rendered.hide();
					$rC_youtube_uri_rendered.hide();
				}
			}
			let $recos=$contents.find(">.reco");
			for (let i=0;i<$recos.length;i++) {
				let $reco=$recos.eq(i);
				let recoUri=m.unescapeHTML($reco.find(">.textURI").html());
				if (recoUri===uri) {
					if (option==="changed") {
						let r=m.userRecos[uri];
						let $newReco=$(m.recoHTML(r, false, true));
						$reco.replaceWith($newReco);
						m.delayedElems=$("[delayed-src], [delayed-bgimage], .to-be-executed");
						$window.on("scroll.delayedLoad", m.delayedLoadByScroll);
						$window.trigger("scroll.delayedLoad");
						m.fdList=$("#change-style, #foot, #head, #headPlay, #contents>.reco, .to-be-executed");

						let fs=m.fsGo;
						let fsFLk=fs.fullList[uri];
						fsFLk.$listI=$newReco;
						fsFLk.txt=m.splitHangul(`${r.cats} :: ${r.title}`);
						fsFLk.html=m.escapeHTML(r.title);
						fs[1]=null;
						fs[0].ptnSH=m.splitHangul("$!@#");
						fs.$fs.trigger("input.fs");

						fs=m.fsToRs;
						fsFLk=fs.fullList[uri];
						fsFLk.txt=m.splitHangul(r.title);
						fsFLk.html=m.escapeHTML(r.title);
						fsFLk.inRange=true;
						fs[1]=null;
						fs[0].ptnSH=m.splitHangul("$!@#");
						fs.$fs.trigger("input.fs");
					}
					else if (option==="deleted") {
						let r=m.userRecos[uri];
						r.deleted=true;
						m.lastURI="x*L2$zp-|,O";
						$reco.addClass("none deleted");
						$reco.find(".button.edit").addClass("deleted");
						// TODO: fs.fullList.splice(i, 1)? // i from id attr?

						let fs=m.fsGo;
						let fsFLk=fs.fullList[uri];
						fs[1]=null;
						fs[0].ptnSH=m.splitHangul("$!@#");
						fs.$fs.trigger("input.fs");

						fs=m.fsToRs;
						fsFLk=fs.fullList[uri];
						fsFLk.inRange=false;
						fs[1]=null;
						fs[0].ptnSH=m.splitHangul("$!@#");
						fs.$fs.trigger("input.fs");
					}
					break;
				}
			}
			break;
		default :
			m.openCat(c[k]);
		}
	}
};

m.ExpCol=function (elem, catEC) {
	let $elem=$(elem);
	let $next=$elem.parent().next();
	if ($next.is(":visible")) {
		$next.hide();
		$elem.html("▶");
		catEC.subCatExpanded=false;
	}
	else {
		$next.show();
		$elem.html("▼");
		catEC.subCatExpanded=true;
	}
};



/////////////////////////////////////////
// Open Cat
/////////////////////////////////////////
m.openCat=function (cat, e) {
	m.currentCat=cat;
	let path=m.pathOfCat(m.currentCat, m.recoMode);
	if (e?.which===2) { // wheel click.
		window.open(path, "_blank");
		return true;
	}
	m.fsToRs.shuffled=null;
	for (let l=0;l<m.fsGo.fullList.length;l++) {
		m.fsGo.fullList[l].$listI=null;
	}
	m.getUriListAndShowRecosOnCat(cat);
	if (!m.initialOpen) {
		window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", path);
	}
	$title.html(`${cat?`${m.escapeHTML(cat)} of `:""}${m.userId}'s recoeve.net`);
	return false;
};

for (let i=0;i<m.catList.length;i++) {
	let cat=m.catList[i].cat;
	m.catUriList[cat]={cat:cat, down:false};
}

window.onpopstate=function (e) {
	if (!!e.state) {
		if (e.state.gotoCats!==m.gotoCats) {
			$window.trigger({type:'keydown', keyCode:'C'.charCodeAt(0)});
		}
		if (e.state.goOn!==m.goOn) {
			$window.trigger({type:'keydown', keyCode:'G'.charCodeAt(0)});
		}
		if (e.state.ToRsOn!==m.ToRsOn) {
			$window.trigger({type:'keydown', keyCode:'T'.charCodeAt(0)});
		}
		if (e.state.newRecoOn!==m.newRecoOn) {
			$window.trigger({type:'keydown', keyCode:'N'.charCodeAt(0)});
		}
		if (e.state.recoMode!==m.recoMode) {
			if (e.state.recoMode==="multireco"&&(!$button_multireco_mode.hasClass("enabled"))) {
				$window.trigger({type:'keydown', keyCode:'M'.charCodeAt(0)});
			}
			else if (e.state.recoMode==="neighbors"&&(!$button_neighbors_mode.hasClass("enabled"))) {
				$window.trigger({type:'keydown', keyCode:'B'.charCodeAt(0)});
			}
		}
		if (e.state.cat!==undefined&&e.state.cat.constructor===String) {
			let cat=e.state.cat;
			if (cat!==m.currentCat) {
				m.openCat(cat);
			}
		}
		else {
			m.openCat("");
		}
	}
};



////////////////////////////////////////////////////
// New Reco or Edit
////////////////////////////////////////////////////
m.getUTF8Length=function (s) {
	let len=0;
	for (let i=0;i<s.length;i++) {
		let code=s.charCodeAt(i);
		if (code<=0x7f) {
			len+=1;
		}
		else if (code<=0x7ff) {
			len+=2;
		}
		else if (code>=0xd800&&code<=0xdfff) {
			// Surrogate pair: These take 4 bytes in UTF-8 and 2 chars in UCS-2
			// (Assume next char is the other [valid] half and just skip it)
			len+=4; i++;
		}
		else if (code<0xffff) {
			len+=3;
		}
		else {
			len+=4;
		}
	}
	return len;
};
m.formatURI=function (uri) {
	uri=uri.trim().replace(/[\t\n]/g," ");
	let exec=m.ptnTag.exec(uri);
	if (exec!==null) {
		try {
			let $uri=$(uri);
			let src=$uri.attr("src");
			if (src) {
				uri=src;
			}
			else {
				src=$uri.find("[src]").attr("src");
				if (src) { uri=src; }
			}
		} catch (err) {
			console.log(err);
		}
	}
	return uri.replace(/&amp;/ig,"&").trim();
};
m.formatTitle=function (title) {
	return title.trim().replace(/[\t\r\n]/g," ");
};
m.formatCats=function (cats) {
	if (!cats||cats.constructor!==String||cats.trim().length===0) {
		return "";
	}
	cats=cats.trim().replace(/[\t\r\n]/g," ");
	let list=cats.split(";");
	for (let i=0;i<list.length;i++) {
		let levels=list[i].split("--");
		for (let j=0;j<levels.length;j++) {
			levels[j]=levels[j].replace(/^[\s-]+/,"").replace(/[\s-]+$/,"");
		}
		list[i]="";
		let k=0;
		for (;k<levels.length;k++) {
			if (levels[k].length!==0) {
				list[i]=levels[k];
				break;
			}
		}
		for (k++;k<levels.length;k++) {
			if (levels[k].length!==0) {
				list[i]+="--"+levels[k];
			}
		}
	}
	let catsMap={};
	catsMap[list[0]]=true;
	cats=list[0];
	for (let i=1;i<list.length;i++) {
		if (catsMap[list[i]]) {
		}
		else {
			catsMap[list[i]]=true;
			cats+=";"+list[i];
		}
	}
	return cats;
};

m.myRecos[""]=m.userRecos[""]={
	has:false, down:true, defs:true
	, title:"", cats:"", desc:"", cmt:"", val:m.val("")
	, defTitles:[[""]], defCats:[[""]], defDescs:[[""]]
};
m.showMyReco=function (r) {
	if (r.has) {
		if (r.deleted) {
			$button_reco.show();
			$button_edit.hide();
			$button_del.hide();
			$button_back.show();
		}
		else {
			$button_reco.hide();
			$button_edit.show();
			$button_del.show();
			$button_back.show();
		}
	}
	else {
		$button_reco.show();
		$button_edit.hide();
		$button_del.hide();
		$button_back.hide();
	}
	let $mR=$("#my-reco");
	$mR.html( m.recoHTML(r, true, true) ); // need to be edit.
	if (r.has) {
		let $edit=$mR.find(".button.edit");
		$edit.html("Edit mine");
		$edit.on("click", function (e) {
			$input_title[0].value=r.title;
			$input_cats[0].value=r.cats;
			$input_desc[0].value=r.desc;
			$input_cmt[0].value=r.cmt;
			$input_val[0].value=r.val.str;
			$input_val.trigger("keyup");
		});
	}
};
m.showReco=function (r) {
	if (r.has) {
		$input_title[0].value=r.title;
		$input_cats[0].value=r.cats;
		$input_desc[0].value=r.desc;
		if (m.myPage) {
			$input_cmt[0].value=r.cmt;
			$input_val[0].value=r.val.str;
		}
		else {
			$input_cmt[0].value="";
			$input_val[0].value="";
		}
		$input_val.trigger("keyup");
	}
	if (m.myPage) {
		if (r.has) {
			if (r.deleted) {
				$button_reco.show();
				$button_edit.hide();
				$button_del.hide();
				$button_back.show();
			}
			else {
				$button_reco.hide();
				$button_edit.show();
				$button_del.show();
				$button_back.show();
			}
		}
		else {
			$button_reco.show();
			$button_edit.hide();
			$button_del.hide();
			$button_back.hide();
		}
	}
};
m.emptifyReco=function () {
	$input_uri[0].value="";
	$input_title[0].value="";
	$input_cats[0].value="";
	$input_desc[0].value="";
	$input_cmt[0].value="";
	$input_val[0].value="";
	$input_val.trigger("keyup");
	m.getAndShowDefsAndReco();
};
m.showDefs=function (r) {
	let defTitles=r.defTitles;
	let defTitlesHTML="";
	for (let i=0;i<defTitles.length;i++) {
		let title=defTitles[i][0].trim();
		if (title.length!==0) {
			defTitlesHTML+=`<div class="def-title">${m.escapeHTML(title)}</div>`;
		}
	}
	$def_titles.html(defTitlesHTML);
	let $defTitles=$def_titles.find(".def-title");
	$defTitles.on("click", function (e) {
		$defTitles.removeClass("selected");
		let $this=$(this);
		$this.addClass("selected");
		$input_title[0].value=m.unescapeHTML($this.html());
	});

	let defCats=r.defCats;
	let defCatsHTML=`<div class="def-cat replace-cat">[--Indifferent--]</div> <div class="def-cat replace-cat">[--Later--]</div> <div id="add-cat" class="def-cat add-txt">;</div> <div id="sub-cat" class="def-cat add-txt">--</div> <div id="delete-cat" class="def-cat delete-cat">[--Delete--]</div><br>`;
	for (let i=0;i<defCats.length;i++) {
		let cat=defCats[i][0].trim();
		if (cat.length!==0) {
			defCatsHTML+=`<div class="def-cat replace-cat">${m.escapeHTML(cat)}</div> `;
		}
	}
	$def_cats.html(defCatsHTML);
	let $defCats=$def_cats.find(".def-cat");
	let $replaceCats=$def_cats.find(".replace-cat");
	$replaceCats.on("click", function (e) {
		let $this=$(this);
		let fs=m.fsCat;
		$defCats.removeClass("selected");
		$this.addClass("selected");
		let k=fs.k;
		fs.listOfCats[k]=m.unescapeHTML($this.html()).trim();
		fs.$fs[0].value=fs.listOfCats.join(";");
		let sStart=0;
		for (let i=0;i<k;i++) {
			sStart+=fs.listOfCats[i].length+1;
		}
		let sEnd=sStart+fs.listOfCats[k].length;
		fs.$fs.focus();
		fs.$fs[0].setSelectionRange(sEnd,sEnd);
	});
	let $addTxts=$def_cats.find(".add-txt");
	$addTxts.on("click", function (e) {
		let $this=$(this);
		$defCats.removeClass("selected");
		$this.addClass("selected");
		let sStart=$input_cats[0].selectionStart;
		let sEnd=$input_cats[0].selectionEnd;
		let inputValue=$input_cats[0].value;
		let inserted=m.unescapeHTML($this.html());
		$input_cats[0].value=`${inputValue.substring(0,sStart)}${inserted}${inputValue.substring(sEnd)}`;
		let l=$input_cats[0].value.length;
		$input_cats.focus();
		sEnd=sStart+inserted.length;
		$input_cats[0].setSelectionRange(sEnd,sEnd);
		$input_cats.trigger("keyup.fs");
	});
	let $deleteCat=$def_cats.find(".delete-cat");
	$deleteCat.on("click", function (e) {
		let $this=$(this);
		let fs=m.fsCat;
		$defCats.removeClass("selected");
		$this.addClass("selected");
		let k=fs.k;
		fs.listOfCats.splice(k, 1);
		fs.$fs[0].value=fs.listOfCats.join(";");
		let sStart=0;
		for (let i=0;i<k;i++) {
			sStart+=fs.listOfCats[i].length+1;
		}
		let sEnd=fs.listOfCats.length===k?sStart-1:sStart;
		fs.$fs.focus();
		fs.$fs[0].setSelectionRange(sEnd,sEnd);
		$input_cats.trigger("keyup.fs");
	});

	let defDescs=r.defDescs;
	let defDescsHTML="";
	for (let i=0;i<defDescs.length;i++) {
		let desc=defDescs[i][0].trim();
		if (desc.length!==0) {
			if (desc.length<30) {
				defDescsHTML+=`<div class="def-desc">${m.escapeHTML(desc)}<data class="none">${m.escapeHTML(desc)}</data></div>`;
			}
			else {
				defDescsHTML+=`<div class="def-desc">${m.escapeHTML(desc.substring(0,15))} ... ${m.escapeHTML(desc.substring(desc.length-15))}<data class="none">${m.escapeHTML(desc)}</data></div>`;
			}
		}
	}
	$def_descs.html(defDescsHTML);
	let $defDesc=$def_descs.find(".def-desc");
	$defDesc.on("click", function (e) {
		$defDesc.removeClass("selected");
		let $this=$(this);
		$this.addClass("selected");
		$input_desc[0].value=m.unescapeHTML($this.find("data.none").html());
	});
};
let $def_cmd=$("#def-cmds").find(".def-cmd");
$def_cmd.on("click", function (e) {
	$input_desc.focus();
	let sStart=$input_desc[0].selectionStart;
	let sEnd=$input_desc[0].selectionEnd;
	let inputValue=$input_desc[0].value;
	let inserted=m.unescapeHTML($(this).html());
	$input_desc[0].value=`${inputValue.substring(0,sStart)}${inserted}${inputValue.substring(sEnd)}`;
	$input_desc.focus();
	sEnd=sStart+inserted.length;
	$input_desc[0].setSelectionRange(sEnd,sEnd);
});
let $multirecoDefCats=$multireco_def_cats.find(".def-cat");
let $multirecoReplaceCats=$multireco_def_cats.find(".replace-cat");
$multirecoReplaceCats.on("click", function (e) {
	let $this=$(this);
	let fs=m.fsCat;
	$multirecoDefCats.removeClass("selected");
	$this.addClass("selected");
	let k=fs.k;
	fs.listOfCats[k]=m.unescapeHTML($this.html()).trim();
	fs.$fs[0].value=fs.listOfCats.join(";");
	let sStart=0;
	for (let i=0;i<k;i++) {
		sStart+=fs.listOfCats[i].length+1;
	}
	let sEnd=sStart+fs.listOfCats[k].length;
	fs.$fs.focus();
	fs.$fs[0].setSelectionRange(sEnd,sEnd);
});
let $multirecoAddTxts=$multireco_def_cats.find(".add-txt");
$multirecoAddTxts.on("click", function (e) {
	let $this=$(this);
	$multirecoDefCats.removeClass("selected");
	$this.addClass("selected");
	let sStart=$multireco_input_cats[0].selectionStart;
	let sEnd=$multireco_input_cats[0].selectionEnd;
	let inputValue=$multireco_input_cats[0].value;
	let inserted=m.unescapeHTML($this.html());
	$multireco_input_cats[0].value=`${inputValue.substring(0,sStart)}${inserted}${inputValue.substring(sEnd)}`;
	let l=$multireco_input_cats[0].value.length;
	$multireco_input_cats.focus();
	sEnd=sStart+inserted.length;
	$multireco_input_cats[0].setSelectionRange(sEnd,sEnd);
	$multireco_input_cats.trigger("keyup.fs");
});
let $multirecoDeleteCat=$multireco_def_cats.find(".delete-cat");
$multirecoDeleteCat.on("click", function (e) {
	let $this=$(this);
	let fs=m.fsCat;
	$multirecoDefCats.removeClass("selected");
	$this.addClass("selected");
	let k=fs.k;
	fs.listOfCats.splice(k, 1);
	fs.$fs[0].value=fs.listOfCats.join(";");
	let sStart=0;
	for (let i=0;i<k;i++) {
		sStart+=fs.listOfCats[i].length+1;
	}
	let sEnd=fs.listOfCats.length===k?sStart-1:sStart;
	fs.$fs.focus();
	fs.$fs[0].setSelectionRange(sEnd,sEnd);
	$multireco_input_cats.trigger("keyup.fs");
});
m.getAndShowDefsAndReco=function (noFormatURI) {
	let elem=$input_uri[0];
	let uri=m.lastURI=noFormatURI?elem.value:m.formatURI(elem.value);
	if (elem.value!==uri) { elem.value=uri; }
	let uriRendered=m.uriRendering(uri,true);
	if (uriRendered.from==="youtube") {
		m.lastURI=uri;
		uri=elem.value=`https://www.youtube.com/watch?v=${uriRendered.videoId}`;
	}
	else if (uriRendered.from==="insta") {
		m.lastURI=uri;
		uri=elem.value=`https://www.instagram.com/p/${uriRendered.imgId}/`;
	}
	else if (uriRendered.from==="naver") {
		m.lastURI=uri;
		uri=elem.value=`https://tv.naver.com/v/${uriRendered.videoId}`;
	}
	else if (uriRendered.from==="vlive") {
		m.lastURI=uri;
		uri=elem.value=`https://www.vlive.tv/video/${uriRendered.videoId}`;
	}
	else if (uriRendered.from==="kakao") {
		m.lastURI=uri;
		uri=elem.value=`https://tv.kakao.com/v/${uriRendered.videoId}`;
	}
	else if (uriRendered.from==="ted") {
		m.lastURI=uri;
		uri=elem.value=`https://www.ted.com/talks/${uriRendered.videoId}`;
	}
	else if (uriRendered.from==="dailymotion") {
		m.lastURI=uri;
		uri=elem.value=`https://www.dailymotion.com/video/${uriRendered.videoId}`;
	}
	$("#show-URI").html(uriRendered.html.replace(/delayed-src/gi,"src"));
	let r=m.userRecos[uri];
	if (!r) { r=m.userRecos[uri]={}; }
	if (r.down) {
		m.showReco(r);
	}
	else {
		let getRecosStr="uri"+"\n"+uri;
		$.ajax({
			type:"POST", url:`${m.userPath}/get-Recos`, data:getRecosStr
			, dataType:"text"
		}).done(function (resp) { // User reco 가 없으면 head 만 보냄.
			m.recoDowned(uri, m.userRecos);
			m.recoToEve(resp, m.userRecos);
			m.showReco(r);
		});
	}
	if (r.defs) {
		m.showDefs(r);
	}
	else {
		m.showDefs({defTitles:[[""]], defCats:[[""]], defDescs:[[""]]});
		$.ajax({
			type:"POST", url:"/reco/defs", data:uri
			, dataType:"text"
		}).done(function (resp) {
			let defs=m.strToJSON(resp);
			r.defs=true;
			if (defs[1]) {
				r.defCats=m.strToJSON(defs[1].defCats, false);
				r.defTitles=m.strToJSON(defs[1].defTitles, false);
				r.defDescs=m.strToJSON(defs[1].defDescs, false);
				m.showDefs(r);
			}
		});
	}
	if (m.myPage||uri==="") {
		$error.html("");
	}
	else {
		$error.html("[--Be careful! This is not your page. On this URI, you have--]");
		let mR=m.myRecos[uri];
		if (!mR) { mR=m.myRecos[uri]={}; }
		if (mR.down) {
			m.showMyReco(mR);
		}
		else {
			let getRecosStr="uri"+"\n"+uri;
			$.ajax({
				type:"POST", url:`/user/${m.myId}/get-Recos`, data:getRecosStr
				, dataType:"text"
			}).done(function (resp) { // User reco 가 없으면 head 만 보냄.
				m.recoDowned(uri, m.myRecos);
				m.recoToEve(resp, m.myRecos);
				m.showMyReco(mR);
			});
		}
	}
};
$new_reco.find("input, textarea").on("keydown.common", function (e) {
	if (e.keyCode===27) { // ESC
		$window.trigger({type:'keydown', keyCode:'N'.charCodeAt(0)});
	}
	else if (e.ctrlKey&&e.keyCode===13) { // Ctrl+Enter
		let r=m.myRecos[$input_uri[0].value];
		if (r.has) {
			$button_edit.trigger("click");
		}
		else {
			$button_reco.trigger("click");
		}
	}
});
$input_cats.off("keydown.common");
$input_uri.on("input keyup cut paste click", function (e) {
	let uri=this.value;
	if (uri!==m.lastURI) {
		m.lastURI=uri;
		clearTimeout(m.timeOutGetInfos);
		m.timeOutGetInfos=setTimeout(function () {
			m.getAndShowDefsAndReco();
		}, 1024);
	}
});

m.lastVal=m.val("");
$input_val_stars=$("#input-val-stars");
$input_val_stars.html(m.stars(0));
$input_val_stars.on("mousedown.mdInStars touchstart.mdInStars", function (e) {
	let $bar=$input_val_stars.find(".bar");
	let barW=$bar.width();
	let $val=$input_val[0];
	$html.on("mousemove.mdInStars touchmove.mdInStars", function (e) {
		window.getSelection().removeAllRanges();
		e.preventDefault();
		e.stopPropagation();
		let x=(e.type=='touchmove')?e.originalEvent.touches[0].clientX:e.clientX;
		let w=x-$bar.offset().left+$window.scrollLeft();
		if (w<-15) {
			w=-1;
		}
		else if (w<0) {
			w=0;
		}
		else if (w>m.starsWidth) {
			w=m.starsWidth;
		}
		if (w!==barW) {
			barW=w;
			if (w<0) {
				$val.value="";
				w=0;
			}
			else {
				$val.value=(w/m.starsWidth*m.fullPts).toFixed(1)+"/"+m.fullPts;
			}
			$bar.css({width:w});
			m.lastVal=m.val($val.value);
		}
	});
	$html.on("mouseup.mdInStars touchend.mdInStars", function (e) {
		$html.off("mouseup.mdInStars touchend.mdInStars mousemove.mdInStars touchmove.mdInStars");
	});
});
$input_val_stars.on("click", function (e) {
	let $bar=$(this).find(".bar");
	let barW=$bar.width();
	let $val=$input_val[0];
	let w=e.clientX-$bar.offset().left+$window.scrollLeft();
	if (w<0) {
		w=0;
	}
	else if (w>m.starsWidth) {
		w=m.starsWidth;
	}
	if (w!==barW) {
		$bar.css({width:w});
		$val.value=(w/m.starsWidth*m.fullPts).toFixed(1)+"/"+m.fullPts;
		m.lastVal=m.val($val.value);
	}
});
$input_val.on("keyup", function (e) {
	if (this.value!==m.lastVal.str) {
		let val=m.val(this.value);
		let $bar=$("#input-val-stars .bar");
		if (val.valid&&val.str.length!==0) {
			m.fullPts=val.divisor;
			$bar.css({width:m.starsWidth*val.val});
		}
		else {
			$bar.css({width:0});
		}
		m.lastVal=val;
	}
});
$input_val_down=$("#input-val-down");
$input_val_up=$("#input-val-up");
$input_val_down.on("click", function (e) {
	let val=m.val($input_val[0].value);
	if (val.valid) {
		if (val.val===-1) {
			$input_val[0].value="0.0/10";
		}
		else {
			val.num-=0.1;
			if (val.num<0) {
				val.num=0;
			}
			$input_val[0].value=`${val.num.toFixed(1)}/${val.divisor}`;
		}
	} else {
		$input_val[0].value="0.0/10";
	}
	$input_val.trigger("keyup");
});
$input_val_up.on("click", function (e) {
	let val=m.val($input_val[0].value);
	if (val.valid) {
		if (val.val===-1) {
			$input_val[0].value="10.0/10";
		}
		else {
			val.num+=0.1;
			if (val.num>val.divisor) {
				val.num=val.divisor;
			}
			$input_val[0].value=`${val.num.toFixed(1)}/${val.divisor}`;
		}
	} else {
		$input_val[0].value="10.0/10";
	}
	$input_val.trigger("keyup");
});
$button_back.on("click", function (e) {
	m.showReco(m.userRecos[$input_uri[0].value]);
});

m.closeNewReco=function () {
	m.closeNewRecoN=0;
	m.closeNewRecoInterval=setInterval(function () {
		m.closeNewRecoN++;
		if ($new_reco.is(":visible")) {
			$window.trigger({type:'keydown', keyCode:'N'.charCodeAt(0)});
		}
		if (m.closeNewRecoN>7) {
			clearInterval(m.closeNewRecoInterval);
		}
	}, 512);
};
m.reco_do=function (args, err) {
	if (err) {
		$error.html(`[--Reco failed. You may be not logged-in.--] ${err}`);
		args.$result?.html($error.html());
		$button_reco.removeClass("disabled");
		return;
	}
	$.ajax({
		type:"POST", url:"/reco/do", data:args.strRecoDo
		, dataType:"text"
	}).fail(function () {
		$error.html("[--Reco failed. You may be not logged-in.--]");
		args.$result?.html($error.html());
		$button_reco.removeClass("disabled");
	}).done(function (resp) {
		let res=m.strToJSON(resp);
		if (res[1]?.result==="recoed") {
			$error.html("[--Recoed.--]");
			args.$result?.html($error.html());
			m.recoDowned(args.uri, m.myRecos);
			m.recoToEve(args.strRecoDo, m.myRecos);
			let cats=m.myRecos[args.uri].cats;
			m.putCats_UriToLists(cats, args.uri);
			if (m.myPage) {
				m.refresh(cats, "recoed", args.uri);
			}
			setTimeout(function () {
				m.emptifyReco();
				$button_close.trigger("click");
			}, 1024);
		}
		else {
			$error.html(res[1]?.result);
		}
	}).always(function () {
		$button_reco.removeClass("disabled");
	});
};
$button_reco.on("click", function (e) {
	$button_reco.addClass("disabled");
	let uri=m.formatURI($input_uri[0].value);
	let val=m.val($input_val[0].value.trim());
	let errorMsg="";
	let valid=true;
	if (uri.length===0) {
		valid=false;
		errorMsg="URI is required.";
	}
	else if (m.getUTF8Length(uri)>255) {
		valid=false;
		errorMsg="URI (Length "+m.getUTF8Length(uri)+" &gt; maxUTF8Length 255) is too long.";
	}
	else if (!val.valid) {
		valid=false;
		errorMsg="Points is of invalid form.";
	}
	if (valid) {
		let strHeads="do\turi";
		m.localStorage.setItem("uri", uri);
		let strContents="reco\t"+m.encloseStr(uri);

		let title=m.formatTitle($input_title[0].value.trim());
		m.localStorage.setItem("title", title);
		strHeads+="\ttitle";
		strContents+="\t"+m.encloseStr(title);

		let cats=m.formatCats($input_cats[0].value.trim());
		m.localStorage.setItem("cats", cats);
		strHeads+="\tcats";
		strContents+="\t"+m.encloseStr(cats);

		let desc=$input_desc[0].value.trim();
		m.localStorage.setItem("desc", desc);
		strHeads+="\tdesc";
		strContents+="\t"+m.encloseStr(desc);

		let cmt=$input_cmt[0].value.trim();
		m.localStorage.setItem("cmt", cmt);
		strHeads+="\tcmt";
		strContents+="\t"+m.encloseStr(cmt);

		let points=val.str;
		m.localStorage.setItem("points", points);
		strHeads+="\tval";
		strContents+="\t"+m.encloseStr(points);

		let strRecoDo=strHeads+"\n"+strContents;
		$error.html("Being recoed.");
		m.rmb_me(m.reco_do, {strRecoDo, uri});
	}
	else {
		$error.html(errorMsg);
		$button_reco.removeClass("disabled");
	}
});
m.reco_change_do=function (args, err) {
	if (err) {
		$error.html("Failed change. You may not be logged-in. "+err);
		$button_edit.removeClass("disabled");
		return;
	}
	$.ajax({
		type:"POST", url:"/reco/do", data:args.strHeads+"\n"+args.strContents
		, dataType:"text"
	}).fail(function (resp) {
		$error.html("Failed change. You may not be logged-in. "+resp);
	}).done(function (resp) {
		let res=m.strToJSON(resp);
		if (res[1]) {
			if (res[1].result==="changed") {
				$error.html("Changed");
				if (args.cats!==args.r.cats) {
					m.catsChangedOnUri(args.r.cats, args.cats, args.uri);
					args.r.cats=args.cats;
				}
				if (args.title!==args.r.title) { args.r.title=args.title; }
				if (args.desc!==args.r.desc) {
					args.r.desc=args.desc;
					args.r.descR=m.renderStrDescCmt(args.desc);
				}
				if (args.cmt!==args.r.cmt) {
					args.r.cmt=args.cmt;
					args.r.cmtR=m.renderStrDescCmt(args.cmt);
				}
				if (args.val.str!==args.r.val.str) { args.r.val=args.val; }
				if (m.myPage) { m.refresh(args.cats, "changed", args.uri); }
				setTimeout(function () {
					m.emptifyReco();
					$button_close.trigger("click");
				}, 1024);
			}
			else {
				$error.html(res[1]?.result);
			}
		}
	}).always(function () {
		$button_edit.removeClass("disabled");
	});
};
$button_edit.on("click", function (e) {
	$button_edit.addClass("disabled");
	let uri=$input_uri[0].value;
	let val=m.val($input_val[0].value.trim());
	let r=m.myRecos[uri];
	if (uri.length!==0&&val.valid&&r) {
		let strHeads="do"+"\t"+"uri";
		m.localStorage.setItem("uri", uri);
		let strContents="change"+"\t"+m.encloseStr(uri);
		let changed=false;

		let title=m.formatTitle($input_title[0].value.trim());
		m.localStorage.setItem("title", title);
		if (title!==r.title) {
			changed=true;
			strHeads+="\t"+"title";
			strContents+="\t"+m.encloseStr(title);
		}

		let cats=m.formatCats($input_cats[0].value.trim());
		m.localStorage.setItem("cats", cats);
		if (cats!==r.cats) {
			changed=true;
			strHeads+="\t"+"cats";
			strContents+="\t"+m.encloseStr(cats);
		}

		let desc=$input_desc[0].value.trim();
		m.localStorage.setItem("desc", desc);
		if (desc!==r.desc) {
			changed=true;
			strHeads+="\t"+"desc";
			strContents+="\t"+m.encloseStr(desc);
		}

		let cmt=$input_cmt[0].value.trim();
		m.localStorage.setItem("cmt", cmt);
		if (cmt!==r.cmt) {
			changed=true;
			strHeads+="\t"+"cmt";
			strContents+="\t"+m.encloseStr(cmt);
		}

		let points=val.str;
		m.localStorage.setItem("points", points);
		if (points!==r.val.str) {
			changed=true;
			strHeads+="\t"+"val";
			strContents+="\t"+m.encloseStr(points);
		}

		if (changed) {
			$error.html("Being changed.");
			m.rmb_me(m.reco_change_do, {strHeads:strHeads, strContents:strContents, cats:cats, r:r, uri:uri, title:title, desc:desc, cmt:cmt, val:val});
		}
		else {
			$error.html("You have made no change.");
			$button_edit.removeClass("disabled");
		}
	}
	else {
		let errorMsg="";
		if (uri.length===0) {
			errorMsg="URI is required.";
		}
		else if (!val.valid) {
			errorMsg="Points is of invalid form.";
		}
		else {
			errorMsg="You have no reco on this URI.";
		}
		$error.html(errorMsg);
		$button_edit.removeClass("disabled");
	}
});
m.reco_delete_do=function (args, err) {
	if (err) {
		$error.html("Failed delete. You may not be logged-in.");
		$button_del.removeClass("disabled");
		return;
	}
	$.ajax({
		type:"POST", url:"/reco/do", data:args.strHeads+"\n"+args.strContents
		, dataType:"text"
	}).done(function (resp) {
		let res=m.strToJSON(resp);
		if (res[1]?.result==="deleted") {
			$error.html("Deleted");
			let cats=args.r.cats;
			m.myRecos[args.uri].deleted=true;
			m.delCats_UriFromLists(cats, args.uri);
			if (m.myPage) {
				$numbers_of_recos.html(`Intentionally deleted/editted reco remains in the UriLists of old cats of the reco, for a reason of easy recovery of that reco.`);
				m.refresh(cats, "deleted", args.uri);
			}
			setTimeout(function () {
				$button_close.trigger("click");
			}, 1024);
		}
		else {
			$error.html(res[1]?.result);
		}
	}).always(function () {
		$button_del.removeClass("disabled");
	});
};
$button_del.on("click", function (e) {
	$button_del.addClass("disabled");
	let uri=$input_uri[0].value;
	let r=m.myRecos[uri];
	if (uri.length!==0&&!!r) {
		let strHeads="do"+"\t"+"uri";
		let strContents="delete"+"\t"+m.encloseStr(uri);
		m.rmb_me(m.reco_delete_do, {strHeads:strHeads, strContents:strContents, r:r, uri:uri});
	}
	else {
		let errorMsg="";
		if (uri.length==0) {
			errorMsg="[--URI is required.--]";
		}
		else {
			errorMsg="[--You have no reco on this URI.--]";
		}
		$error.html(errorMsg);
		$button_del.removeClass("disabled");
	}
});



///////////////////////////////////////////
// Go to Cats (Somewhat different from Go, TofR)
///////////////////////////////////////////
m.completeCatAndOpenCat=async function (e, elem, j, fs) {
	let $elem=$(elem);
	let fsFLj=fs.fullList[j];
	let cat=fsFLj.cat;
	fs.$fsLis.removeClass("selected");
	$elem.addClass("selected");
	let beInCurrentCat=false;
	if (cat===m.currentCat) {
		beInCurrentCat=true;
	}
	let catsTxt=fs.$fs[0].value;
	fs.$fs.focus();
	let sEnd=fs.$fs[0].selectionEnd;
	fs.listOfCats=catsTxt.split(";");
	let l=catsTxt.length;
	let lastK=fs.k;
	fs.k=0;
	for (let i=fs.listOfCats.length-1;i>=0;i--) {
		l-=fs.listOfCats[i].length+1;
		if (l<sEnd) {
			fs.k=i;
			break;
		}
	} // Picking cat index k of the current selectionEnd.
	let k=fs.k; // index of cat on sEnd.
	fs.listOfCats[k]=cat;
	fs.$fs[0].value=fs.listOfCats.join(";");
	let sStart=0;
	for (let i=0;i<k;i++) {
		sStart+=fs.listOfCats[i].length+1;
	}
	sEnd=sStart+fs.listOfCats[k].length;
	fs.$fs.focus();
	fs.$fs[0].setSelectionRange(sEnd,sEnd);
	if (!beInCurrentCat) {
		m.currentCat=cat;
		await m.openCat(cat);
	}
	return;
};
m.doGotoCatsFSGo=function (fs) {
	let catsTxt=fs.$fs[0].value;
	fs.$fs.focus();
	let sEnd=fs.$fs[0].selectionEnd;
	fs.listOfCats=catsTxt.split(";");
	let l=catsTxt.length;
	let lastK=fs.k;
	fs.k=0;
	for (let i=fs.listOfCats.length-1;i>=0;i--) {
		l-=fs.listOfCats[i].length+1;
		if (l<sEnd) {
			fs.k=i;
			break;
		}
	} // Picking cat index k of the current selectionEnd.
	let fsPtnSH=m.splitHangul(fs.listOfCats[fs.k]);
	if (fs[0].ptnSH.splitted!==fsPtnSH.splitted) {
		let res=m.fuzzySearch(fsPtnSH, fs);
		let sorted=res.sorted;
		let str="";
		for (let i=0;i<sorted.length;i++) {
			let k=res[sorted[i]].i;
			let fsFLk=fs.fullList[k];
			if (fsFLk) {
				str+=`<div id="goto-cats-${k}" class="list-item${fsFLk?.deleted?" deleted":""}" onclick="m.completeCatAndOpenCat(event,this,${k},m.fsGotoCats)">${fsFLk.html}${res[sorted[i]].highlight!==undefined?`<div class="highlighted"><span class="maxMatchScore">${res[sorted[i]].maxMatchScore}</span> :: ${res[sorted[i]].highlight}</div>`:''}</div>`;
			}
		}
		fs.$fsl.html(str);
		fs.$fsLis=fs.$fsl.find(".list-item");
	}
};
m.fsGotoCatsOn=function () {
	let now=Date.now();
	let passed=now-m.previous;
	if (passed>m.wait) {
		m.previous=now;
		m.doGotoCatsFSGo(m.fsGotoCats);
	}
	else {
		$goto_cats.off("input.fs keyup.fs cut.fs paste.fs");
		setTimeout(function () {
			$goto_cats.on("input.fs keyup.fs cut.fs paste.fs", m.fsGotoCatsOn);
			m.previous=Date.now();
			m.doGotoCatsFSGo(m.fsGotoCats);
		}, m.wait*1.1-passed);
	}
};
$goto_cats.on("input.fs keyup.fs cut.fs paste.fs", m.fsGotoCatsOn);
$goto_cats.trigger("input.fs");



///////////////////////////////////////////
// Fuzzy search on Titles (Go)
///////////////////////////////////////////
$fuzzy_search.on("keydown", function (e) {
	e.stopPropagation();
	switch (e.keyCode) {
	case 27: // ESC=27
		e.preventDefault();
		$window.trigger({type:'keydown', keyCode:'G'.charCodeAt(0)});
		break;
	case 38: // up=38
	case 40: // down=40
		e.preventDefault();
		let $fsl=$fuzzy_search_list;
		let $lis=$fsl.find(".list-item");
		let $liSelected=$fsl.find(".list-item.selected").eq(0);
		let $liTo=null;
		if ($liSelected.exists()) {
			if (e.keyCode===38) {
				$liTo=$liSelected.prev();
			}
			else {
				$liTo=$liSelected.next();
			}
			if ($liTo.exists()) {
				$liTo.eq(0).trigger("click");
				if ($liTo.offset().top<$fsl.offset().top+2) { // $liTo at upside of scroll.
					$fsl.scrollTop($fsl.scrollTop()+$liTo.offset().top-$fsl.offset().top-2);
				}
				else if ($liTo.offset().top+$liTo.outerHeight()>$fsl.offset().top+$fsl.height()+2) { // $liTo at downside of scroll.
					$fsl.scrollTop($fsl.scrollTop()+$liTo.offset().top+$liTo.outerHeight()-$fsl.offset().top-$fsl.height()-2);
				}
			}
		}
		else {
			if ($lis.exists()) {
				if (e.keyCode===38) {
					$liTo=$lis.last();
					$fsl.scrollTop($fsl[0].scrollHeight);
				}
				else {
					$liTo=$lis.first();
					$fsl.scrollTop(0);
				}
				$liTo.eq(0).trigger("click");
			}
		}
		break;
	}
});
m.showAndScrollTo=function ($listI) {
	if (!$listI.is(":visible")) {
		$listI.removeClass("none");
		$listI.show();
	}
	$window.scrollTop($listI.offset()?.top);
};
m.gotoLi=function (e, elem, k, fs) {
	if (e&&e.srcElement&&e.srcElement.nodeName=="A") {
		return;
	}
	let $elem=$(elem);
	let fsFLk=fs.fullList[k];
	let uri=fsFLk.uri;
	if ($elem.hasClass("selected")) {
		if ($elem.hasClass("clicked-once")) {
			$elem.removeClass("clicked-once");
			fs.$fs.trigger({type:'keydown', keyCode:27}); // keyCode:27=ESC
		}
		else {
			$elem.addClass("clicked-once");
		}
	}
	else {
		fs.$fsLis.removeClass("selected");
		fs.$fsLis.removeClass("clicked-once");
		$elem.addClass("selected");
	}
	let $listI=fsFLk.$listI;
	if ($listI) {
		m.showAndScrollTo($listI);
	}
	else {
		let beInCurrentCat=false;
		let catSplit=fsFLk.catSplit;
		for (let i=0;i<catSplit.length;i++) {
			if (m.currentCat==catSplit[i]) {
				beInCurrentCat=true;
				break;
			}
		}
		if (!beInCurrentCat) {
			m.openCat(catSplit[0]);
		}
		let k=fsFLk.kOfUriList[m.currentCat];
		let i=Math.floor((m.catUriList[m.currentCat].uris.length-1-k)/m.maxShowReco);
		$(`#load-recos-${i}`).trigger("click");
		setTimeout(function () {
			$listI=fs.fullList[k].$listI;
			if ($listI) {
				m.showAndScrollTo($listI);
			}
		}, 512);
	}
};
m.doFSGo=function (fs) {
	let fsPtnSH=m.splitHangul(fs.$fs.text().trim());
	if (fs[0].ptnSH.splitted!==fsPtnSH.splitted) {
		let res=m.fuzzySearch(fsPtnSH, fs);
		let sorted=res.sorted;
		let str="";
		for (let i=0;i<sorted.length;i++) {
			let k=res[sorted[i]].i;
			let fsFLk=fs.fullList[k];
			if (fsFLk) {
				str+=`<div id="li-${k}" class="list-item${fsFLk.reco?.deleted?" deleted":""}" onclick="m.gotoLi(event,this,${k},m.fsGo)">${fsFLk.html}${res[sorted[i]].highlight!==undefined?`<div class="highlighted"><span class="maxMatchScore">${res[sorted[i]].maxMatchScore}</span> :: ${res[sorted[i]].highlight}</div>`:''}</div>`;
			}
		}
		fs.$fsl.html(str);
		fs.$fsLis=fs.$fsl.find(".list-item");
	}
};
m.fsGoOn=function () {
	let now=Date.now();
	let passed=now-m.previous;
	if (passed>m.wait) {
		m.previous=now;
		m.doFSGo(m.fsGo);
	}
	else {
		$fuzzy_search.off("input.fs keyup.fs cut.fs paste.fs");
		setTimeout(function () {
			$fuzzy_search.on("input.fs keyup.fs cut.fs paste.fs", m.fsGoOn);
			m.previous=Date.now();
			m.doFSGo(m.fsGo);
		}, m.wait*1.1-passed);
	}
};
$fuzzy_search.on("input.fs keyup.fs cut.fs paste.fs", m.fsGoOn);
$fuzzy_search.trigger("input.fs");



///////////////////////////////////////////
// Fuzzy search on Table of Recos (TofR)
///////////////////////////////////////////
m.playLi=function (e, elem, k, fs) {
	if (!(e&&e.srcElement&&e.srcElement.nodeName=="A")) {
		let $elem=$(elem);
		// let uri=fs.fullList[k].uri;
		if ($elem.hasClass("selected")) {
			fs.$fs.trigger({type:'keydown', keyCode:27}); // keyCode:27=ESC
		}
		else {
			fs.currentIndex=k;
			fs.getAndPlayVideo(); // cue or not? not!
			if ($playlist_container.is(":visible")) {
				let scrollTop=$window.scrollTop();
				let pHeight=$playlist_container.height();
				if (fs.fixed) {
					$window.scrollTop($playlist_container.offset().top-fs.$playing.outerHeight());
				}
				else {
					$window.scrollTop($playlist_container.offset().top);
				}
			}
		}
	}
};
m.doFSToRs=function (fs, shuffle) {
	let fsPtnSH=m.splitHangul(fs.$fs.text().trim());
	if (shuffle) {
		let shuffled=(fs.shuffled?fs.shuffled:fs.shuffled=[]);
		let l=fs.fullList.length;
		for (let i=0;i<l;i++) {
			shuffled[i]={i:i, randomN:Math.random()};
		}
		for (let i=1;i<l;i++) {
			let temp=shuffled[i];
			let j=i;
			for (;(j>0)&&(shuffled[j-1].randomN<temp.randomN);j--) {
				shuffled[j]=shuffled[j-1];
			}
			shuffled[j]=temp;
		}
		fs[1]=null;
		fs[0].ptnSH=m.splitHangul("$!@#");
	}
	let res=m.fuzzySearch(fsPtnSH, fs);
	let sorted=res.sorted;
	let str="";
	for (let i=0;i<sorted.length;i++) {
		let k=res[sorted[i]].i;
		let fsFLk=fs.fullList[k];
		if (fsFLk?.inRange&&!fsFLk.reco.deleted) {
			let uri=fsFLk.uri;
			str+=`<div id="toR-${k}" class="list-item${k===fs.currentIndex?' selected':''}" onclick="m.playLi(event,this,${k},m.fsToRs)">`
					+fs.fullList[k].html
					+((res[sorted[i]].highlight!==undefined)?
					'<div class="highlighted">'+'<span class="maxMatchScore">'+res[sorted[i]].maxMatchScore+'</span> :: '+res[sorted[i]].highlight+'</div>':'')
				+'</div>';
		}
	}
	fs.$fsl.html(str);
	fs.$fsLis=fs.$fsl.find(".list-item");
	fs.$fsl.viewAndScroll($("#toR-"+fs.currentIndex));
};
m.fsToRsOn=function () {
	let now=Date.now();
	let passed=now-m.previous;
	if (passed>m.wait) {
		m.previous=now;
		m.doFSToRs(m.fsToRs);
	}
	else {
		$table_of_recos.off("input.fs keyup.fs cut.fs paste.fs");
		setTimeout(function () {
			$table_of_recos.on("input.fs keyup.fs cut.fs paste.fs", m.fsToRsOn);
			m.previous=Date.now();
			m.doFSToRs(m.fsToRs);
		}, m.wait*1.1-passed);
	}
};
$table_of_recos.on("input.fs keyup.fs cut.fs paste.fs", m.fsToRsOn);
$table_of_recos.trigger("input.fs");
$table_of_recos.on("keydown", function (e) {
	e.stopPropagation();
	switch (e.keyCode) {
	case 27: // ESC=27
		e.preventDefault();
		$window.trigger({type:'keydown', keyCode:'T'.charCodeAt(0)});
		break;
	}
});



////////////////////////////////////////////////////
// SNS Sharing
////////////////////////////////////////////////////
m.shareCurrentPage=function (service) {
	let title=`${m.currentCat} of ${m.userId}'s Recoeve.net`;
	let open="";
	let desc=title;
	let args={};
	let argName="PRL"
	if (m.docCookies.hasItem(argName)) {
		args[argName]=m.docCookies.getItem(argName);
	}
	argName="PRR"
	if (m.docCookies.hasItem(argName)) {
		args[argName]=m.docCookies.getItem(argName);
	}
	let recoeveURI=window.location.origin+m.pathOfCat(m.currentCat, m.recoMode, m.lang, null, args);
	switch (service) {
		case 'link':
			let written=`${title}\n${recoeveURI}`;
			navigator.clipboard.writeText(written).then(function () {
				alert(`The following is copied!\n"${written}"`);
			}
			, function (err) {
				alert(`Could not copy text: ${err}`);
			});
			return;
		case 'twitter':
			open="https://twitter.com/intent/tweet?text="+encodeURIComponent(title)+"&url="+encodeURIComponent(recoeveURI);
			break;
		case 'facebook':
			open="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(recoeveURI);
			break;
		case 'kakao':
			Kakao.Share.sendDefault({
				objectType: 'feed',
				content: {
					title: m.escapeHTML(title),
					description: desc?m.escapeHTML(desc):'',
					imageUrl: '', // No image.
					link: {
						mobileWebUrl: recoeveURI,
						webUrl: recoeveURI,
					},
				},
			});
			return;
	}
	window.open(open);
};
m.shareSNS=function (elem, service) {
	let $reco=$(elem).parent(".reco");
	let uri=m.unescapeHTML($reco.find(".textURI").html());
	let r=m.userRecos[uri];
	let title=r.title;
	let desc=r.desc;
	let open="";
	let lang=m.lang;
	let recoeveURI=window.location.origin+m.pathOfCat(m.currentCat, m.recoMode, lang, uri);
	switch (service) {
		case 'link':
			let written=`${title}\n${recoeveURI}`;
			navigator.clipboard.writeText(written).then(function () {
				alert(`The following is copied!\n"${written}"`);
			}
			, function (err) {
				alert(`Could not copy text: ${err}`);
			});
			return;
		case 'twitter':
			open="https://twitter.com/intent/tweet?text="+encodeURIComponent(title)+"&url="+encodeURIComponent(recoeveURI);
			break;
		case 'facebook':
			open="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(recoeveURI);
			break;
		case 'kakao':
			Kakao.Share.sendDefault({
				objectType: 'feed',
				content: {
					title: m.escapeHTML(title),
					description: desc?m.escapeHTML(desc):'',
					imageUrl: '', // No image.
					link: {
						mobileWebUrl: recoeveURI,
						webUrl: recoeveURI,
					},
				},
			});
			return;
	}
	window.open(open);
};



////////////////////////////////////////////////////
// ShortKeys
////////////////////////////////////////////////////
$block_touch.on("click dblclick touch mousedown touchstart mousemove touchmove mouseup touchend scroll keydown keypress keyup input select", function (e) {
	e.stopPropagation();
	e.preventDefault();
});
m.fdList=$("#change-style, #foot, #head, #headPlay, #contents>.reco, .to-be-executed"); // Ordered automatically by jQuery.
m.zIndex=10010;
m.processShortKey=function (e) {
	if (e.altKey||e.ctrlKey||e.metaKey) { return; }
	switch (e.target.nodeName) {
		case "INPUT": case "SELECT": case "TEXTAREA": return;
	}
	switch (e.keyCode) {
		case 85: // U=85 Block touch
			$block_touch.show();
			$block_touch_exit.show();
			break;
		case 67: // C=67 Go to Cat or Cats?
			e.preventDefault();
			if ($goto_cats_container.is(":visible")) {
				$goto_cats_container.hide();
				$out_focus.focus();
				$button_goto_cats.removeClass("enabled");
				m.gotoCats=false;
				window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
			}
			else {
				$goto_cats_container.show();
				$goto_cats_container.css({zIndex:++m.zIndex});
				$goto_cats.focus();
				$button_goto_cats.addClass("enabled");
				m.gotoCats=true;
				window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
			}
			break;
		case 71: // G=71
			e.preventDefault();
			if ($fuzzy_search_container.is(":visible")) {
				$fuzzy_search_container.hide();
				$out_focus.focus();
				$button_Go.removeClass("enabled");
				m.goOn=false;
				window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
			}
			else {
				$fuzzy_search_container.show();
				$fuzzy_search_container.css({zIndex:++m.zIndex});
				$fuzzy_search.focus();
				$button_Go.addClass("enabled");
				m.goOn=true;
				window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
			}
			break;
		case 84: // T=84
			e.preventDefault();
			if ($table_of_recos_container.is(":visible")) {
				$table_of_recos_container.hide();
				$out_focus.focus();
				$button_ToR.removeClass("enabled");
				m.ToRsOn=false;
				window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
			}
			else {
				$table_of_recos_container.show();
				$table_of_recos_container.css({zIndex:++m.zIndex});
				$table_of_recos.focus();
				$button_ToR.addClass("enabled");
				m.ToRsOn=true;
				window.history.pushState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode));
			}
			break;
		case 66: // B=66
			e.preventDefault();
			m.toggleNeighborsMode();
			break;
		case 77: // M=77
			e.preventDefault();
			m.toggleMultirecoMode();
			break;
		case 78: // N=78
			e.preventDefault();
			m.toggleNewReco();
			break;
		case 70: //F=70
		case 68: //D=68
			let scrollTop=$window.scrollTop();
			let i, k=m.fdList.length;
			let hI;
			if (e.keyCode===70) {
				scrollTop+=10;
				for (i=0;i<k;i++) {
					hI=m.fdList.eq(i);
					if (hI.is(":visible")&&scrollTop<hI.offset().top) { break; }
				}
				if (i===k) {
					// hI=m.fdList.eq(0);
					// alert("This is the last section.");
					return;
				}
			}
			else{
				scrollTop-=10;
				for (i=k-1;i>=0;i--) {
					hI=m.fdList.eq(i);
					if (hI.is(":visible")&&scrollTop>hI.offset().top) { break; }
				}
				if (i===-1) {
					// hI=m.fdList.eq(k-1);
					// alert("This is the first section.");
					return;
				}
			}
			$window.scrollTop(hI.offset().top);
			break;
		case 73: // I=73
			$a_log_in.trigger("click");
			break;
		case 79: // O=79
			$a_log_out.trigger("click");
			break;
		default:
	}
}
$window.on("keydown", m.processShortKey);
let $shortkeyDesc=$("ul#shortkeys");
if ($shortkeyDesc.exists()) {
	$shortkeyDesc.prepend(
`<li><span onclick="$window.trigger({type:'keydown', keyCode:'G'.charCodeAt(0)})"><span class="bold">G</span>: [--Fuzzy Search--] (Go)</span></li>
<li><span onclick="$window.trigger({type:'keydown', keyCode:'T'.charCodeAt(0)})"><span class="bold">T</span>: Table of Recos</span></li>
<li><span onclick="$window.trigger({type:'keydown', keyCode:'F'.charCodeAt(0)})"><span class="bold">F</span>: [--Forward--] Reco</span></li>
<li><span onclick="$window.trigger({type:'keydown', keyCode:'D'.charCodeAt(0)})"><span class="bold">D</span>: [--Backward--] Reco</span></li>
<li><span onclick="$window.trigger({type:'keydown', keyCode:'N'.charCodeAt(0)})"><span class="bold">N</span>: [--New Reco--]</span></li>
<li><span onclick="$window.trigger({type:'keydown', keyCode:'M'.charCodeAt(0)})"><span class="bold">M</span>: [--Multireco mode--]</span></li>
<li><span onclick="$window.trigger({type:'keydown', keyCode:'B'.charCodeAt(0)})"><span class="bold">B</span>: [--See neighbors--]</span></li>`
	);
}



////////////////////////////////////////////////////
// Language/언어/語言
////////////////////////////////////////////////////
m.changeLang=function (lang, e, elem) {
	let search=window.location.search;
	let vars=m.getSearchVars(search);
	let href=`${window.location.pathname}${vars.cat?`?cat=${encodeURIComponent(vars.cat.val)}`:"?cat="}${lang?`&lang=${lang}`:""}${window.location.hash}`;
	if (e&&e.which===2) { // wheel click.
		$(elem).attr({"href":href});
		return true;
	}
	else {
		window.location.href=href;
		return false;
	}
};
let dataLang=m.strToJSON($data_lang.html().trim());
let htmlLangs="";
for (let i=0;i<dataLang[0].length;i++) {
	htmlLangs+=`<a href="?lang=${dataLang[0][i]}" onclick="return m.changeLang('${dataLang[0][i]}', event, this)">${dataLang[1][i]}</a><br>`;
}
$choose_lang_list.html(htmlLangs);
$choose_lang.on("click", function (e) {
	if ($choose_lang.hasClass("enabled")) {
		$choose_lang.removeClass("enabled");
		$choose_lang_list.hide();
	}
	else {
		$choose_lang.addClass("enabled");
		$choose_lang_list.show();
	}
});


////////////////////////////////////////////////
// Initial open :: Lang : set cookie, Cat : get and show recos
////////////////////////////////////////////////
$document.ready(function () {
	m.initialOpen=true;

	let vars=m.searchVars;

	let uri=m.localStorage.getItem("uri");
	if (vars.uri!==undefined) {
		$input_uri[0].value=vars.uri.val;
		$input_uri.trigger("input");
	}
	else if (!!uri&&uri!=='null') {
		$input_uri[0].value=uri;
	}

	let title=m.localStorage.getItem("title");
	if (vars.title!==undefined) {
		$input_title[0].value=vars.title.val;
	}
	else if (!!title&&title!=='null') {
		$input_title[0].value=title;
	}

	let cats=m.localStorage.getItem("cats");
	if (!!cats&&cats!=='null') {
		$input_cats[0].value=cats;
	}

	let desc=m.localStorage.getItem("desc");
	if (!!desc&&desc!=='null') {
		$input_desc[0].value=desc;
	}

	let cmt=m.localStorage.getItem("cmt");
	if (!!cmt&&cmt!=='null') {
		$input_cmt[0].value=cmt;
	}

	let points=m.localStorage.getItem("points");
	if (!!points&&points!=='null') {
		$input_val[0].value=points;
		$input_val.trigger("keyup");
	}

	m.localStorage.clear();

	m.args={};
	if (vars.PRL||vars.PRR) {
		if (vars.PRL) {
			let val=vars.PRL.val;
			m.args.PRL=val;
			m.ptsRangeFrom=Number(val);
			m.docCookies.setItem("PRL", val, Infinity, "/", false, true);
		}
		else {
			m.ptsRangeFrom=0;
			m.docCookies.setItem("PRL", "0", Infinity, "/", false, true);
		}
		if (vars.PRR) {
			let val=vars.PRR.val;
			m.args.PRR=val;
			m.ptsRangeTo=Number(val);
			m.docCookies.setItem("PRR", val, Infinity, "/", false, true);
		}
		else {
			m.ptsRangeTo=1;
			m.docCookies.setItem("PRR", "1", Infinity, "/", false, true);
		}
	}
	else {
		if (m.docCookies.hasItem("PRL")) {
			m.ptsRangeFrom=Number(m.docCookies.getItem("PRL"));
		}
		else {
			m.ptsRangeFrom=0;
		}
		if (m.docCookies.hasItem("PRR")) {
			m.ptsRangeTo=Number(m.docCookies.getItem("PRR"));
		}
		else {
			m.ptsRangeTo=1;
		}
	}
	m.PRw=$point_range.width();
	m.PRLw=m.ptsRangeFrom*m.PRw;
	$point_range_left.css({left:m.PRLw-23});
	$point_range_bar.css({left:m.PRLw});
	m.PRRw=m.ptsRangeTo*m.PRw;
	$point_range_right.css({right:m.PRw-m.PRRw-23});
	$point_range_bar.css({right:m.PRw-m.PRRw});

	m.PRw1=$point_range1.width();
	m.PRLw1=m.ptsRangeFrom*m.PRw1;
	$point_range_left1.css({left:m.PRLw1-15});
	$point_range_bar1.css({left:m.PRLw1});
	m.PRRw1=m.ptsRangeTo*m.PRw1;
	$point_range_right1.css({right:m.PRw1-m.PRRw1-15});
	$point_range_bar1.css({right:m.PRw1-m.PRRw1});

	$point_range_result.html((m.ptsRangeFrom*m.PRmax).toFixed(1)+"~"+(m.ptsRangeTo*m.PRmax).toFixed(1)+" / "+m.PRmax);

	if (window.location.pathname==="/reco") {
		window.history.replaceState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", `/reco${window.location.search}${window.location.hash}`);
	}
	else {
		window.history.replaceState({cat:m.currentCat, mode:m.recoMode, gotoCats:m.gotoCats, goOn:m.goOn, ToRsOn:m.ToRsOn, newRecoOn:m.newRecoOn}, "", m.pathOfCat(m.currentCat, m.recoMode, m.lang, m.hashURI, m.args));
	}
	m.saveSSN();

	if (m.recoMode==="") {
		m.openCat(m.currentCat);
	}
	else if (m.recoMode==="multireco") {
		m.toggleMultirecoMode();
	}
	else if (m.recoMode==="neighbors") {
		m.toggleNeighborsMode();
	}

	if (window.location.pathname==="/reco") {
		// Avoid window.history.pushState().
		m.newRecoOn=true;
		$button_new_reco.addClass("enabled");
		$input_uri[0].disabled=false;
		$new_reco.show();
		let cat=m.currentCat;
		if (cat&&($input_cats[0].value===""||$input_uri[0].value==="")) {
			$input_cats[0].value=cat;
		}
		m.wST=$window.scrollTop();
		$window.on("scroll.stop", function (e) {
			e.stopPropagation();
			e.preventDefault();
			$window.scrollTop(m.wST);
		});
		$input_uri.focus();
		if (m.docCookies.hasItem("rmbdI")&&(!!m.docCookies.getItem("rmbdI"))) {
			$input_uri.trigger("keyup");
		}
		else {
			m.gotoLogIn=function (elem) {
				let path=`/account/log-in?goto=${encodeURIComponent(window.location.pathname+window.location.search+window.location.hash)}`;
				if (e?.which===2) { // wheel click.
					window.open(path, "_blank");
					return true;
				}
				window.location.href=path;
				return false;
			};
			$new_reco.after(`<div class="block-touch" id="should-do-log-in-container" style="display:-webkit-flex; display:flex"><div class="center" style="display:inline-block; margin:auto">[--You should log-in | sign-up first with remember me option.--]</div></div><div class="block-touch-exit exit" id="should-do-log-in-exit" style="z-index:31000; position:fixed" onclick="$('#should-do-log-in, #should-do-log-in-exit').hide();"></div>`);
		}
	}
	$title.html(`${m.userId}'s recoeve.net`);
	let hashURI=m.hashURI;
	if (!!hashURI) {
		m.fsGo.tryN=1;
		m.setIntervalFsGo=setInterval(function () {
			if (!!m.fsGo.fullList[hashURI]||++m.fsGo.tryN>11) {
				let k=m.fsGo.fullList[hashURI]?.i;
				let $liK=$(`#li-${k}`);
				if ($liK.exists()) {
					$(`#li-${k}`).trigger("click");
					clearInterval(m.setIntervalFsGo);
				}
			}
		}, 1024);
	}
	$goto_cats_container.hide();
	m.initialOpen=false;
});



////////////////////////////////////////////////////
// YouTube API
////////////////////////////////////////////////////
m.fsToRs.Preceding=function () {
	m.fsToRs.playNext(1);
};
m.fsToRs.Following=function () {
	m.fsToRs.playNext();
};
m.fsToRs.shuffle=function () {
	let fs=m.fsToRs;
	m.doFSToRs(fs, true);
	fs.playNext(-1, true, true);
};
m.fsToRs.autoSkip=function (elem) {
	let $elem=$(elem);
	if ($elem.hasClass("enabled")) {
		$elem.removeClass("enabled");
		m.fsToRs.skip=false;
	}
	else {
		$elem.addClass("enabled");
		m.fsToRs.skip=true;
	}
};
m.fsToRs.toggleLoop=function (elem) {
	let $elem=$(elem);
	if ($elem.hasClass("enabled")) {
		$elem.removeClass("enabled");
		m.fsToRs.loop=false;
	}
	else {
		$elem.addClass("enabled");
		m.fsToRs.loop=true;
	}
};
m.fsToRs.toggleOneLoop=function (elem) {
	let $elem=$(elem);
	if ($elem.hasClass("enabled")) {
		$elem.removeClass("enabled");
		m.fsToRs.oneLoop=false;
	}
	else {
		$elem.addClass("enabled");
		m.fsToRs.oneLoop=true;
	}
};
m.fsToRs.getAndPlayVideo=function (cue) {
	let fs=m.fsToRs;
	fs.pauseVideo();
	let i=fs.currentIndex;
	if (0<=i&&i<fs.fullList.length) {
		fs.$fsLis.removeClass("selected");
		$(`#toR-${i}`).addClass("selected");
		let r=fs.fullList[i].reco;
		$reco_playing.html(m.recoHTML(r, true, true));
		let uriRendered=m.uriRendering(r.uri);
		if (uriRendered.from==="youtube") {
			$eveElse.html('');
			$eveElse_uri_rendered.hide();
			$rC_youtube_uri_rendered.show();
			fs.$playing=$rC_youtube_uri_rendered;
			if (fs.$playing.hasClass("fixed")) {
				fs.fixed=true;
			}
			else {
				fs.fixed=false;
			}
			if (m.YtPlayer) {
				if (cue) {
					m.YtPlayer.cueVideoById(uriRendered.videoId);
				}
				else {
					m.YtPlayer.loadVideoById(uriRendered.videoId);
				}
			}
			else if (YT!==undefined&&YT.Player) {
				m.YtPlayer=new YT.Player('youtube', {videoId:uriRendered.videoId
					, events:{
						'onError':function (e) {
							if (fs.skip) {
								m.playListSetTimeout=setTimeout(function () {
									if (fs.skip) { fs.playNext(); }
								}, 7000);
							}
						}, 'onStateChange':function (e) {
							if (e.data===YT.PlayerState.ENDED) {
								if (fs.oneLoop) {
									m.YtPlayer.seekTo(0,true);
								}
								else {
									fs.playNext();
								}
							}
						}
					}}
				);
			}
			else {
				fs.prepareRecoListPlay(true);
			}
		}
		else if (uriRendered.from==="video") {
			$eveElse.replaceWith(m.rC(`<video id="video" controls preload="auto" src="${uriRendered.src}"></video>`, null, "eveElse"));
			$eveElse=$("#eveElse");
			$video=$("#video");
			$youtube.html('');
			$eveElse_uri_rendered.show();
			$rC_youtube_uri_rendered.hide();
			fs.$playing=$eveElse_uri_rendered.find(".rC");
			if (fs.$playing.hasClass("fixed")) {
				fs.fixed=true;
			}
			else {
				fs.fixed=false;
			}
			$video.on("ended", function () {
				if (fs.oneLoop) {
					$video[0].play();
				}
				else {
					fs.playNext();
				}
			});
			if (!cue) {
				$video[0].play();
			}
		}
		else {
			$eveElse.html(uriRendered.html);
			$youtube.html('');
			$eveElse_uri_rendered.show();
			$rC_youtube_uri_rendered.hide();
			fs.$playing=$eveElse_uri_rendered.find(".rC");
			if (fs.$playing.hasClass("fixed")) {
				fs.fixed=true;
			}
			else {
				fs.fixed=false;
			}
			if ((!cue)&&fs.skip) {
				clearTimeout(m.playListSetTimeout);
				m.playListSetTimeout=setTimeout(function () {
					if (fs.skip) { fs.playNext(-1, cue); }
				}, 7000);
			}
		}
	}
	else {
		$reco_playing.html('');
		$eveElse.html('');
		$youtube.html('');
		$eveElse_uri_rendered.hide();
		$rC_youtube_uri_rendered.hide();
	}
	m.delayedElems=$("[delayed-src], [delayed-bgimage], .to-be-executed");
	$window.on("scroll.delayedLoad", m.delayedLoadByScroll);
	$window.trigger("scroll.delayedLoad");
};
m.fsToRs.pauseVideo=function () {
	if ($video&&$video[0]&&$video[0].tagName=="VIDEO") {
		$video[0]?.pause();
	}
	m.YtPlayer?.pauseVideo();
};
m.fsToRs.playNext=function (increment, cue, first) {
	clearTimeout(m.playListSetTimeout);
	let fs=m.fsToRs;
	if (increment===undefined||increment===null||increment.constructor!==Number) { increment=-1; }
	if (first) {
		let $li=fs.$fsLis.eq(0);
		if ($li.exists()) {
			fs.currentIndex=Number($li.attr("id").match(/toR-(\d+)/)[1]);
			fs.$fsl.viewAndScroll($li);
			fs.getAndPlayVideo(cue);
			return;
		}
		else {
			fs.currentIndex=0;
			$reco_playing.html('');
			$eveElse.html('');
			$youtube.html('');
			$eveElse_uri_rendered.hide();
			$rC_youtube_uri_rendered.hide();
			return;
		}
	}
	let $selected=fs.$fsLis.filter(".selected");
	let $next=null;
	if ($selected.exists()) {
		if (increment<0) {
			$next=$selected.next();
			if ((!$next.exists())&&fs.loop) {
				$next=fs.$fsLis.eq(0);
			}
		}
		else {
			$next=$selected.prev();
			if ((!$next.exists())&&fs.loop) {
				$next=fs.$fsLis.last();
			}
		}
	}
	else {
		$next=fs.$fsLis.eq(0);
	}
	if ($next&&$next.exists()) {
		$next.trigger("click");
		fs.$fsl.viewAndScroll($next);
	}
	return;
};
m.fsToRs.prepareRecoListPlay=function (YtAPINeeded) {
	let fs=m.fsToRs;
	if (!m.YtAPILoaded) {
		if (YtAPINeeded) {
			let $ytAPI=$(`<script id="YouTube-API" src="https://www.youtube.com/player_api"></`+`script>`); // Avoid closing script
			$scripts.append($ytAPI);
			m.YtAPILoaded=true;
		}
	}
	if (!YtAPINeeded||(YT!==undefined&&YT.Player)) {
		m.doFSToRs(fs);
		fs.playNext(-1, true, true);
	}
	else {
		setTimeout(function () {
			fs.prepareRecoListPlay(YtAPINeeded);
		}, 1000);
	}
};
m.fsToRs.toggleRecoListPlay=function () {
	if ($uri_rendered_container.is(":visible")) {
		$uri_rendered_container.hide();
		$toggle_reco_list_play.removeClass("enabled");
	}
	else {
		$uri_rendered_container.show();
		$toggle_reco_list_play.addClass("enabled");
	}
};
})(window.m, jQuery);
</script>
</html>
